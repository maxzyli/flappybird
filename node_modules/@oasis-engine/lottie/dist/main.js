"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("oasis-engine");function e(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function n(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t}function s(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}function a(t){return a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},a(t)}function u(t,e){return u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},u(t,e)}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return l(t)}function c(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,r=a(t);if(e){var n=a(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return h(this,i)}}function p(t,e,i){return p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=a(t)););return t}(t,e);if(r){var n=Object.getOwnPropertyDescriptor(r,e);return n.get?n.get.call(i):n.value}},p(t,e,i||t)}function f(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==i)return;var r,n,s=[],o=!0,a=!1;try{for(i=i.call(t);!(o=(r=i.next()).done)&&(s.push(r.value),!e||s.length!==e);o=!0);}catch(t){a=!0,n=t}finally{try{o||null==i.return||i.return()}finally{if(a)throw n}}return s}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return v(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return v(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function d(t,e,i,r){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function y(t,e,i,r,n){var s={};return Object.keys(r).forEach((function(t){s[t]=r[t]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=i.slice().reverse().reduce((function(i,r){return r(t,e,i)||i}),s),n&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(n):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(t,e,s),s=null),s}var g="function"==typeof Float32Array;function m(t,e){return 1-3*e+3*t}function _(t,e){return 3*e-6*t}function b(t){return 3*t}function w(t,e,i){return((m(e,i)*t+_(e,i))*t+b(e))*t}function x(t,e,i){return 3*m(e,i)*t*t+2*_(e,i)*t+b(e)}function k(t){return t}var P=function(t,e,i,r){if(!(0<=t&&t<=1&&0<=i&&i<=1))throw new Error("bezier x values must be in [0, 1] range");if(t===e&&i===r)return k;for(var n=g?new Float32Array(11):new Array(11),s=0;s<11;++s)n[s]=w(.1*s,t,i);function o(e){for(var r=0,s=1;10!==s&&n[s]<=e;++s)r+=.1;--s;var o=r+.1*((e-n[s])/(n[s+1]-n[s])),a=x(o,t,i);return a>=.001?function(t,e,i,r){for(var n=0;n<4;++n){var s=x(e,i,r);if(0===s)return e;e-=(w(e,i,r)-t)/s}return e}(e,o,t,i):0===a?o:function(t,e,i,r,n){var s,o,a=0;do{(s=w(o=e+(i-e)/2,r,n)-t)>0?i=o:e=o}while(Math.abs(s)>1e-7&&++a<10);return o}(e,r,r+.1,t,i)}return function(t){return 0===t?0:1===t?1:w(o(t),e,r)}},E={};var O={};var z={buildBezierData:function(t,e,i,r){var n=(t[0]+"_"+t[1]+"_"+e[0]+"_"+e[1]+"_"+i[0]+"_"+i[1]+"_"+r[0]+"_"+r[1]).replace(/\./g,"p");if(!O[n]){for(var s,o=0,a=[],u=0;u<200;u++){for(var l=i.length,h=new Array(l),c=u/199,p=0,f=0;f<l;f+=1){var v=Math.pow(1-c,3)*t[f]+3*Math.pow(1-c,2)*c*(t[f]+i[f])+3*(1-c)*Math.pow(c,2)*(e[f]+r[f])+Math.pow(c,3)*e[f];h[f]=v,s&&(p+=Math.pow(h[f]-s[f],2))}o+=p=Math.sqrt(p),a.push({partialLength:p,point:h}),s=h}O[n]={segmentLength:o,points:a}}return O[n]},getBezierEasing:function(t,e,i,r,n){var s=n||("bez_"+t+"_"+e+"_"+i+"_"+r).replace(/\./g,"p"),o=E[s];return o||(o=P(t,e,i,r),E[s]=o,o)}};function A(t){return Object.prototype.toString.call(t)}j=A([]),function(){var t=A("s")}(),function(){var t=A(1)}(),function(){var t=A((function(){}))}(),function(){var t=A(!0)}(),function(){var t=A({})}();var j,L=function(t,e){return(t%e+e)%e},R=function(t,e,i){return t<e?2*e-t:t>i?2*i-t:t},I=function(t,e,i){return t<e?e:t>i?i:t},S=/(loopIn|loopOut)\(([^)]+)/,C=/["']\w+["']/,M=function(){function t(e,r,n){i(this,t),this.begin=r,this.end=n,this.total=this.end-this.begin,this.type=e}return n(t,[{key:"update",value:function(t){return"in"===this.type?t>=this.begin?t:this.end-L(this.begin-t,this.total):"out"===this.type?t<=this.end?t:this.begin+L(t-this.end,this.total):void 0}}]),t}(),T=function(){function t(e,r,n){i(this,t),this.begin=r,this.end=n,this.total=this.end-this.begin,this.type=e}return n(t,[{key:"update",value:function(t){if("in"===this.type&&t<this.begin||"out"===this.type&&t>this.end){var e=t-this.end;return this.pingpong(e)}return t}},{key:"pingpong",value:function(t){return Math.floor(t/this.total)%2?this.begin+L(t,this.total):this.end-L(t,this.total)}}]),t}(),D={loopIn:function(t,e,i){var r=t[0].t,n=t.length-1,s=t[Math.min(n,i)].t;switch(e){case"cycle":return new M("in",r,s);case"pingpong":return new T("in",r,s)}return null},loopOut:function(t,e,i){var r=t.length-1,n=t[Math.max(0,r-i)].t,s=t[r].t;switch(e){case"cycle":return new M("out",n,s);case"pingpong":return new T("out",n,s)}return null}};function B(t){var e=t.match(S),i=e[2].split(/\s*,\s*/).map((function(t){return C.test(t)?t.replace(/"|'/g,""):parseInt(t)}));return{name:e[1],mode:i[0],offset:i[1]}}var F,V,N,U,q={hasSupportExpression:function(t){return t.x&&S.test(t.x)},getExpression:function(t){var e=B(t.x),i=e.name,r=e.mode,n=e.offset,s=void 0===n?0:n,o=0===s?t.k.length-1:s;return D[i]&&D[i](t.k,r,o)}},G=function(){function t(e,r){i(this,t),this.mult=void 0,this.v=void 0,this.value=void 0,this.newValue=void 0,this.expression=void 0,this.animated=void 0,this.mult=r||1,this.value=e.k,this.animated=e.a,q.hasSupportExpression(e)&&(this.expression=q.getExpression(e))}return n(t,[{key:"getValue",value:function(t,e,i,r){var n,s=i.t,o=r.t,a=i.s[e],u=(r.s||i.e)[e];if(1===i.h)return a;if(t>=o)n=1;else if(t<s)n=0;else{var l=i.beziers[e];l||(l=z.getBezierEasing(i.o.x[e],i.o.y[e],i.i.x[e],i.i.y[e]),i.beziers[e]=l),n=l((t-s)/(o-s))}return a+(u-a)*n}},{key:"reset",value:function(){}}]),t}(),X=function(t){o(r,G);var e=c(r);function r(t){var n,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return i(this,r),(n=e.call(this,t,s)).v=s?n.value*s:n.value,n}return n(r,[{key:"update",value:function(){this.v=this.value*this.mult}}]),r}(),$=function(t){o(r,G);var e=c(r);function r(t){var n,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;i(this,r);var o=(n=e.call(this,t,s)).value.length;n.v=new Float32Array(o),n.newValue=new Float32Array(o);for(var a=0;a<o;a+=1)n.v[a]=n.value[a]*n.mult;return n}return n(r,[{key:"update",value:function(){var t;t=this.value;for(var e=0,i=this.v.length;e<i;e++)this.v[e]=t[e]*this.mult}}]),r}(),H=function(t){o(r,G);var e=c(r);function r(t){var n,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return i(this,r),(n=e.call(this,t,s))._caching=void 0,n._caching={lastIndex:0,value:0},n.v=0,q.hasSupportExpression(t)&&(n.expression=q.getExpression(t)),n}return n(r,[{key:"reset",value:function(){this._caching={lastIndex:0,value:0}}},{key:"update",value:function(t){this.expression&&(t=this.expression.update(t));for(var e=this._caching,i=e.lastIndex,r=this.value,n=r[i],s=r[i+1],o=i,a=r.length-1;o<a;o++){if(n=r[o],s=r[o+1],o===a-1&&t>=s.t){n.h&&(n=s),i=0;break}if(s.t>t){i=o;break}}e.lastIndex=i,n.beziers=[],this.v=this.getValue(t,0,n,s)*this.mult}}]),r}(),J=function(t){o(r,G);var e=c(r);function r(t){var n,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;i(this,r),(n=e.call(this,t,s))._caching=void 0;var o=n.value[0].s.length;return n.newValue=new Float32Array(o),n.v=new Float32Array(o),n._caching={value:new Float32Array(o),lastPoint:0,addedLength:0,lastIndex:0},n}return n(r,[{key:"reset",value:function(){this._caching.lastPoint=0,this._caching.addedLength=0,this._caching.lastIndex=0}},{key:"update",value:function(t){this.expression&&(t=this.expression.update(t));for(var e=this._caching,i=e.lastIndex,r=this.value,n=this.newValue,s=i,o=r[i],a=r[i+1],u=r.length-1;s<u;s++){if(o=r[s],a=r[s+1],s===u-1&&t>=a.t){o.h&&(o=a),i=0;break}if(a.t>t){i=s;break}}if(e.lastIndex=i,o.to){var l=a.t,h=o.t;o.bezierData||(o.bezierData=z.buildBezierData(o.s,a.s||o.e,o.to,o.ti));for(var c=o.bezierData,p=c.points,f=(t-h)/(l-h),v=c.segmentLength*z.getBezierEasing(o.o.x,o.o.y,o.i.x,o.i.y,o.n)(f=Math.min(Math.max(0,f),1)),d=e.addedLength,y=e.lastPoint,g=y,m=p.length;g<m;g++){if(g===m-1){y=0,d=0;break}y=g;var _=p[g],b=p[g+1],w=b.partialLength;if(v>=d&&v<d+w){for(var x=(v-d)/w,k=0,P=_.point.length;k<P;k+=1)n[k]=_.point[k]+(b.point[k]-_.point[k])*x;break}d+=w}e.lastPoint=y,e.addedLength=d}else{o.beziers=[];for(var E=0,O=o.s.length;E<O;E+=1)n[E]=this.getValue(t,E,o,a)}for(var A=0,j=this.v.length;A<j;A++)this.v[A]=n[A]*this.mult}}]),r}(),K=function(){function t(e){i(this,t),this.p=void 0,this.x=void 0,this.y=void 0,this.z=void 0,this.a=void 0,this.s=void 0,this.or=void 0,this.r=void 0,this.o=void 0,this.rx=void 0,this.ry=void 0,this.rz=void 0,this.properties=[],this.autoOrient=!1;var r=t.create;e.p.k?(this.p=r(e.p,1),this.properties.push(this.p)):(e.p.x&&(this.x=r(e.p.x,1),this.properties.push(this.x)),e.p.y&&(this.y=r(e.p.y,1),this.properties.push(this.y)),e.p.z&&(this.z=r(e.p.z,1),this.properties.push(this.z))),this.a=r(e.a,1),this.properties.push(this.a),this.s=r(e.s,1,.01),this.properties.push(this.s),this.o=r(e.o,0,.01),this.properties.push(this.o),e.r?(this.r=r(e.r,0),this.properties.push(this.r)):e.rx||e.ry||e.rz?(e.rx&&(this.rx=r(e.rx,0),this.properties.push(this.rx)),e.ry&&(this.ry=r(e.ry,0),this.properties.push(this.ry)),e.rz&&(this.rz=r(e.rz,0),this.properties.push(this.rz))):e.or&&(this.or=r(e.or,1),this.properties.push(this.or)),this.properties.length||this.update()}return n(t,[{key:"reset",value:function(){for(var t=0,e=this.properties.length;t<e;t++)this.properties[t].reset()}},{key:"update",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.properties.length,i=0;i<e;i++)this.properties[i].update(t);this.autoOrient}}],[{key:"create",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return t.k.length?"number"==typeof t.k[0]?new $(t,i):e?new J(t,i):new H(t,i):new X(t,i)}}]),t}(),Q=function(){function t(e){i(this,t),this.transform=void 0,this.is3D=void 0,this.offsetTime=void 0,this.name=void 0,this.index=void 0,this.stretch=1,this.parent=null,this.inPoint=void 0,this.outPoint=void 0,this.timeRemapping=void 0,this.width=void 0,this.height=void 0,this.visible=!0,this.entity=void 0,this.startTime=0,this.treeIndex=[],this.childLayers=[],this.is3D=!!e.ddd,this.stretch=e.sr||1,this.name=e.nm||"",this.index=e.ind,this.timeRemapping=e.tm,this.width=e.w,this.height=e.h,this.inPoint=e.ip,this.outPoint=e.op,e.st&&(this.startTime=e.st),e.ks&&(this.transform=new K(e.ks))}return n(t,[{key:"reset",value:function(){this.transform&&this.transform.reset();for(var t=0;t<this.childLayers.length;t++)this.childLayers[t].reset()}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0,i=this.startTime,r=t/this.stretch;!0===e?this.visible=this.inPoint<=r&&this.outPoint>=r:!1===e&&(this.visible=!1),this.transform&&this.visible&&this.transform.update(r);for(var n=0;n<this.childLayers.length;n++)this.childLayers[n].update(r-i,this.visible)}},{key:"addChild",value:function(t){t.parent=this,t.entity.parent=this.entity,this.childLayers.push(t)}},{key:"destroy",value:function(){this.entity.parent=null,this.entity.destroy(),this.entity=null,this.transform=null,this.parent=null}}]),t}(),W=function(e){o(s,Q);var r=c(s);function s(e,n,o,a){var u;if(i(this,s),(u=r.call(this,e)).layers=void 0,u.comps=void 0,u.layers=e.layers,u.comps=e.comps,o)u.entity=o,a&&(u.entity.name=a);else{var l=new t.Entity(n,a);u.entity=l}return u}return n(s,[{key:"destroy",value:function(){p(a(s.prototype),"destroy",this).call(this),this.layers=null,this.comps=null}}]),s}(),Y=function(e){o(s,Q);var r=c(s);function s(e,n,o,a){var u;if(i(this,s),(u=r.call(this,e)).sprite=void 0,u.spriteRenderer=void 0,e.refId)if(a){u.entity=a;var l=a.getComponent(t.SpriteRenderer);u.spriteRenderer=l,u.sprite=l.sprite;var h=u.sprite,c=h.atlasRegion,p=h.texture;l._renderSortId=u.index,l._customRootEntity=o,u.width=c.width*p.width,u.height=c.height*p.height}else{u.sprite=n.getSprite(e.refId);var f=u.sprite,v=f.atlasRegion,d=f.texture,y=new t.Entity(o.engine,e.nm),g=y.addComponent(t.SpriteRenderer);g.sprite=u.sprite,g._renderSortId=u.index,g._customRootEntity=o,u.entity=y,u.spriteRenderer=g,u.width=v.width*d.width,u.height=v.height*d.height}return u}return n(s,[{key:"destroy",value:function(){p(a(s.prototype),"destroy",this).call(this),this.sprite=null,this.spriteRenderer=null}}]),s}(),Z=(F=function(e){o(s,t.Script);var r=c(s);function s(){var t;i(this,s);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(t=r.call.apply(r,[this].concat(n))).repeats=0,t.isLooping=!1,t.isAlternate=!1,t.direction=1,t.speed=1,t._width=void 0,t._height=void 0,t._isPlaying=!1,t._frame=0,t._resource=void 0,t._clips=void 0,t._clip=void 0,t._clipEndCallbacks={},t._autoPlay=!1,d(t,"_root",V,l(t)),d(t,"_elements",N,l(t)),t}return n(s,[{key:"resource",get:function(){return this._resource},set:function(t){this._resource&&(this.pause(),this._destroyElements()),this._resource=t,this._width=t.width,this._height=t.height,this._clips=t.clips,this._createElements(t),this.play(),this.onUpdate(0),this.autoPlay||this.pause()}},{key:"autoPlay",get:function(){return this._autoPlay},set:function(t){this._autoPlay=t,t&&this.play()}},{key:"play",value:function(t){var e=this;if(t){var i=this._clips[t];this._clip=i}else this._clip=null;return this._isPlaying=!0,this._frame=0,new Promise((function(i){t?e._clipEndCallbacks[t]=i:e._clipEndCallbacks.ALL=i}))}},{key:"pause",value:function(){this._isPlaying=!1}},{key:"_createLayerElements",value:function(e,i,r,n){for(var s,o,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,u=arguments.length>5?arguments[5]:void 0,l=0,h=e.length;l<h;l++){var c=e[l],p=null;if(void 0===c.td){var f=n.treeIndex.concat(l),v=a;e.isComp&&(c.ind=n.index-(h-1-l)*a/h,v=a/h);var d=u&&this._findEntityInTree(f);switch(c.ty){case 0:p=new W(c,this.engine,d,c.id);break;case 2:var y=(p=new Y(c,this._resource.atlas,this.entity,d)).sprite.bounds;t.BoundingBox.merge(y,i,i),p.spriteRenderer._customLocalBounds=i;break;case 3:0===(null==c||null===(s=c.ks)||void 0===s||null===(o=s.o)||void 0===o?void 0:o.k)&&(c.ks.o.k=100),p=new W(c,this.engine,void 0,c.id)}p&&(p.treeIndex=f,r.push(p),n.addChild(p),c.layers&&this._createLayerElements(c.layers,i,r,p,v,u))}}}},{key:"_findEntityInTree",value:function(t){for(var e,i=0,r=t.length;i<r;i++){var n=t[i];e=e?e.children[n]:this.entity.children[n]}return e}},{key:"_createElements",value:function(e,i){var r=new W(e,this.engine,this.entity);this._root=r;var n=r.layers,s=[],o=new t.BoundingBox,a=Number.MIN_SAFE_INTEGER,u=Number.MAX_SAFE_INTEGER;o.min.setValue(u,u,u),o.max.setValue(a,a,a),this._createLayerElements(n,o,s,r,1,i),this._elements=s}},{key:"_updateElements",value:function(t){this._root.update(t);for(var e=this._elements,i=0,r=e.length;i<r;i++){var n=e[i];this._updateElement(n)}}},{key:"_updateElement",value:function(e){var i,r=e.transform,n=e.entity,s=e.sprite,o=e.spriteRenderer,a=e.parent,u=e.width,l=e.height,h=n.transform,c=r.a.v,p=r.s.v,f=r.o.v,v=s?s.pixelsPerUnit:128,d=0,y=0,g=0;if(r.p){var m=r.p.v;d=m[0],y=m[1],g=m[2]}else r.x&&(d=r.x.v),r.y&&(y=r.y.v),r.z&&(g=r.z.v);var _=0,b=0,w=0;if(e.visible){if(r.r)w=-r.r.v;else if(r.rx||r.ry)_=r.rx?r.rx.v:0,b=r.ry?r.ry.v:0,w=r.rz?r.rz.v:0;else if(r.or){var x=r.or.v;_=x[0],b=x[1],w=x[2]}s&&(o.color.setValue(1,1,1,f),s.pivot=new t.Vector2(c[0]/u,(l-c[1])/l)),n.isActive=e.visible,h.setScale(p[0],p[1],p[2]),h.setRotation(_,b,w),null!=a&&null!==(i=a.transform)&&void 0!==i&&i.a?h.setPosition((d-a.transform.a.v[0])/v,(-y+a.transform.a.v[1])/v,g/v):h.setPosition((d-this._width/2)/v,(-y+this._height/2)/v,g/v)}else n.isActive=e.visible}},{key:"_resetElements",value:function(){for(var t=this._elements,e=0,i=t.length;e<i;e++)t[e].reset()}},{key:"onUpdate",value:function(t){if(!this._isPlaying||!this._resource)return null;var e=this.direction*this.speed*t;this._frame+=e/this._resource.timePerFrame;var i=this._clip;if(this._spill()){var r=this._resource.duration;if(this._resetElements(),this.repeats>0||this.isLooping)this.repeats>0&&--this.repeats,this.isAlternate?(this.direction*=-1,this._frame=R(this._frame,0,i?i.end-i.start:r)):(this.direction=1,this._frame=L(this._frame,i?i.end-i.start:r));else if(i){if(this._frame>=i.end-i.start){var n=this._clipEndCallbacks[i.name];n&&n(i)}this._frame=I(this._frame,0,i.end-i.start)}else{if(this._frame>=r){var s=this._clipEndCallbacks.ALL;s&&s()}this._frame=I(this._frame,0,r)}}i?this._updateElements(this._resource.inPoint+this._frame+i.start):this._updateElements(this._resource.inPoint+this._frame)}},{key:"_spill",value:function(){var t;if(this._clip){var e=this._clip;t=e.end-e.start}else t=this._resource.duration;var i=this._frame<=0&&-1===this.direction,r=this._frame>=t&&1===this.direction;return i||r}},{key:"_cloneTo",value:function(t){t._createElements(this._resource,!0)}},{key:"_destroyElements",value:function(){for(var t=this._elements,e=0,i=t.length;e<i;e++)t[e].destroy()}}]),s}(),V=y(F.prototype,"_root",[t.ignoreClone],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=y(F.prototype,"_elements",[t.ignoreClone],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F),tt=function(r){o(u,t.EngineObject);var a=c(u);function u(t,e,r){var n;i(this,u),(n=a.call(this,t)).duration=void 0,n.timePerFrame=void 0,n.inPoint=void 0,n.outPoint=void 0,n.height=void 0,n.width=void 0,n.layers=void 0,n.animations=void 0,n.comps=void 0,n.atlas=void 0,n.name=void 0,n.clips=void 0,n.timePerFrame=1e3/e.fr,n.duration=Math.floor(e.op-e.ip),n.width=e.w,n.height=e.h,n.inPoint=e.ip,n.outPoint=e.op,n.atlas=r,n.layers=e.layers,n.comps=e.assets,n.name=e.nm,n.clips={};var s={},o=l(n).comps;if(o){for(var h=0,c=o.length;h<c;h++){var p=o[h];p.id&&(s[p.id]=p)}for(var f=0,v=n.layers.length;f<v;f++){var d=n.layers[f],y=d.refId;y&&s[y]&&(d.layers=s[y].layers)}}return n._buildTree(n.layers,s),e.lolitaAnimations&&n._parseAnimations(e.lolitaAnimations),n}return n(u,[{key:"_parseAnimations",value:function(t){var i=this;t.forEach((function(t){i.clips[t.name]=function(t){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?e(Object(r),!0).forEach((function(e){s(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},t)}))}},{key:"_buildTree",value:function(t,e){for(var i={},r=0,n=t.length;r<n;r++){var s=t[r];i[s.ind]=s}for(var o=[],a=0,u=t.length;a<u;a++){var l=t[a],h=l.refId,c=l.parent;c&&(i[c].layers||(i[c].layers=[]),i[c].layers.push(l),o.push(l)),h&&e[h]&&(l.layers=e[h].layers,l.layers.isComp=!0,this._buildTree(l.layers,e))}for(var p=0,f=o.length;p<f;p++){var v=t.indexOf(o[p]);t.splice(v,1)}}}]),u}(),et=t.resourceLoader("lottie",["json"])(U=function(e){o(s,t.Loader);var r=c(s);function s(){return i(this,s),r.apply(this,arguments)}return n(s,[{key:"load",value:function(e,i){var r=e.urls,n=this.request(r[0],i),s=i.load({url:r[1],type:t.AssetType.SpriteAtlas});return t.AssetPromise.all([n,s]).then((function(e){var r=f(e,2),n=r[0],s=r[1],o=i.engine,a=new tt(o,n,s),u=new t.Entity(o);return u.addComponent(Z).resource=a,u}))}}]),s}())||U,it=function(e){o(s,t.SchemaResource);var r=c(s);function s(){return i(this,s),r.apply(this,arguments)}return n(s,[{key:"load",value:function(t,e){var i=this,r=e.props,n=r.json,s=r.atlas;return t.load({urls:[n,s],type:"lottie"}).then((function(t){i._resource=t.getComponent(Z).resource}))}}]),s}();t.registerResource("lottie",it),t.Parser.registerComponents("o3",{LottieAnimation:Z}),exports.LottieAnimation=Z,exports.LottieLoader=et,exports.LottieResource=it;
