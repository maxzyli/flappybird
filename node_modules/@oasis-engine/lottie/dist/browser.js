!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("oasis-engine")):"function"==typeof define&&define.amd?define(["exports","oasis-engine"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["engine-lottie"]={},t.oasisEngine)}(this,(function(t,e){"use strict";function i(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function s(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}function o(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}function u(t){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},u(t)}function l(t,e){return l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},l(t,e)}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}function f(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,r=u(t);if(e){var n=u(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return c(this,i)}}function p(t,e,i){return p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=u(t)););return t}(t,e);if(r){var n=Object.getOwnPropertyDescriptor(r,e);return n.get?n.get.call(i):n.value}},p(t,e,i||t)}function v(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==i)return;var r,n,s=[],o=!0,a=!1;try{for(i=i.call(t);!(o=(r=i.next()).done)&&(s.push(r.value),!e||s.length!==e);o=!0);}catch(t){a=!0,n=t}finally{try{o||null==i.return||i.return()}finally{if(a)throw n}}return s}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return d(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return d(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function y(t,e,i,r){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function g(t,e,i,r,n){var s={};return Object.keys(r).forEach((function(t){s[t]=r[t]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=i.slice().reverse().reduce((function(i,r){return r(t,e,i)||i}),s),n&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(n):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(t,e,s),s=null),s}var m=.1,_="function"==typeof Float32Array;function b(t,e){return 1-3*e+3*t}function w(t,e){return 3*e-6*t}function x(t){return 3*t}function k(t,e,i){return((b(e,i)*t+w(e,i))*t+x(e))*t}function E(t,e,i){return 3*b(e,i)*t*t+2*w(e,i)*t+x(e)}function P(t){return t}var O=function(t,e,i,r){if(!(0<=t&&t<=1&&0<=i&&i<=1))throw new Error("bezier x values must be in [0, 1] range");if(t===e&&i===r)return P;for(var n=_?new Float32Array(11):new Array(11),s=0;s<11;++s)n[s]=k(s*m,t,i);function o(e){for(var r=0,s=1;10!==s&&n[s]<=e;++s)r+=m;--s;var o=r+(e-n[s])/(n[s+1]-n[s])*m,a=E(o,t,i);return a>=.001?function(t,e,i,r){for(var n=0;n<4;++n){var s=E(e,i,r);if(0===s)return e;e-=(k(e,i,r)-t)/s}return e}(e,o,t,i):0===a?o:function(t,e,i,r,n){var s,o,a=0;do{(s=k(o=e+(i-e)/2,r,n)-t)>0?i=o:e=o}while(Math.abs(s)>1e-7&&++a<10);return o}(e,r,r+m,t,i)}return function(t){return 0===t?0:1===t?1:k(o(t),e,r)}},z={};var j={};var A={buildBezierData:function(t,e,i,r){var n=(t[0]+"_"+t[1]+"_"+e[0]+"_"+e[1]+"_"+i[0]+"_"+i[1]+"_"+r[0]+"_"+r[1]).replace(/\./g,"p");if(!j[n]){for(var s,o=0,a=[],u=0;u<200;u++){for(var l=i.length,h=new Array(l),c=u/199,f=0,p=0;p<l;p+=1){var v=Math.pow(1-c,3)*t[p]+3*Math.pow(1-c,2)*c*(t[p]+i[p])+3*(1-c)*Math.pow(c,2)*(e[p]+r[p])+Math.pow(c,3)*e[p];h[p]=v,s&&(f+=Math.pow(h[p]-s[p],2))}o+=f=Math.sqrt(f),a.push({partialLength:f,point:h}),s=h}j[n]={segmentLength:o,points:a}}return j[n]},getBezierEasing:function(t,e,i,r,n){var s=n||("bez_"+t+"_"+e+"_"+i+"_"+r).replace(/\./g,"p"),o=z[s];return o||(o=O(t,e,i,r),z[s]=o,o)}};function L(t){return Object.prototype.toString.call(t)}R=L([]),function(){var t=L("s")}(),function(){var t=L(1)}(),function(){var t=L((function(){}))}(),function(){var t=L(!0)}(),function(){var t=L({})}();var R,I=function(t,e){return(t%e+e)%e},S=function(t,e,i){return t<e?2*e-t:t>i?2*i-t:t},T=function(t,e,i){return t<e?e:t>i?i:t},C=/(loopIn|loopOut)\(([^)]+)/,M=/["']\w+["']/,D=function(){function t(e,i,n){r(this,t),this.begin=i,this.end=n,this.total=this.end-this.begin,this.type=e}return s(t,[{key:"update",value:function(t){return"in"===this.type?t>=this.begin?t:this.end-I(this.begin-t,this.total):"out"===this.type?t<=this.end?t:this.begin+I(t-this.end,this.total):void 0}}]),t}(),B=function(){function t(e,i,n){r(this,t),this.begin=i,this.end=n,this.total=this.end-this.begin,this.type=e}return s(t,[{key:"update",value:function(t){if("in"===this.type&&t<this.begin||"out"===this.type&&t>this.end){var e=t-this.end;return this.pingpong(e)}return t}},{key:"pingpong",value:function(t){return Math.floor(t/this.total)%2?this.begin+I(t,this.total):this.end-I(t,this.total)}}]),t}(),F={loopIn:function(t,e,i){var r=t[0].t,n=t.length-1,s=t[Math.min(n,i)].t;switch(e){case"cycle":return new D("in",r,s);case"pingpong":return new B("in",r,s)}return null},loopOut:function(t,e,i){var r=t.length-1,n=t[Math.max(0,r-i)].t,s=t[r].t;switch(e){case"cycle":return new D("out",n,s);case"pingpong":return new B("out",n,s)}return null}};function V(t){var e=t.match(C),i=e[2].split(/\s*,\s*/).map((function(t){return M.test(t)?t.replace(/"|'/g,""):parseInt(t)}));return{name:e[1],mode:i[0],offset:i[1]}}var N,U,q,G,X={hasSupportExpression:function(t){return t.x&&C.test(t.x)},getExpression:function(t){var e=V(t.x),i=e.name,r=e.mode,n=e.offset,s=void 0===n?0:n,o=0===s?t.k.length-1:s;return F[i]&&F[i](t.k,r,o)}},$=function(){function t(e,i){r(this,t),this.mult=void 0,this.v=void 0,this.value=void 0,this.newValue=void 0,this.expression=void 0,this.animated=void 0,this.mult=i||1,this.value=e.k,this.animated=e.a,X.hasSupportExpression(e)&&(this.expression=X.getExpression(e))}return s(t,[{key:"getValue",value:function(t,e,i,r){var n,s=i.t,o=r.t,a=i.s[e],u=(r.s||i.e)[e];if(1===i.h)return a;if(t>=o)n=1;else if(t<s)n=0;else{var l=i.beziers[e];l||(l=A.getBezierEasing(i.o.x[e],i.o.y[e],i.i.x[e],i.i.y[e]),i.beziers[e]=l),n=l((t-s)/(o-s))}return a+(u-a)*n}},{key:"reset",value:function(){}}]),t}(),H=function(t){a(i,t);var e=f(i);function i(t){var n,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return r(this,i),(n=e.call(this,t,s)).v=s?n.value*s:n.value,n}return s(i,[{key:"update",value:function(){this.v=this.value*this.mult}}]),i}($),J=function(t){a(i,t);var e=f(i);function i(t){var n,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;r(this,i);var o=(n=e.call(this,t,s)).value.length;n.v=new Float32Array(o),n.newValue=new Float32Array(o);for(var a=0;a<o;a+=1)n.v[a]=n.value[a]*n.mult;return n}return s(i,[{key:"update",value:function(){var t;t=this.value;for(var e=0,i=this.v.length;e<i;e++)this.v[e]=t[e]*this.mult}}]),i}($),K=function(t){a(i,t);var e=f(i);function i(t){var n,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return r(this,i),(n=e.call(this,t,s))._caching=void 0,n._caching={lastIndex:0,value:0},n.v=0,X.hasSupportExpression(t)&&(n.expression=X.getExpression(t)),n}return s(i,[{key:"reset",value:function(){this._caching={lastIndex:0,value:0}}},{key:"update",value:function(t){this.expression&&(t=this.expression.update(t));for(var e=this._caching,i=e.lastIndex,r=this.value,n=r[i],s=r[i+1],o=i,a=r.length-1;o<a;o++){if(n=r[o],s=r[o+1],o===a-1&&t>=s.t){n.h&&(n=s),i=0;break}if(s.t>t){i=o;break}}e.lastIndex=i,n.beziers=[],this.v=this.getValue(t,0,n,s)*this.mult}}]),i}($),Q=function(t){a(i,t);var e=f(i);function i(t){var n,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;r(this,i),(n=e.call(this,t,s))._caching=void 0;var o=n.value[0].s.length;return n.newValue=new Float32Array(o),n.v=new Float32Array(o),n._caching={value:new Float32Array(o),lastPoint:0,addedLength:0,lastIndex:0},n}return s(i,[{key:"reset",value:function(){this._caching.lastPoint=0,this._caching.addedLength=0,this._caching.lastIndex=0}},{key:"update",value:function(t){this.expression&&(t=this.expression.update(t));for(var e=this._caching,i=e.lastIndex,r=this.value,n=this.newValue,s=i,o=r[i],a=r[i+1],u=r.length-1;s<u;s++){if(o=r[s],a=r[s+1],s===u-1&&t>=a.t){o.h&&(o=a),i=0;break}if(a.t>t){i=s;break}}if(e.lastIndex=i,o.to){var l=a.t,h=o.t;o.bezierData||(o.bezierData=A.buildBezierData(o.s,a.s||o.e,o.to,o.ti));for(var c=o.bezierData,f=c.points,p=(t-h)/(l-h),v=c.segmentLength*A.getBezierEasing(o.o.x,o.o.y,o.i.x,o.i.y,o.n)(p=Math.min(Math.max(0,p),1)),d=e.addedLength,y=e.lastPoint,g=y,m=f.length;g<m;g++){if(g===m-1){y=0,d=0;break}y=g;var _=f[g],b=f[g+1],w=b.partialLength;if(v>=d&&v<d+w){for(var x=(v-d)/w,k=0,E=_.point.length;k<E;k+=1)n[k]=_.point[k]+(b.point[k]-_.point[k])*x;break}d+=w}e.lastPoint=y,e.addedLength=d}else{o.beziers=[];for(var P=0,O=o.s.length;P<O;P+=1)n[P]=this.getValue(t,P,o,a)}for(var z=0,j=this.v.length;z<j;z++)this.v[z]=n[z]*this.mult}}]),i}($),W=function(){function t(e){r(this,t),this.p=void 0,this.x=void 0,this.y=void 0,this.z=void 0,this.a=void 0,this.s=void 0,this.or=void 0,this.r=void 0,this.o=void 0,this.rx=void 0,this.ry=void 0,this.rz=void 0,this.properties=[],this.autoOrient=!1;var i=t.create;e.p.k?(this.p=i(e.p,1),this.properties.push(this.p)):(e.p.x&&(this.x=i(e.p.x,1),this.properties.push(this.x)),e.p.y&&(this.y=i(e.p.y,1),this.properties.push(this.y)),e.p.z&&(this.z=i(e.p.z,1),this.properties.push(this.z))),this.a=i(e.a,1),this.properties.push(this.a),this.s=i(e.s,1,.01),this.properties.push(this.s),this.o=i(e.o,0,.01),this.properties.push(this.o),e.r?(this.r=i(e.r,0),this.properties.push(this.r)):e.rx||e.ry||e.rz?(e.rx&&(this.rx=i(e.rx,0),this.properties.push(this.rx)),e.ry&&(this.ry=i(e.ry,0),this.properties.push(this.ry)),e.rz&&(this.rz=i(e.rz,0),this.properties.push(this.rz))):e.or&&(this.or=i(e.or,1),this.properties.push(this.or)),this.properties.length||this.update()}return s(t,[{key:"reset",value:function(){for(var t=0,e=this.properties.length;t<e;t++)this.properties[t].reset()}},{key:"update",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.properties.length,i=0;i<e;i++)this.properties[i].update(t);this.autoOrient}}],[{key:"create",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return t.k.length?"number"==typeof t.k[0]?new J(t,i):e?new Q(t,i):new K(t,i):new H(t,i)}}]),t}(),Y=function(){function t(e){r(this,t),this.transform=void 0,this.is3D=void 0,this.offsetTime=void 0,this.name=void 0,this.index=void 0,this.stretch=1,this.parent=null,this.inPoint=void 0,this.outPoint=void 0,this.timeRemapping=void 0,this.width=void 0,this.height=void 0,this.visible=!0,this.entity=void 0,this.startTime=0,this.treeIndex=[],this.childLayers=[],this.is3D=!!e.ddd,this.stretch=e.sr||1,this.name=e.nm||"",this.index=e.ind,this.timeRemapping=e.tm,this.width=e.w,this.height=e.h,this.inPoint=e.ip,this.outPoint=e.op,e.st&&(this.startTime=e.st),e.ks&&(this.transform=new W(e.ks))}return s(t,[{key:"reset",value:function(){this.transform&&this.transform.reset();for(var t=0;t<this.childLayers.length;t++)this.childLayers[t].reset()}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0,i=this.startTime,r=t/this.stretch;!0===e?this.visible=this.inPoint<=r&&this.outPoint>=r:!1===e&&(this.visible=!1),this.transform&&this.visible&&this.transform.update(r);for(var n=0;n<this.childLayers.length;n++)this.childLayers[n].update(r-i,this.visible)}},{key:"addChild",value:function(t){t.parent=this,t.entity.parent=this.entity,this.childLayers.push(t)}},{key:"destroy",value:function(){this.entity.parent=null,this.entity.destroy(),this.entity=null,this.transform=null,this.parent=null}}]),t}(),Z=function(t){a(n,t);var i=f(n);function n(t,s,o,a){var u;if(r(this,n),(u=i.call(this,t)).layers=void 0,u.comps=void 0,u.layers=t.layers,u.comps=t.comps,o)u.entity=o,a&&(u.entity.name=a);else{var l=new e.Entity(s,a);u.entity=l}return u}return s(n,[{key:"destroy",value:function(){p(u(n.prototype),"destroy",this).call(this),this.layers=null,this.comps=null}}]),n}(Y),tt=function(t){a(n,t);var i=f(n);function n(t,s,o,a){var u;if(r(this,n),(u=i.call(this,t)).sprite=void 0,u.spriteRenderer=void 0,t.refId)if(a){u.entity=a;var l=a.getComponent(e.SpriteRenderer);u.spriteRenderer=l,u.sprite=l.sprite;var h=u.sprite,c=h.atlasRegion,f=h.texture;l._renderSortId=u.index,l._customRootEntity=o,u.width=c.width*f.width,u.height=c.height*f.height}else{u.sprite=s.getSprite(t.refId);var p=u.sprite,v=p.atlasRegion,d=p.texture,y=new e.Entity(o.engine,t.nm),g=y.addComponent(e.SpriteRenderer);g.sprite=u.sprite,g._renderSortId=u.index,g._customRootEntity=o,u.entity=y,u.spriteRenderer=g,u.width=v.width*d.width,u.height=v.height*d.height}return u}return s(n,[{key:"destroy",value:function(){p(u(n.prototype),"destroy",this).call(this),this.sprite=null,this.spriteRenderer=null}}]),n}(Y),et=(N=function(t){a(n,t);var i=f(n);function n(){var t;r(this,n);for(var e=arguments.length,s=new Array(e),o=0;o<e;o++)s[o]=arguments[o];return(t=i.call.apply(i,[this].concat(s))).repeats=0,t.isLooping=!1,t.isAlternate=!1,t.direction=1,t.speed=1,t._width=void 0,t._height=void 0,t._isPlaying=!1,t._frame=0,t._resource=void 0,t._clips=void 0,t._clip=void 0,t._clipEndCallbacks={},t._autoPlay=!1,y(t,"_root",U,h(t)),y(t,"_elements",q,h(t)),t}return s(n,[{key:"resource",get:function(){return this._resource},set:function(t){this._resource&&(this.pause(),this._destroyElements()),this._resource=t,this._width=t.width,this._height=t.height,this._clips=t.clips,this._createElements(t),this.play(),this.onUpdate(0),this.autoPlay||this.pause()}},{key:"autoPlay",get:function(){return this._autoPlay},set:function(t){this._autoPlay=t,t&&this.play()}},{key:"play",value:function(t){var e=this;if(t){var i=this._clips[t];this._clip=i}else this._clip=null;return this._isPlaying=!0,this._frame=0,new Promise((function(i){t?e._clipEndCallbacks[t]=i:e._clipEndCallbacks.ALL=i}))}},{key:"pause",value:function(){this._isPlaying=!1}},{key:"_createLayerElements",value:function(t,i,r,n){for(var s,o,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,u=arguments.length>5?arguments[5]:void 0,l=0,h=t.length;l<h;l++){var c=t[l],f=null;if(void 0===c.td){var p=n.treeIndex.concat(l),v=a;t.isComp&&(c.ind=n.index-(h-1-l)*a/h,v=a/h);var d=u&&this._findEntityInTree(p);switch(c.ty){case 0:f=new Z(c,this.engine,d,c.id);break;case 2:var y=(f=new tt(c,this._resource.atlas,this.entity,d)).sprite.bounds;e.BoundingBox.merge(y,i,i),f.spriteRenderer._customLocalBounds=i;break;case 3:0===(null==c||null===(s=c.ks)||void 0===s||null===(o=s.o)||void 0===o?void 0:o.k)&&(c.ks.o.k=100),f=new Z(c,this.engine,void 0,c.id)}f&&(f.treeIndex=p,r.push(f),n.addChild(f),c.layers&&this._createLayerElements(c.layers,i,r,f,v,u))}}}},{key:"_findEntityInTree",value:function(t){for(var e,i=0,r=t.length;i<r;i++){var n=t[i];e=e?e.children[n]:this.entity.children[n]}return e}},{key:"_createElements",value:function(t,i){var r=new Z(t,this.engine,this.entity);this._root=r;var n=r.layers,s=[],o=new e.BoundingBox,a=Number.MIN_SAFE_INTEGER,u=Number.MAX_SAFE_INTEGER;o.min.setValue(u,u,u),o.max.setValue(a,a,a),this._createLayerElements(n,o,s,r,1,i),this._elements=s}},{key:"_updateElements",value:function(t){this._root.update(t);for(var e=this._elements,i=0,r=e.length;i<r;i++){var n=e[i];this._updateElement(n)}}},{key:"_updateElement",value:function(t){var i,r=t.transform,n=t.entity,s=t.sprite,o=t.spriteRenderer,a=t.parent,u=t.width,l=t.height,h=n.transform,c=r.a.v,f=r.s.v,p=r.o.v,v=s?s.pixelsPerUnit:128,d=0,y=0,g=0;if(r.p){var m=r.p.v;d=m[0],y=m[1],g=m[2]}else r.x&&(d=r.x.v),r.y&&(y=r.y.v),r.z&&(g=r.z.v);var _=0,b=0,w=0;if(t.visible){if(r.r)w=-r.r.v;else if(r.rx||r.ry)_=r.rx?r.rx.v:0,b=r.ry?r.ry.v:0,w=r.rz?r.rz.v:0;else if(r.or){var x=r.or.v;_=x[0],b=x[1],w=x[2]}s&&(o.color.setValue(1,1,1,p),s.pivot=new e.Vector2(c[0]/u,(l-c[1])/l)),n.isActive=t.visible,h.setScale(f[0],f[1],f[2]),h.setRotation(_,b,w),null!=a&&null!==(i=a.transform)&&void 0!==i&&i.a?h.setPosition((d-a.transform.a.v[0])/v,(-y+a.transform.a.v[1])/v,g/v):h.setPosition((d-this._width/2)/v,(-y+this._height/2)/v,g/v)}else n.isActive=t.visible}},{key:"_resetElements",value:function(){for(var t=this._elements,e=0,i=t.length;e<i;e++)t[e].reset()}},{key:"onUpdate",value:function(t){if(!this._isPlaying||!this._resource)return null;var e=this.direction*this.speed*t;this._frame+=e/this._resource.timePerFrame;var i=this._clip;if(this._spill()){var r=this._resource.duration;if(this._resetElements(),this.repeats>0||this.isLooping)this.repeats>0&&--this.repeats,this.isAlternate?(this.direction*=-1,this._frame=S(this._frame,0,i?i.end-i.start:r)):(this.direction=1,this._frame=I(this._frame,i?i.end-i.start:r));else if(i){if(this._frame>=i.end-i.start){var n=this._clipEndCallbacks[i.name];n&&n(i)}this._frame=T(this._frame,0,i.end-i.start)}else{if(this._frame>=r){var s=this._clipEndCallbacks.ALL;s&&s()}this._frame=T(this._frame,0,r)}}i?this._updateElements(this._resource.inPoint+this._frame+i.start):this._updateElements(this._resource.inPoint+this._frame)}},{key:"_spill",value:function(){var t;if(this._clip){var e=this._clip;t=e.end-e.start}else t=this._resource.duration;var i=this._frame<=0&&-1===this.direction,r=this._frame>=t&&1===this.direction;return i||r}},{key:"_cloneTo",value:function(t){t._createElements(this._resource,!0)}},{key:"_destroyElements",value:function(){for(var t=this._elements,e=0,i=t.length;e<i;e++)t[e].destroy()}}]),n}(e.Script),U=g(N.prototype,"_root",[e.ignoreClone],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=g(N.prototype,"_elements",[e.ignoreClone],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N),it=function(t){a(n,t);var e=f(n);function n(t,i,s){var o;r(this,n),(o=e.call(this,t)).duration=void 0,o.timePerFrame=void 0,o.inPoint=void 0,o.outPoint=void 0,o.height=void 0,o.width=void 0,o.layers=void 0,o.animations=void 0,o.comps=void 0,o.atlas=void 0,o.name=void 0,o.clips=void 0,o.timePerFrame=1e3/i.fr,o.duration=Math.floor(i.op-i.ip),o.width=i.w,o.height=i.h,o.inPoint=i.ip,o.outPoint=i.op,o.atlas=s,o.layers=i.layers,o.comps=i.assets,o.name=i.nm,o.clips={};var a={},u=h(o).comps;if(u){for(var l=0,c=u.length;l<c;l++){var f=u[l];f.id&&(a[f.id]=f)}for(var p=0,v=o.layers.length;p<v;p++){var d=o.layers[p],y=d.refId;y&&a[y]&&(d.layers=a[y].layers)}}return o._buildTree(o.layers,a),i.lolitaAnimations&&o._parseAnimations(i.lolitaAnimations),o}return s(n,[{key:"_parseAnimations",value:function(t){var e=this;t.forEach((function(t){e.clips[t.name]=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(Object(r),!0).forEach((function(e){o(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},t)}))}},{key:"_buildTree",value:function(t,e){for(var i={},r=0,n=t.length;r<n;r++){var s=t[r];i[s.ind]=s}for(var o=[],a=0,u=t.length;a<u;a++){var l=t[a],h=l.refId,c=l.parent;c&&(i[c].layers||(i[c].layers=[]),i[c].layers.push(l),o.push(l)),h&&e[h]&&(l.layers=e[h].layers,l.layers.isComp=!0,this._buildTree(l.layers,e))}for(var f=0,p=o.length;f<p;f++){var v=t.indexOf(o[f]);t.splice(v,1)}}}]),n}(e.EngineObject),rt=e.resourceLoader("lottie",["json"])(G=function(t){a(n,t);var i=f(n);function n(){return r(this,n),i.apply(this,arguments)}return s(n,[{key:"load",value:function(t,i){var r=t.urls,n=this.request(r[0],i),s=i.load({url:r[1],type:e.AssetType.SpriteAtlas});return e.AssetPromise.all([n,s]).then((function(t){var r=v(t,2),n=r[0],s=r[1],o=i.engine,a=new it(o,n,s),u=new e.Entity(o);return u.addComponent(et).resource=a,u}))}}]),n}(e.Loader))||G,nt=function(t){a(i,t);var e=f(i);function i(){return r(this,i),e.apply(this,arguments)}return s(i,[{key:"load",value:function(t,e){var i=this,r=e.props,n=r.json,s=r.atlas;return t.load({urls:[n,s],type:"lottie"}).then((function(t){i._resource=t.getComponent(et).resource}))}}]),i}(e.SchemaResource);e.registerResource("lottie",nt),e.Parser.registerComponents("o3",{LottieAnimation:et}),t.LottieAnimation=et,t.LottieLoader=rt,t.LottieResource=nt,Object.defineProperty(t,"__esModule",{value:!0})}));
