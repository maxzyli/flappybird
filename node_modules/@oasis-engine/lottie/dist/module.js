import{Entity as t,SpriteRenderer as e,BoundingBox as i,Vector2 as r,Script as n,ignoreClone as s,EngineObject as o,resourceLoader as a,AssetType as u,AssetPromise as h,Loader as l,registerResource as c,SchemaResource as f,Parser as p}from"oasis-engine";function v(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function y(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function g(t,e,i){return e&&y(t.prototype,e),i&&y(t,i),t}function m(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&w(t,e)}function b(t){return b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},b(t)}function w(t,e){return w=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},w(t,e)}function k(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function x(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return k(t)}function P(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,r=b(t);if(e){var n=b(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return x(this,i)}}function E(t,e,i){return E="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=b(t)););return t}(t,e);if(r){var n=Object.getOwnPropertyDescriptor(r,e);return n.get?n.get.call(i):n.value}},E(t,e,i||t)}function O(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==i)return;var r,n,s=[],o=!0,a=!1;try{for(i=i.call(t);!(o=(r=i.next()).done)&&(s.push(r.value),!e||s.length!==e);o=!0);}catch(t){a=!0,n=t}finally{try{o||null==i.return||i.return()}finally{if(a)throw n}}return s}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return z(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return z(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function j(t,e,i,r){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function A(t,e,i,r,n){var s={};return Object.keys(r).forEach((function(t){s[t]=r[t]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=i.slice().reverse().reduce((function(i,r){return r(t,e,i)||i}),s),n&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(n):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(t,e,s),s=null),s}var I="function"==typeof Float32Array;function L(t,e){return 1-3*e+3*t}function R(t,e){return 3*e-6*t}function S(t){return 3*t}function C(t,e,i){return((L(e,i)*t+R(e,i))*t+S(e))*t}function M(t,e,i){return 3*L(e,i)*t*t+2*R(e,i)*t+S(e)}function T(t){return t}var D=function(t,e,i,r){if(!(0<=t&&t<=1&&0<=i&&i<=1))throw new Error("bezier x values must be in [0, 1] range");if(t===e&&i===r)return T;for(var n=I?new Float32Array(11):new Array(11),s=0;s<11;++s)n[s]=C(.1*s,t,i);function o(e){for(var r=0,s=1;10!==s&&n[s]<=e;++s)r+=.1;--s;var o=r+.1*((e-n[s])/(n[s+1]-n[s])),a=M(o,t,i);return a>=.001?function(t,e,i,r){for(var n=0;n<4;++n){var s=M(e,i,r);if(0===s)return e;e-=(C(e,i,r)-t)/s}return e}(e,o,t,i):0===a?o:function(t,e,i,r,n){var s,o,a=0;do{(s=C(o=e+(i-e)/2,r,n)-t)>0?i=o:e=o}while(Math.abs(s)>1e-7&&++a<10);return o}(e,r,r+.1,t,i)}return function(t){return 0===t?0:1===t?1:C(o(t),e,r)}},F={};var V={};var B={buildBezierData:function(t,e,i,r){var n=(t[0]+"_"+t[1]+"_"+e[0]+"_"+e[1]+"_"+i[0]+"_"+i[1]+"_"+r[0]+"_"+r[1]).replace(/\./g,"p");if(!V[n]){for(var s,o=0,a=[],u=0;u<200;u++){for(var h=i.length,l=new Array(h),c=u/199,f=0,p=0;p<h;p+=1){var v=Math.pow(1-c,3)*t[p]+3*Math.pow(1-c,2)*c*(t[p]+i[p])+3*(1-c)*Math.pow(c,2)*(e[p]+r[p])+Math.pow(c,3)*e[p];l[p]=v,s&&(f+=Math.pow(l[p]-s[p],2))}o+=f=Math.sqrt(f),a.push({partialLength:f,point:l}),s=l}V[n]={segmentLength:o,points:a}}return V[n]},getBezierEasing:function(t,e,i,r,n){var s=n||("bez_"+t+"_"+e+"_"+i+"_"+r).replace(/\./g,"p"),o=F[s];return o||(o=D(t,e,i,r),F[s]=o,o)}};function N(t){return Object.prototype.toString.call(t)}U=N([]),function(){var t=N("s")}(),function(){var t=N(1)}(),function(){var t=N((function(){}))}(),function(){var t=N(!0)}(),function(){var t=N({})}();var U,q=function(t,e){return(t%e+e)%e},G=function(t,e,i){return t<e?2*e-t:t>i?2*i-t:t},X=function(t,e,i){return t<e?e:t>i?i:t},$=/(loopIn|loopOut)\(([^)]+)/,H=/["']\w+["']/,J=function(){function t(e,i,r){d(this,t),this.begin=i,this.end=r,this.total=this.end-this.begin,this.type=e}return g(t,[{key:"update",value:function(t){return"in"===this.type?t>=this.begin?t:this.end-q(this.begin-t,this.total):"out"===this.type?t<=this.end?t:this.begin+q(t-this.end,this.total):void 0}}]),t}(),K=function(){function t(e,i,r){d(this,t),this.begin=i,this.end=r,this.total=this.end-this.begin,this.type=e}return g(t,[{key:"update",value:function(t){if("in"===this.type&&t<this.begin||"out"===this.type&&t>this.end){var e=t-this.end;return this.pingpong(e)}return t}},{key:"pingpong",value:function(t){return Math.floor(t/this.total)%2?this.begin+q(t,this.total):this.end-q(t,this.total)}}]),t}(),Q={loopIn:function(t,e,i){var r=t[0].t,n=t.length-1,s=t[Math.min(n,i)].t;switch(e){case"cycle":return new J("in",r,s);case"pingpong":return new K("in",r,s)}return null},loopOut:function(t,e,i){var r=t.length-1,n=t[Math.max(0,r-i)].t,s=t[r].t;switch(e){case"cycle":return new J("out",n,s);case"pingpong":return new K("out",n,s)}return null}};function W(t){var e=t.match($),i=e[2].split(/\s*,\s*/).map((function(t){return H.test(t)?t.replace(/"|'/g,""):parseInt(t)}));return{name:e[1],mode:i[0],offset:i[1]}}var Y,Z,tt,et,it={hasSupportExpression:function(t){return t.x&&$.test(t.x)},getExpression:function(t){var e=W(t.x),i=e.name,r=e.mode,n=e.offset,s=void 0===n?0:n,o=0===s?t.k.length-1:s;return Q[i]&&Q[i](t.k,r,o)}},rt=function(){function t(e,i){d(this,t),this.mult=void 0,this.v=void 0,this.value=void 0,this.newValue=void 0,this.expression=void 0,this.animated=void 0,this.mult=i||1,this.value=e.k,this.animated=e.a,it.hasSupportExpression(e)&&(this.expression=it.getExpression(e))}return g(t,[{key:"getValue",value:function(t,e,i,r){var n,s=i.t,o=r.t,a=i.s[e],u=(r.s||i.e)[e];if(1===i.h)return a;if(t>=o)n=1;else if(t<s)n=0;else{var h=i.beziers[e];h||(h=B.getBezierEasing(i.o.x[e],i.o.y[e],i.i.x[e],i.i.y[e]),i.beziers[e]=h),n=h((t-s)/(o-s))}return a+(u-a)*n}},{key:"reset",value:function(){}}]),t}(),nt=function(t){_(i,rt);var e=P(i);function i(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return d(this,i),(r=e.call(this,t,n)).v=n?r.value*n:r.value,r}return g(i,[{key:"update",value:function(){this.v=this.value*this.mult}}]),i}(),st=function(t){_(i,rt);var e=P(i);function i(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;d(this,i);var s=(r=e.call(this,t,n)).value.length;r.v=new Float32Array(s),r.newValue=new Float32Array(s);for(var o=0;o<s;o+=1)r.v[o]=r.value[o]*r.mult;return r}return g(i,[{key:"update",value:function(){var t;t=this.value;for(var e=0,i=this.v.length;e<i;e++)this.v[e]=t[e]*this.mult}}]),i}(),ot=function(t){_(i,rt);var e=P(i);function i(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return d(this,i),(r=e.call(this,t,n))._caching=void 0,r._caching={lastIndex:0,value:0},r.v=0,it.hasSupportExpression(t)&&(r.expression=it.getExpression(t)),r}return g(i,[{key:"reset",value:function(){this._caching={lastIndex:0,value:0}}},{key:"update",value:function(t){this.expression&&(t=this.expression.update(t));for(var e=this._caching,i=e.lastIndex,r=this.value,n=r[i],s=r[i+1],o=i,a=r.length-1;o<a;o++){if(n=r[o],s=r[o+1],o===a-1&&t>=s.t){n.h&&(n=s),i=0;break}if(s.t>t){i=o;break}}e.lastIndex=i,n.beziers=[],this.v=this.getValue(t,0,n,s)*this.mult}}]),i}(),at=function(t){_(i,rt);var e=P(i);function i(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;d(this,i),(r=e.call(this,t,n))._caching=void 0;var s=r.value[0].s.length;return r.newValue=new Float32Array(s),r.v=new Float32Array(s),r._caching={value:new Float32Array(s),lastPoint:0,addedLength:0,lastIndex:0},r}return g(i,[{key:"reset",value:function(){this._caching.lastPoint=0,this._caching.addedLength=0,this._caching.lastIndex=0}},{key:"update",value:function(t){this.expression&&(t=this.expression.update(t));for(var e=this._caching,i=e.lastIndex,r=this.value,n=this.newValue,s=i,o=r[i],a=r[i+1],u=r.length-1;s<u;s++){if(o=r[s],a=r[s+1],s===u-1&&t>=a.t){o.h&&(o=a),i=0;break}if(a.t>t){i=s;break}}if(e.lastIndex=i,o.to){var h=a.t,l=o.t;o.bezierData||(o.bezierData=B.buildBezierData(o.s,a.s||o.e,o.to,o.ti));for(var c=o.bezierData,f=c.points,p=(t-l)/(h-l),v=c.segmentLength*B.getBezierEasing(o.o.x,o.o.y,o.i.x,o.i.y,o.n)(p=Math.min(Math.max(0,p),1)),d=e.addedLength,y=e.lastPoint,g=y,m=f.length;g<m;g++){if(g===m-1){y=0,d=0;break}y=g;var _=f[g],b=f[g+1],w=b.partialLength;if(v>=d&&v<d+w){for(var k=(v-d)/w,x=0,P=_.point.length;x<P;x+=1)n[x]=_.point[x]+(b.point[x]-_.point[x])*k;break}d+=w}e.lastPoint=y,e.addedLength=d}else{o.beziers=[];for(var E=0,O=o.s.length;E<O;E+=1)n[E]=this.getValue(t,E,o,a)}for(var z=0,j=this.v.length;z<j;z++)this.v[z]=n[z]*this.mult}}]),i}(),ut=function(){function t(e){d(this,t),this.p=void 0,this.x=void 0,this.y=void 0,this.z=void 0,this.a=void 0,this.s=void 0,this.or=void 0,this.r=void 0,this.o=void 0,this.rx=void 0,this.ry=void 0,this.rz=void 0,this.properties=[],this.autoOrient=!1;var i=t.create;e.p.k?(this.p=i(e.p,1),this.properties.push(this.p)):(e.p.x&&(this.x=i(e.p.x,1),this.properties.push(this.x)),e.p.y&&(this.y=i(e.p.y,1),this.properties.push(this.y)),e.p.z&&(this.z=i(e.p.z,1),this.properties.push(this.z))),this.a=i(e.a,1),this.properties.push(this.a),this.s=i(e.s,1,.01),this.properties.push(this.s),this.o=i(e.o,0,.01),this.properties.push(this.o),e.r?(this.r=i(e.r,0),this.properties.push(this.r)):e.rx||e.ry||e.rz?(e.rx&&(this.rx=i(e.rx,0),this.properties.push(this.rx)),e.ry&&(this.ry=i(e.ry,0),this.properties.push(this.ry)),e.rz&&(this.rz=i(e.rz,0),this.properties.push(this.rz))):e.or&&(this.or=i(e.or,1),this.properties.push(this.or)),this.properties.length||this.update()}return g(t,[{key:"reset",value:function(){for(var t=0,e=this.properties.length;t<e;t++)this.properties[t].reset()}},{key:"update",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.properties.length,i=0;i<e;i++)this.properties[i].update(t);this.autoOrient}}],[{key:"create",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return t.k.length?"number"==typeof t.k[0]?new st(t,i):e?new at(t,i):new ot(t,i):new nt(t,i)}}]),t}(),ht=function(){function t(e){d(this,t),this.transform=void 0,this.is3D=void 0,this.offsetTime=void 0,this.name=void 0,this.index=void 0,this.stretch=1,this.parent=null,this.inPoint=void 0,this.outPoint=void 0,this.timeRemapping=void 0,this.width=void 0,this.height=void 0,this.visible=!0,this.entity=void 0,this.startTime=0,this.treeIndex=[],this.childLayers=[],this.is3D=!!e.ddd,this.stretch=e.sr||1,this.name=e.nm||"",this.index=e.ind,this.timeRemapping=e.tm,this.width=e.w,this.height=e.h,this.inPoint=e.ip,this.outPoint=e.op,e.st&&(this.startTime=e.st),e.ks&&(this.transform=new ut(e.ks))}return g(t,[{key:"reset",value:function(){this.transform&&this.transform.reset();for(var t=0;t<this.childLayers.length;t++)this.childLayers[t].reset()}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0,i=this.startTime,r=t/this.stretch;!0===e?this.visible=this.inPoint<=r&&this.outPoint>=r:!1===e&&(this.visible=!1),this.transform&&this.visible&&this.transform.update(r);for(var n=0;n<this.childLayers.length;n++)this.childLayers[n].update(r-i,this.visible)}},{key:"addChild",value:function(t){t.parent=this,t.entity.parent=this.entity,this.childLayers.push(t)}},{key:"destroy",value:function(){this.entity.parent=null,this.entity.destroy(),this.entity=null,this.transform=null,this.parent=null}}]),t}(),lt=function(e){_(r,ht);var i=P(r);function r(e,n,s,o){var a;if(d(this,r),(a=i.call(this,e)).layers=void 0,a.comps=void 0,a.layers=e.layers,a.comps=e.comps,s)a.entity=s,o&&(a.entity.name=o);else{var u=new t(n,o);a.entity=u}return a}return g(r,[{key:"destroy",value:function(){E(b(r.prototype),"destroy",this).call(this),this.layers=null,this.comps=null}}]),r}(),ct=function(i){_(n,ht);var r=P(n);function n(i,s,o,a){var u;if(d(this,n),(u=r.call(this,i)).sprite=void 0,u.spriteRenderer=void 0,i.refId)if(a){u.entity=a;var h=a.getComponent(e);u.spriteRenderer=h,u.sprite=h.sprite;var l=u.sprite,c=l.atlasRegion,f=l.texture;h._renderSortId=u.index,h._customRootEntity=o,u.width=c.width*f.width,u.height=c.height*f.height}else{u.sprite=s.getSprite(i.refId);var p=u.sprite,v=p.atlasRegion,y=p.texture,g=new t(o.engine,i.nm),m=g.addComponent(e);m.sprite=u.sprite,m._renderSortId=u.index,m._customRootEntity=o,u.entity=g,u.spriteRenderer=m,u.width=v.width*y.width,u.height=v.height*y.height}return u}return g(n,[{key:"destroy",value:function(){E(b(n.prototype),"destroy",this).call(this),this.sprite=null,this.spriteRenderer=null}}]),n}(),ft=(Y=function(t){_(s,n);var e=P(s);function s(){var t;d(this,s);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(t=e.call.apply(e,[this].concat(r))).repeats=0,t.isLooping=!1,t.isAlternate=!1,t.direction=1,t.speed=1,t._width=void 0,t._height=void 0,t._isPlaying=!1,t._frame=0,t._resource=void 0,t._clips=void 0,t._clip=void 0,t._clipEndCallbacks={},t._autoPlay=!1,j(t,"_root",Z,k(t)),j(t,"_elements",tt,k(t)),t}return g(s,[{key:"resource",get:function(){return this._resource},set:function(t){this._resource&&(this.pause(),this._destroyElements()),this._resource=t,this._width=t.width,this._height=t.height,this._clips=t.clips,this._createElements(t),this.play(),this.onUpdate(0),this.autoPlay||this.pause()}},{key:"autoPlay",get:function(){return this._autoPlay},set:function(t){this._autoPlay=t,t&&this.play()}},{key:"play",value:function(t){var e=this;if(t){var i=this._clips[t];this._clip=i}else this._clip=null;return this._isPlaying=!0,this._frame=0,new Promise((function(i){t?e._clipEndCallbacks[t]=i:e._clipEndCallbacks.ALL=i}))}},{key:"pause",value:function(){this._isPlaying=!1}},{key:"_createLayerElements",value:function(t,e,r,n){for(var s,o,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,u=arguments.length>5?arguments[5]:void 0,h=0,l=t.length;h<l;h++){var c=t[h],f=null;if(void 0===c.td){var p=n.treeIndex.concat(h),v=a;t.isComp&&(c.ind=n.index-(l-1-h)*a/l,v=a/l);var d=u&&this._findEntityInTree(p);switch(c.ty){case 0:f=new lt(c,this.engine,d,c.id);break;case 2:var y=(f=new ct(c,this._resource.atlas,this.entity,d)).sprite.bounds;i.merge(y,e,e),f.spriteRenderer._customLocalBounds=e;break;case 3:0===(null==c||null===(s=c.ks)||void 0===s||null===(o=s.o)||void 0===o?void 0:o.k)&&(c.ks.o.k=100),f=new lt(c,this.engine,void 0,c.id)}f&&(f.treeIndex=p,r.push(f),n.addChild(f),c.layers&&this._createLayerElements(c.layers,e,r,f,v,u))}}}},{key:"_findEntityInTree",value:function(t){for(var e,i=0,r=t.length;i<r;i++){var n=t[i];e=e?e.children[n]:this.entity.children[n]}return e}},{key:"_createElements",value:function(t,e){var r=new lt(t,this.engine,this.entity);this._root=r;var n=r.layers,s=[],o=new i,a=Number.MIN_SAFE_INTEGER,u=Number.MAX_SAFE_INTEGER;o.min.setValue(u,u,u),o.max.setValue(a,a,a),this._createLayerElements(n,o,s,r,1,e),this._elements=s}},{key:"_updateElements",value:function(t){this._root.update(t);for(var e=this._elements,i=0,r=e.length;i<r;i++){var n=e[i];this._updateElement(n)}}},{key:"_updateElement",value:function(t){var e,i=t.transform,n=t.entity,s=t.sprite,o=t.spriteRenderer,a=t.parent,u=t.width,h=t.height,l=n.transform,c=i.a.v,f=i.s.v,p=i.o.v,v=s?s.pixelsPerUnit:128,d=0,y=0,g=0;if(i.p){var m=i.p.v;d=m[0],y=m[1],g=m[2]}else i.x&&(d=i.x.v),i.y&&(y=i.y.v),i.z&&(g=i.z.v);var _=0,b=0,w=0;if(t.visible){if(i.r)w=-i.r.v;else if(i.rx||i.ry)_=i.rx?i.rx.v:0,b=i.ry?i.ry.v:0,w=i.rz?i.rz.v:0;else if(i.or){var k=i.or.v;_=k[0],b=k[1],w=k[2]}s&&(o.color.setValue(1,1,1,p),s.pivot=new r(c[0]/u,(h-c[1])/h)),n.isActive=t.visible,l.setScale(f[0],f[1],f[2]),l.setRotation(_,b,w),null!=a&&null!==(e=a.transform)&&void 0!==e&&e.a?l.setPosition((d-a.transform.a.v[0])/v,(-y+a.transform.a.v[1])/v,g/v):l.setPosition((d-this._width/2)/v,(-y+this._height/2)/v,g/v)}else n.isActive=t.visible}},{key:"_resetElements",value:function(){for(var t=this._elements,e=0,i=t.length;e<i;e++)t[e].reset()}},{key:"onUpdate",value:function(t){if(!this._isPlaying||!this._resource)return null;var e=this.direction*this.speed*t;this._frame+=e/this._resource.timePerFrame;var i=this._clip;if(this._spill()){var r=this._resource.duration;if(this._resetElements(),this.repeats>0||this.isLooping)this.repeats>0&&--this.repeats,this.isAlternate?(this.direction*=-1,this._frame=G(this._frame,0,i?i.end-i.start:r)):(this.direction=1,this._frame=q(this._frame,i?i.end-i.start:r));else if(i){if(this._frame>=i.end-i.start){var n=this._clipEndCallbacks[i.name];n&&n(i)}this._frame=X(this._frame,0,i.end-i.start)}else{if(this._frame>=r){var s=this._clipEndCallbacks.ALL;s&&s()}this._frame=X(this._frame,0,r)}}i?this._updateElements(this._resource.inPoint+this._frame+i.start):this._updateElements(this._resource.inPoint+this._frame)}},{key:"_spill",value:function(){var t;if(this._clip){var e=this._clip;t=e.end-e.start}else t=this._resource.duration;var i=this._frame<=0&&-1===this.direction,r=this._frame>=t&&1===this.direction;return i||r}},{key:"_cloneTo",value:function(t){t._createElements(this._resource,!0)}},{key:"_destroyElements",value:function(){for(var t=this._elements,e=0,i=t.length;e<i;e++)t[e].destroy()}}]),s}(),Z=A(Y.prototype,"_root",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tt=A(Y.prototype,"_elements",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Y),pt=function(t){_(i,o);var e=P(i);function i(t,r,n){var s;d(this,i),(s=e.call(this,t)).duration=void 0,s.timePerFrame=void 0,s.inPoint=void 0,s.outPoint=void 0,s.height=void 0,s.width=void 0,s.layers=void 0,s.animations=void 0,s.comps=void 0,s.atlas=void 0,s.name=void 0,s.clips=void 0,s.timePerFrame=1e3/r.fr,s.duration=Math.floor(r.op-r.ip),s.width=r.w,s.height=r.h,s.inPoint=r.ip,s.outPoint=r.op,s.atlas=n,s.layers=r.layers,s.comps=r.assets,s.name=r.nm,s.clips={};var o={},a=k(s).comps;if(a){for(var u=0,h=a.length;u<h;u++){var l=a[u];l.id&&(o[l.id]=l)}for(var c=0,f=s.layers.length;c<f;c++){var p=s.layers[c],v=p.refId;v&&o[v]&&(p.layers=o[v].layers)}}return s._buildTree(s.layers,o),r.lolitaAnimations&&s._parseAnimations(r.lolitaAnimations),s}return g(i,[{key:"_parseAnimations",value:function(t){var e=this;t.forEach((function(t){e.clips[t.name]=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?v(Object(i),!0).forEach((function(e){m(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):v(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},t)}))}},{key:"_buildTree",value:function(t,e){for(var i={},r=0,n=t.length;r<n;r++){var s=t[r];i[s.ind]=s}for(var o=[],a=0,u=t.length;a<u;a++){var h=t[a],l=h.refId,c=h.parent;c&&(i[c].layers||(i[c].layers=[]),i[c].layers.push(h),o.push(h)),l&&e[l]&&(h.layers=e[l].layers,h.layers.isComp=!0,this._buildTree(h.layers,e))}for(var f=0,p=o.length;f<p;f++){var v=t.indexOf(o[f]);t.splice(v,1)}}}]),i}(),vt=a("lottie",["json"])(et=function(e){_(r,l);var i=P(r);function r(){return d(this,r),i.apply(this,arguments)}return g(r,[{key:"load",value:function(e,i){var r=e.urls,n=this.request(r[0],i),s=i.load({url:r[1],type:u.SpriteAtlas});return h.all([n,s]).then((function(e){var r=O(e,2),n=r[0],s=r[1],o=i.engine,a=new pt(o,n,s),u=new t(o);return u.addComponent(ft).resource=a,u}))}}]),r}())||et,dt=function(t){_(i,f);var e=P(i);function i(){return d(this,i),e.apply(this,arguments)}return g(i,[{key:"load",value:function(t,e){var i=this,r=e.props,n=r.json,s=r.atlas;return t.load({urls:[n,s],type:"lottie"}).then((function(t){i._resource=t.getComponent(ft).resource}))}}]),i}();c("lottie",dt),p.registerComponents("o3",{LottieAnimation:ft});export{ft as LottieAnimation,vt as LottieLoader,dt as LottieResource};
