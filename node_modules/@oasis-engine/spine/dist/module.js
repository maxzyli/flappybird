import{BufferMesh as t,VertexElement as e,VertexElementFormat as a,Buffer as n,BufferBindFlag as r,BufferUsage as i,IndexFormat as s,MeshRenderer as o,SubMesh as l,Script as h,ignoreClone as u,resourceLoader as c,AssetPromise as d,Entity as f,Loader as v,Texture2D as g,TextureFilterMode as m}from"oasis-engine";function p(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function w(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function k(t,e,a){return e&&w(t.prototype,e),a&&w(t,a),t}function E(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function x(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&M(t,e)}function b(t){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function M(t,e){return(M=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function S(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function I(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return S(t)}function T(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var a,n=b(t);if(e){var r=b(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return I(this,a)}}function R(t,e,a,n){a&&Object.defineProperty(t,e,{enumerable:a.enumerable,configurable:a.configurable,writable:a.writable,value:a.initializer?a.initializer.call(n):void 0})}function A(t,e,a,n,r){var i={};return Object.keys(n).forEach((function(t){i[t]=n[t]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=a.slice().reverse().reduce((function(a,n){return n(t,e,a)||a}),i),r&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(r):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(t,e,i),i=null),i}var C=function(){function t(){y(this,t),this.array=new Array}return k(t,[{key:"add",value:function(t){var e=this.contains(t);return this.array[0|t]=0|t,!e}},{key:"contains",value:function(t){return null!=this.array[0|t]}},{key:"remove",value:function(t){this.array[0|t]=void 0}},{key:"clear",value:function(){this.array.length=0}}]),t}(),V=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;y(this,t),this.r=e,this.g=a,this.b=n,this.a=r}return k(t,[{key:"set",value:function(t,e,a,n){return this.r=t,this.g=e,this.b=a,this.a=n,this.clamp(),this}},{key:"setFromColor",value:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}},{key:"setFromString",value:function(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=(8!=t.length?255:parseInt(t.substr(6,2),16))/255,this}},{key:"add",value:function(t,e,a,n){return this.r+=t,this.g+=e,this.b+=a,this.a+=n,this.clamp(),this}},{key:"clamp",value:function(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this}}],[{key:"rgba8888ToColor",value:function(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255}},{key:"rgb888ToColor",value:function(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255}}]),t}();V.WHITE=new V(1,1,1,1),V.RED=new V(1,0,0,1),V.GREEN=new V(0,1,0,1),V.BLUE=new V(0,0,1,1),V.MAGENTA=new V(1,0,1,1);var P=function(){function t(){y(this,t)}return k(t,null,[{key:"clamp",value:function(t,e,a){return t<e?e:t>a?a:t}},{key:"cosDeg",value:function(e){return Math.cos(e*t.degRad)}},{key:"sinDeg",value:function(e){return Math.sin(e*t.degRad)}},{key:"signum",value:function(t){return t>0?1:t<0?-1:0}},{key:"toInt",value:function(t){return t>0?Math.floor(t):Math.ceil(t)}},{key:"cbrt",value:function(t){var e=Math.pow(Math.abs(t),1/3);return t<0?-e:e}},{key:"randomTriangular",value:function(e,a){return t.randomTriangularWith(e,a,.5*(e+a))}},{key:"randomTriangularWith",value:function(t,e,a){var n=Math.random(),r=e-t;return n<=(a-t)/r?t+Math.sqrt(n*r*(a-t)):e-Math.sqrt((1-n)*r*(e-a))}}]),t}();P.PI=3.1415927,P.PI2=2*P.PI,P.radiansToDegrees=180/P.PI,P.radDeg=P.radiansToDegrees,P.degreesToRadians=P.PI/180,P.degRad=P.degreesToRadians;var _=function(){function t(){y(this,t)}return k(t,null,[{key:"arrayCopy",value:function(t,e,a,n,r){for(var i=e,s=n;i<e+r;i++,s++)a[s]=t[i]}},{key:"setArraySize",value:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=t.length;if(n==e)return t;if(t.length=e,n<e)for(var r=n;r<e;r++)t[r]=a;return t}},{key:"ensureArrayCapacity",value:function(e,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.length>=a?e:t.setArraySize(e,a,n)}},{key:"newArray",value:function(t,e){for(var a=new Array(t),n=0;n<t;n++)a[n]=e;return a}},{key:"newFloatArray",value:function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Float32Array(e);for(var a=new Array(e),n=0;n<a.length;n++)a[n]=0;return a}},{key:"newShortArray",value:function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Int16Array(e);for(var a=new Array(e),n=0;n<a.length;n++)a[n]=0;return a}},{key:"toFloatArray",value:function(e){return t.SUPPORTS_TYPED_ARRAYS?new Float32Array(e):e}},{key:"toSinglePrecision",value:function(e){return t.SUPPORTS_TYPED_ARRAYS?Math.fround(e):e}},{key:"webkit602BugfixHelper",value:function(t,e){}},{key:"contains",value:function(t,e){for(var a=0;a<t.length;a++)if(t[a]==e)return!0;return!1}}]),t}();_.SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array;var F,N=function(){function t(e){y(this,t),this.items=new Array,this.instantiator=void 0,this.instantiator=e}return k(t,[{key:"obtain",value:function(){return this.items.length>0?this.items.pop():this.instantiator()}},{key:"free",value:function(t){t.reset&&t.reset(),this.items.push(t)}},{key:"freeAll",value:function(t){for(var e=0;e<t.length;e++)this.free(t[e])}},{key:"clear",value:function(){this.items.length=0}}]),t}(),O=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;y(this,t),this.x=e,this.y=a}return k(t,[{key:"set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"length",value:function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}},{key:"normalize",value:function(){var t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this}}]),t}(),L=function t(e,a,n){if(y(this,t),this.index=void 0,this.name=void 0,this.parent=void 0,this.length=void 0,this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=F.Normal,this.skinRequired=!1,this.color=new V,e<0)throw new Error("index must be >= 0.");if(null==a)throw new Error("name cannot be null.");this.index=e,this.name=a,this.parent=n};!function(t){t[t.Normal=0]="Normal",t[t.OnlyTranslation=1]="OnlyTranslation",t[t.NoRotationOrReflection=2]="NoRotationOrReflection",t[t.NoScale=3]="NoScale",t[t.NoScaleOrReflection=4]="NoScaleOrReflection"}(F||(F={}));var D,X,Y,B=function(){function t(e,a,n){if(y(this,t),this.data=void 0,this.skeleton=void 0,this.parent=void 0,this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.a=0,this.b=0,this.c=0,this.d=0,this.worldY=0,this.worldX=0,this.sorted=!1,this.active=!1,null==e)throw new Error("data cannot be null.");if(null==a)throw new Error("skeleton cannot be null.");this.data=e,this.skeleton=a,this.parent=n,this.setToSetupPose()}return k(t,[{key:"isActive",value:function(){return this.active}},{key:"update",value:function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}},{key:"updateWorldTransform",value:function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}},{key:"updateWorldTransformWith",value:function(t,e,a,n,r,i,s){this.ax=t,this.ay=e,this.arotation=a,this.ascaleX=n,this.ascaleY=r,this.ashearX=i,this.ashearY=s,this.appliedValid=!0;var o=this.parent;if(null==o){var l=this.skeleton,h=a+90+s,u=l.scaleX,c=l.scaleY;return this.a=P.cosDeg(a+i)*n*u,this.b=P.cosDeg(h)*r*u,this.c=P.sinDeg(a+i)*n*c,this.d=P.sinDeg(h)*r*c,this.worldX=t*u+l.x,void(this.worldY=e*c+l.y)}var d=o.a,f=o.b,v=o.c,g=o.d;switch(this.worldX=d*t+f*e+o.worldX,this.worldY=v*t+g*e+o.worldY,this.data.transformMode){case F.Normal:var m=a+90+s,p=P.cosDeg(a+i)*n,y=P.cosDeg(m)*r,w=P.sinDeg(a+i)*n,k=P.sinDeg(m)*r;return this.a=d*p+f*w,this.b=d*y+f*k,this.c=v*p+g*w,void(this.d=v*y+g*k);case F.OnlyTranslation:var E=a+90+s;this.a=P.cosDeg(a+i)*n,this.b=P.cosDeg(E)*r,this.c=P.sinDeg(a+i)*n,this.d=P.sinDeg(E)*r;break;case F.NoRotationOrReflection:var x=d*d+v*v,b=0;x>1e-4?(x=Math.abs(d*g-f*v)/x,d/=this.skeleton.scaleX,f=(v/=this.skeleton.scaleY)*x,g=d*x,b=Math.atan2(v,d)*P.radDeg):(d=0,v=0,b=90-Math.atan2(g,f)*P.radDeg);var M=a+i-b,S=a+s-b+90,I=P.cosDeg(M)*n,T=P.cosDeg(S)*r,R=P.sinDeg(M)*n,A=P.sinDeg(S)*r;this.a=d*I-f*R,this.b=d*T-f*A,this.c=v*I+g*R,this.d=v*T+g*A;break;case F.NoScale:case F.NoScaleOrReflection:var C=P.cosDeg(a),V=P.sinDeg(a),_=(d*C+f*V)/this.skeleton.scaleX,N=(v*C+g*V)/this.skeleton.scaleY,O=Math.sqrt(_*_+N*N);O>1e-5&&(O=1/O),_*=O,N*=O,O=Math.sqrt(_*_+N*N),this.data.transformMode==F.NoScale&&d*g-f*v<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(O=-O);var L=Math.PI/2+Math.atan2(N,_),D=Math.cos(L)*O,X=Math.sin(L)*O,Y=P.cosDeg(i)*n,B=P.cosDeg(90+s)*r,U=P.sinDeg(i)*n,W=P.sinDeg(90+s)*r;this.a=_*Y+D*U,this.b=_*B+D*W,this.c=N*Y+X*U,this.d=N*B+X*W}this.a*=this.skeleton.scaleX,this.b*=this.skeleton.scaleX,this.c*=this.skeleton.scaleY,this.d*=this.skeleton.scaleY}},{key:"setToSetupPose",value:function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY}},{key:"getWorldRotationX",value:function(){return Math.atan2(this.c,this.a)*P.radDeg}},{key:"getWorldRotationY",value:function(){return Math.atan2(this.d,this.b)*P.radDeg}},{key:"getWorldScaleX",value:function(){return Math.sqrt(this.a*this.a+this.c*this.c)}},{key:"getWorldScaleY",value:function(){return Math.sqrt(this.b*this.b+this.d*this.d)}},{key:"updateAppliedTransform",value:function(){this.appliedValid=!0;var t=this.parent;if(null==t)return this.ax=this.worldX,this.ay=this.worldY,this.arotation=Math.atan2(this.c,this.a)*P.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,void(this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*P.radDeg);var e=t.a,a=t.b,n=t.c,r=t.d,i=1/(e*r-a*n),s=this.worldX-t.worldX,o=this.worldY-t.worldY;this.ax=s*r*i-o*a*i,this.ay=o*e*i-s*n*i;var l=i*r,h=i*e,u=i*a,c=i*n,d=l*this.a-u*this.c,f=l*this.b-u*this.d,v=h*this.c-c*this.a,g=h*this.d-c*this.b;if(this.ashearX=0,this.ascaleX=Math.sqrt(d*d+v*v),this.ascaleX>1e-4){var m=d*g-f*v;this.ascaleY=m/this.ascaleX,this.ashearY=Math.atan2(d*f+v*g,m)*P.radDeg,this.arotation=Math.atan2(v,d)*P.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(f*f+g*g),this.ashearY=0,this.arotation=90-Math.atan2(g,f)*P.radDeg}},{key:"worldToLocal",value:function(t){var e=this.a,a=this.b,n=this.c,r=this.d,i=1/(e*r-a*n),s=t.x-this.worldX,o=t.y-this.worldY;return t.x=s*r*i-o*a*i,t.y=o*e*i-s*n*i,t}},{key:"localToWorld",value:function(t){var e=t.x,a=t.y;return t.x=e*this.a+a*this.b+this.worldX,t.y=e*this.c+a*this.d+this.worldY,t}},{key:"worldToLocalRotation",value:function(t){var e=P.sinDeg(t),a=P.cosDeg(t);return Math.atan2(this.a*e-this.c*a,this.d*a-this.b*e)*P.radDeg+this.rotation-this.shearX}},{key:"localToWorldRotation",value:function(t){t-=this.rotation-this.shearX;var e=P.sinDeg(t),a=P.cosDeg(t);return Math.atan2(a*this.c+e*this.d,a*this.a+e*this.b)*P.radDeg}},{key:"rotateWorld",value:function(t){var e=this.a,a=this.b,n=this.c,r=this.d,i=P.cosDeg(t),s=P.sinDeg(t);this.a=i*e-s*n,this.b=i*a-s*r,this.c=s*e+i*n,this.d=s*a+i*r,this.appliedValid=!1}}]),t}(),U=function(){function t(e,a){if(y(this,t),this.data=void 0,this.bone=void 0,this.color=void 0,this.darkColor=void 0,this.attachment=void 0,this.attachmentTime=void 0,this.attachmentState=void 0,this.deform=new Array,null==e)throw new Error("data cannot be null.");if(null==a)throw new Error("bone cannot be null.");this.data=e,this.bone=a,this.color=new V,this.darkColor=null==e.darkColor?null:new V,this.setToSetupPose()}return k(t,[{key:"getSkeleton",value:function(){return this.bone.skeleton}},{key:"getAttachment",value:function(){return this.attachment}},{key:"setAttachment",value:function(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.deform.length=0)}},{key:"setAttachmentTime",value:function(t){this.attachmentTime=this.bone.skeleton.time-t}},{key:"getAttachmentTime",value:function(){return this.bone.skeleton.time-this.attachmentTime}},{key:"setToSetupPose",value:function(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))}}]),t}(),W=function(){function t(e,a){if(y(this,t),this.data=void 0,this.bones=void 0,this.target=void 0,this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,null==e)throw new Error("data cannot be null.");if(null==a)throw new Error("skeleton cannot be null.");this.data=e,this.mix=e.mix,this.softness=e.softness,this.bendDirection=e.bendDirection,this.compress=e.compress,this.stretch=e.stretch,this.bones=new Array;for(var n=0;n<e.bones.length;n++)this.bones.push(a.findBone(e.bones[n].name));this.target=a.findBone(e.target.name)}return k(t,[{key:"isActive",value:function(){return this.active}},{key:"apply",value:function(){this.update()}},{key:"update",value:function(){var t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.softness,this.mix)}}},{key:"apply1",value:function(t,e,a,n,r,i,s){t.appliedValid||t.updateAppliedTransform();var o=t.parent,l=o.a,h=o.b,u=o.c,c=o.d,d=-t.ashearX-t.arotation,f=0,v=0;switch(t.data.transformMode){case F.OnlyTranslation:f=e-t.worldX,v=a-t.worldY;break;case F.NoRotationOrReflection:var g=Math.abs(l*c-h*u)/(l*l+u*u),m=l/t.skeleton.scaleX,p=u/t.skeleton.scaleY;h=-p*g*t.skeleton.scaleX,c=m*g*t.skeleton.scaleY,d+=Math.atan2(p,m)*P.radDeg;default:var y=e-o.worldX,w=a-o.worldY,k=l*c-h*u;f=(y*c-w*h)/k-t.ax,v=(w*l-y*u)/k-t.ay}d+=Math.atan2(v,f)*P.radDeg,t.ascaleX<0&&(d+=180),d>180?d-=360:d<-180&&(d+=360);var E=t.ascaleX,x=t.ascaleY;if(n||r){switch(t.data.transformMode){case F.NoScale:case F.NoScaleOrReflection:f=e-t.worldX,v=a-t.worldY}var b=t.data.length*E,M=Math.sqrt(f*f+v*v);if(n&&M<b||r&&M>b&&b>1e-4){var S=(M/b-1)*s+1;E*=S,i&&(x*=S)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+d*s,E,x,t.ashearX,t.ashearY)}},{key:"apply2",value:function(t,e,a,n,r,i,s,o){if(0!=o){t.appliedValid||t.updateAppliedTransform(),e.appliedValid||e.updateAppliedTransform();var l=t.ax,h=t.ay,u=t.ascaleX,c=u,d=t.ascaleY,f=e.ascaleX,v=0,g=0,m=0;u<0?(u=-u,v=180,m=-1):(v=0,m=1),d<0&&(d=-d,m=-m),f<0?(f=-f,g=180):g=0;var p=e.ax,y=0,w=0,k=0,E=t.a,x=t.b,b=t.c,M=t.d,S=Math.abs(u-d)<=1e-4;S?(w=E*p+x*(y=e.ay)+t.worldX,k=b*p+M*y+t.worldY):(y=0,w=E*p+t.worldX,k=b*p+t.worldY);var I=t.parent;E=I.a,x=I.b,b=I.c;var T,R,A=1/(E*(M=I.d)-x*b),C=w-I.worldX,V=k-I.worldY,_=(C*M-V*x)*A-l,F=(V*E-C*b)*A-h,N=Math.sqrt(_*_+F*F),O=e.data.length*f;if(N<1e-4)return this.apply1(t,a,n,!1,i,!1,o),void e.updateWorldTransformWith(p,y,0,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY);var L=((C=a-I.worldX)*M-(V=n-I.worldY)*x)*A-l,D=(V*E-C*b)*A-h,X=L*L+D*D;if(0!=s){s*=u*(f+1)/2;var Y=Math.sqrt(X),B=Y-N-O*u+s;if(B>0){var U=Math.min(1,B/(2*s))-1;X=(L-=(U=(B-s*(1-U*U))/Y)*L)*L+(D-=U*D)*D}}t:if(S){var W=(X-N*N-(O*=u)*O)/(2*N*O);W<-1?W=-1:W>1&&(W=1,i&&(c*=(Math.sqrt(X)/(N+O)-1)*o+1)),R=Math.acos(W)*r,E=N+O*W,x=O*Math.sin(R),T=Math.atan2(D*E-L*x,L*E+D*x)}else{var q=(E=u*O)*E,H=(x=d*O)*x,j=Math.atan2(D,L),z=-2*H*N,G=H-q;if((M=z*z-4*G*(b=H*N*N+q*X-q*H))>=0){var Z=Math.sqrt(M);z<0&&(Z=-Z);var Q=(Z=-(z+Z)/2)/G,K=b/Z,J=Math.abs(Q)<Math.abs(K)?Q:K;if(J*J<=X){V=Math.sqrt(X-J*J)*r,T=j-Math.atan2(V,J),R=Math.atan2(V/d,(J-N)/u);break t}}var $=P.PI,tt=N-E,et=tt*tt,at=0,nt=0,rt=N+E,it=rt*rt,st=0;(b=-E*N/(q-H))>=-1&&b<=1&&(b=Math.acos(b),(M=(C=E*Math.cos(b)+N)*C+(V=x*Math.sin(b))*V)<et&&($=b,et=M,tt=C,at=V),M>it&&(nt=b,it=M,rt=C,st=V)),X<=(et+it)/2?(T=j-Math.atan2(at*r,tt),R=$*r):(T=j-Math.atan2(st*r,rt),R=nt*r)}var ot=Math.atan2(y,p)*m,lt=t.arotation;(T=(T-ot)*P.radDeg+v-lt)>180?T-=360:T<-180&&(T+=360),t.updateWorldTransformWith(l,h,lt+T*o,c,t.ascaleY,0,0),lt=e.arotation,(R=((R+ot)*P.radDeg-e.ashearX)*m+g-lt)>180?R-=360:R<-180&&(R+=360),e.updateWorldTransformWith(p,y,lt+R*o,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}else e.updateWorldTransform()}}]),t}(),q=function(){function t(e,a){if(y(this,t),this.data=void 0,this.bones=void 0,this.target=void 0,this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new O,this.active=!1,null==e)throw new Error("data cannot be null.");if(null==a)throw new Error("skeleton cannot be null.");this.data=e,this.rotateMix=e.rotateMix,this.translateMix=e.translateMix,this.scaleMix=e.scaleMix,this.shearMix=e.shearMix,this.bones=new Array;for(var n=0;n<e.bones.length;n++)this.bones.push(a.findBone(e.bones[n].name));this.target=a.findBone(e.target.name)}return k(t,[{key:"isActive",value:function(){return this.active}},{key:"apply",value:function(){this.update()}},{key:"update",value:function(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()}},{key:"applyAbsoluteWorld",value:function(){for(var t=this.rotateMix,e=this.translateMix,a=this.scaleMix,n=this.shearMix,r=this.target,i=r.a,s=r.b,o=r.c,l=r.d,h=i*l-s*o>0?P.degRad:-P.degRad,u=this.data.offsetRotation*h,c=this.data.offsetShearY*h,d=this.bones,f=0,v=d.length;f<v;f++){var g=d[f],m=!1;if(0!=t){var p=g.a,y=g.b,w=g.c,k=g.d,E=Math.atan2(o,i)-Math.atan2(w,p)+u;E>P.PI?E-=P.PI2:E<-P.PI&&(E+=P.PI2),E*=t;var x=Math.cos(E),b=Math.sin(E);g.a=x*p-b*w,g.b=x*y-b*k,g.c=b*p+x*w,g.d=b*y+x*k,m=!0}if(0!=e){var M=this.temp;r.localToWorld(M.set(this.data.offsetX,this.data.offsetY)),g.worldX+=(M.x-g.worldX)*e,g.worldY+=(M.y-g.worldY)*e,m=!0}if(a>0){var S=Math.sqrt(g.a*g.a+g.c*g.c),I=Math.sqrt(i*i+o*o);S>1e-5&&(S=(S+(I-S+this.data.offsetScaleX)*a)/S),g.a*=S,g.c*=S,S=Math.sqrt(g.b*g.b+g.d*g.d),I=Math.sqrt(s*s+l*l),S>1e-5&&(S=(S+(I-S+this.data.offsetScaleY)*a)/S),g.b*=S,g.d*=S,m=!0}if(n>0){var T=g.b,R=g.d,A=Math.atan2(R,T),C=Math.atan2(l,s)-Math.atan2(o,i)-(A-Math.atan2(g.c,g.a));C>P.PI?C-=P.PI2:C<-P.PI&&(C+=P.PI2),C=A+(C+c)*n;var V=Math.sqrt(T*T+R*R);g.b=Math.cos(C)*V,g.d=Math.sin(C)*V,m=!0}m&&(g.appliedValid=!1)}}},{key:"applyRelativeWorld",value:function(){for(var t=this.rotateMix,e=this.translateMix,a=this.scaleMix,n=this.shearMix,r=this.target,i=r.a,s=r.b,o=r.c,l=r.d,h=i*l-s*o>0?P.degRad:-P.degRad,u=this.data.offsetRotation*h,c=this.data.offsetShearY*h,d=this.bones,f=0,v=d.length;f<v;f++){var g=d[f],m=!1;if(0!=t){var p=g.a,y=g.b,w=g.c,k=g.d,E=Math.atan2(o,i)+u;E>P.PI?E-=P.PI2:E<-P.PI&&(E+=P.PI2),E*=t;var x=Math.cos(E),b=Math.sin(E);g.a=x*p-b*w,g.b=x*y-b*k,g.c=b*p+x*w,g.d=b*y+x*k,m=!0}if(0!=e){var M=this.temp;r.localToWorld(M.set(this.data.offsetX,this.data.offsetY)),g.worldX+=M.x*e,g.worldY+=M.y*e,m=!0}if(a>0){var S=(Math.sqrt(i*i+o*o)-1+this.data.offsetScaleX)*a+1;g.a*=S,g.c*=S,S=(Math.sqrt(s*s+l*l)-1+this.data.offsetScaleY)*a+1,g.b*=S,g.d*=S,m=!0}if(n>0){var I=Math.atan2(l,s)-Math.atan2(o,i);I>P.PI?I-=P.PI2:I<-P.PI&&(I+=P.PI2);var T=g.b,R=g.d;I=Math.atan2(R,T)+(I-P.PI/2+c)*n;var A=Math.sqrt(T*T+R*R);g.b=Math.cos(I)*A,g.d=Math.sin(I)*A,m=!0}m&&(g.appliedValid=!1)}}},{key:"applyAbsoluteLocal",value:function(){var t=this.rotateMix,e=this.translateMix,a=this.scaleMix,n=this.shearMix,r=this.target;r.appliedValid||r.updateAppliedTransform();for(var i=this.bones,s=0,o=i.length;s<o;s++){var l=i[s];l.appliedValid||l.updateAppliedTransform();var h=l.arotation;if(0!=t){var u=r.arotation-h+this.data.offsetRotation;h+=(u-=360*(16384-(16384.499999999996-u/360|0)))*t}var c=l.ax,d=l.ay;0!=e&&(c+=(r.ax-c+this.data.offsetX)*e,d+=(r.ay-d+this.data.offsetY)*e);var f=l.ascaleX,v=l.ascaleY;0!=a&&(f>1e-5&&(f=(f+(r.ascaleX-f+this.data.offsetScaleX)*a)/f),v>1e-5&&(v=(v+(r.ascaleY-v+this.data.offsetScaleY)*a)/v));var g=l.ashearY;if(0!=n){var m=r.ashearY-g+this.data.offsetShearY;m-=360*(16384-(16384.499999999996-m/360|0)),l.shearY+=m*n}l.updateWorldTransformWith(c,d,h,f,v,l.ashearX,g)}}},{key:"applyRelativeLocal",value:function(){var t=this.rotateMix,e=this.translateMix,a=this.scaleMix,n=this.shearMix,r=this.target;r.appliedValid||r.updateAppliedTransform();for(var i=this.bones,s=0,o=i.length;s<o;s++){var l=i[s];l.appliedValid||l.updateAppliedTransform();var h=l.arotation;0!=t&&(h+=(r.arotation+this.data.offsetRotation)*t);var u=l.ax,c=l.ay;0!=e&&(u+=(r.ax+this.data.offsetX)*e,c+=(r.ay+this.data.offsetY)*e);var d=l.ascaleX,f=l.ascaleY;0!=a&&(d>1e-5&&(d*=(r.ascaleX-1+this.data.offsetScaleX)*a+1),f>1e-5&&(f*=(r.ascaleY-1+this.data.offsetScaleY)*a+1));var v=l.ashearY;0!=n&&(v+=(r.ashearY+this.data.offsetShearY)*n),l.updateWorldTransformWith(u,c,h,d,f,l.ashearX,v)}}}]),t}(),H=function t(e,a,n){y(this,t),this.name=e,this.order=a,this.skinRequired=n},j=function(t){x(a,H);var e=T(a);function a(t){var n;return y(this,a),(n=e.call(this,t,0,!1)).bones=new Array,n.target=void 0,n.positionMode=void 0,n.spacingMode=void 0,n.rotateMode=void 0,n.offsetRotation=void 0,n.position=void 0,n.spacing=void 0,n.rotateMix=void 0,n.translateMix=void 0,n}return a}();!function(t){t[t.Fixed=0]="Fixed",t[t.Percent=1]="Percent"}(D||(D={})),function(t){t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent"}(X||(X={})),function(t){t[t.Tangent=0]="Tangent",t[t.Chain=1]="Chain",t[t.ChainScale=2]="ChainScale"}(Y||(Y={}));var z=function t(e){if(y(this,t),this.name=void 0,null==e)throw new Error("name cannot be null.");this.name=e},G=function(t){x(a,z);var e=T(a);function a(t){var n;return y(this,a),(n=e.call(this,t)).id=(65535&a.nextID++)<<11,n.bones=void 0,n.vertices=void 0,n.worldVerticesLength=0,n.deformAttachment=S(n),n}return k(a,[{key:"computeWorldVertices",value:function(t,e,a,n,r,i){a=r+(a>>1)*i;var s=t.bone.skeleton,o=t.deform,l=this.vertices,h=this.bones;if(null!=h){for(var u=0,c=0,d=0;d<e;d+=2){var f=h[u];u+=f+1,c+=f}var v=s.bones;if(0==o.length)for(var g=r,m=3*c;g<a;g+=i){var p=0,y=0,w=h[u++];for(w+=u;u<w;u++,m+=3){var k=v[h[u]],E=l[m],x=l[m+1],b=l[m+2];p+=(E*k.a+x*k.b+k.worldX)*b,y+=(E*k.c+x*k.d+k.worldY)*b}n[g]=p,n[g+1]=y}else for(var M=o,S=r,I=3*c,T=c<<1;S<a;S+=i){var R=0,A=0,C=h[u++];for(C+=u;u<C;u++,I+=3,T+=2){var V=v[h[u]],P=l[I]+M[T],_=l[I+1]+M[T+1],F=l[I+2];R+=(P*V.a+_*V.b+V.worldX)*F,A+=(P*V.c+_*V.d+V.worldY)*F}n[S]=R,n[S+1]=A}}else{o.length>0&&(l=o);for(var N=t.bone,O=N.worldX,L=N.worldY,D=N.a,X=N.b,Y=N.c,B=N.d,U=e,W=r;W<a;U+=2,W+=i){var q=l[U],H=l[U+1];n[W]=q*D+H*X+O,n[W+1]=q*Y+H*B+L}}}},{key:"copyTo",value:function(t){null!=this.bones?(t.bones=new Array(this.bones.length),_.arrayCopy(this.bones,0,t.bones,0,this.bones.length)):t.bones=null,null!=this.vertices?(t.vertices=_.newFloatArray(this.vertices.length),_.arrayCopy(this.vertices,0,t.vertices,0,this.vertices.length)):t.vertices=null,t.worldVerticesLength=this.worldVerticesLength,t.deformAttachment=this.deformAttachment}}]),a}();G.nextID=0;var Z=function(t){x(a,G);var e=T(a);function a(t){var n;return y(this,a),(n=e.call(this,t)).lengths=void 0,n.closed=!1,n.constantSpeed=!1,n.color=new V(1,1,1,1),n}return k(a,[{key:"copy",value:function(){var t=new a(this.name);return this.copyTo(t),t.lengths=new Array(this.lengths.length),_.arrayCopy(this.lengths,0,t.lengths,0,this.lengths.length),t.closed=closed,t.constantSpeed=this.constantSpeed,t.color.setFromColor(this.color),t}}]),a}(),Q=function(){function t(e,a){if(y(this,t),this.data=void 0,this.bones=void 0,this.target=void 0,this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,null==e)throw new Error("data cannot be null.");if(null==a)throw new Error("skeleton cannot be null.");this.data=e,this.bones=new Array;for(var n=0,r=e.bones.length;n<r;n++)this.bones.push(a.findBone(e.bones[n].name));this.target=a.findSlot(e.target.name),this.position=e.position,this.spacing=e.spacing,this.rotateMix=e.rotateMix,this.translateMix=e.translateMix}return k(t,[{key:"isActive",value:function(){return this.active}},{key:"apply",value:function(){this.update()}},{key:"update",value:function(){var e=this.target.getAttachment();if(e instanceof Z){var a=this.rotateMix,n=this.translateMix,r=a>0;if(n>0||r){var i=this.data,s=i.spacingMode==X.Percent,o=i.rotateMode,l=o==Y.Tangent,h=o==Y.ChainScale,u=this.bones.length,c=l?u:u+1,d=this.bones,f=_.setArraySize(this.spaces,c),v=null,g=this.spacing;if(h||!s){h&&(v=_.setArraySize(this.lengths,u));for(var m=i.spacingMode==X.Length,p=0,y=c-1;p<y;){var w=d[p],k=w.data.length;if(k<t.epsilon)h&&(v[p]=0),f[++p]=0;else if(s){if(h){var E=k*w.a,x=k*w.c,b=Math.sqrt(E*E+x*x);v[p]=b}f[++p]=g}else{var M=k*w.a,S=k*w.c,I=Math.sqrt(M*M+S*S);h&&(v[p]=I),f[++p]=(m?k+g:g)*I/k}}}else for(var T=1;T<c;T++)f[T]=g;var R=this.computeWorldPositions(e,c,l,i.positionMode==D.Percent,s),A=R[0],C=R[1],V=i.offsetRotation,F=!1;if(0==V)F=o==Y.Chain;else{F=!1;var N=this.target.bone;V*=N.a*N.d-N.b*N.c>0?P.degRad:-P.degRad}for(var O=0,L=3;O<u;O++,L+=3){var B=d[O];B.worldX+=(A-B.worldX)*n,B.worldY+=(C-B.worldY)*n;var U=R[L],W=R[L+1],q=U-A,H=W-C;if(h){var j=v[O];if(0!=j){var z=(Math.sqrt(q*q+H*H)/j-1)*a+1;B.a*=z,B.c*=z}}if(A=U,C=W,r){var G=B.a,Q=B.b,K=B.c,J=B.d,$=0,tt=0,et=0;if($=l?R[L-1]:0==f[O+1]?R[L+2]:Math.atan2(H,q),$-=Math.atan2(K,G),F){tt=Math.cos($),et=Math.sin($);var at=B.data.length;A+=(at*(tt*G-et*K)-q)*a,C+=(at*(et*G+tt*K)-H)*a}else $+=V;$>P.PI?$-=P.PI2:$<-P.PI&&($+=P.PI2),$*=a,tt=Math.cos($),et=Math.sin($),B.a=tt*G-et*K,B.b=tt*Q-et*J,B.c=et*G+tt*K,B.d=et*Q+tt*J}B.appliedValid=!1}}}}},{key:"computeWorldPositions",value:function(e,a,n,r,i){var s=this.target,o=this.position,l=this.spaces,h=_.setArraySize(this.positions,3*a+2),u=null,c=e.closed,d=e.worldVerticesLength,f=d/6,v=t.NONE;if(!e.constantSpeed){var g=e.lengths,m=g[f-=c?1:2];if(r&&(o*=m),i)for(var p=1;p<a;p++)l[p]*=m;u=_.setArraySize(this.world,8);for(var y=0,w=0,k=0;y<a;y++,w+=3){var E=l[y],x=o+=E;if(c)(x%=m)<0&&(x+=m),k=0;else{if(x<0){v!=t.BEFORE&&(v=t.BEFORE,e.computeWorldVertices(s,2,4,u,0,2)),this.addBeforePosition(x,u,0,h,w);continue}if(x>m){v!=t.AFTER&&(v=t.AFTER,e.computeWorldVertices(s,d-6,4,u,0,2)),this.addAfterPosition(x-m,u,0,h,w);continue}}for(;;k++){var b=g[k];if(!(x>b)){if(0==k)x/=b;else{var M=g[k-1];x=(x-M)/(b-M)}break}}k!=v&&(v=k,c&&k==f?(e.computeWorldVertices(s,d-4,4,u,0,2),e.computeWorldVertices(s,0,4,u,4,2)):e.computeWorldVertices(s,6*k+2,8,u,0,2)),this.addCurvePosition(x,u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7],h,w,n||y>0&&0==E)}return h}c?(d+=2,u=_.setArraySize(this.world,d),e.computeWorldVertices(s,2,d-4,u,0,2),e.computeWorldVertices(s,0,2,u,d-4,2),u[d-2]=u[0],u[d-1]=u[1]):(f--,d-=4,u=_.setArraySize(this.world,d),e.computeWorldVertices(s,2,d,u,0,2));for(var S=_.setArraySize(this.curves,f),I=0,T=u[0],R=u[1],A=0,C=0,V=0,P=0,F=0,N=0,O=0,L=0,D=0,X=0,Y=0,B=0,U=0,W=0,q=0,H=2;q<f;q++,H+=6)A=u[H],C=u[H+1],V=u[H+2],P=u[H+3],Y=2*(O=.1875*(T-2*A+V))+(D=.09375*(3*(A-V)-T+(F=u[H+4]))),B=2*(L=.1875*(R-2*C+P))+(X=.09375*(3*(C-P)-R+(N=u[H+5]))),U=.75*(A-T)+O+.16666667*D,W=.75*(C-R)+L+.16666667*X,I+=Math.sqrt(U*U+W*W),U+=Y,W+=B,Y+=D,B+=X,I+=Math.sqrt(U*U+W*W),U+=Y,W+=B,I+=Math.sqrt(U*U+W*W),U+=Y+D,W+=B+X,I+=Math.sqrt(U*U+W*W),S[q]=I,T=F,R=N;if(o*=r?I:I/e.lengths[f-1],i)for(var j=1;j<a;j++)l[j]*=I;for(var z=this.segments,G=0,Z=0,Q=0,K=0,J=0;Z<a;Z++,Q+=3){var $=l[Z],tt=o+=$;if(c)(tt%=I)<0&&(tt+=I),K=0;else{if(tt<0){this.addBeforePosition(tt,u,0,h,Q);continue}if(tt>I){this.addAfterPosition(tt-I,u,d-4,h,Q);continue}}for(;;K++){var et=S[K];if(!(tt>et)){if(0==K)tt/=et;else{var at=S[K-1];tt=(tt-at)/(et-at)}break}}if(K!=v){v=K;var nt=6*K;for(T=u[nt],R=u[nt+1],A=u[nt+2],C=u[nt+3],V=u[nt+4],P=u[nt+5],Y=2*(O=.03*(T-2*A+V))+(D=.006*(3*(A-V)-T+(F=u[nt+6]))),B=2*(L=.03*(R-2*C+P))+(X=.006*(3*(C-P)-R+(N=u[nt+7]))),U=.3*(A-T)+O+.16666667*D,W=.3*(C-R)+L+.16666667*X,G=Math.sqrt(U*U+W*W),z[0]=G,nt=1;nt<8;nt++)U+=Y,W+=B,Y+=D,B+=X,G+=Math.sqrt(U*U+W*W),z[nt]=G;U+=Y,W+=B,G+=Math.sqrt(U*U+W*W),z[8]=G,U+=Y+D,W+=B+X,G+=Math.sqrt(U*U+W*W),z[9]=G,J=0}for(tt*=G;;J++){var rt=z[J];if(!(tt>rt)){if(0==J)tt/=rt;else{var it=z[J-1];tt=J+(tt-it)/(rt-it)}break}}this.addCurvePosition(.1*tt,T,R,A,C,V,P,F,N,h,Q,n||Z>0&&0==$)}return h}},{key:"addBeforePosition",value:function(t,e,a,n,r){var i=e[a],s=e[a+1],o=e[a+2]-i,l=e[a+3]-s,h=Math.atan2(l,o);n[r]=i+t*Math.cos(h),n[r+1]=s+t*Math.sin(h),n[r+2]=h}},{key:"addAfterPosition",value:function(t,e,a,n,r){var i=e[a+2],s=e[a+3],o=i-e[a],l=s-e[a+1],h=Math.atan2(l,o);n[r]=i+t*Math.cos(h),n[r+1]=s+t*Math.sin(h),n[r+2]=h}},{key:"addCurvePosition",value:function(t,e,a,n,r,i,s,o,l,h,u,c){if(0==t||isNaN(t))return h[u]=e,h[u+1]=a,void(h[u+2]=Math.atan2(r-a,n-e));var d=t*t,f=d*t,v=1-t,g=v*v,m=g*v,p=v*t,y=3*p,w=v*y,k=y*t,E=e*m+n*w+i*k+o*f,x=a*m+r*w+s*k+l*f;h[u]=E,h[u+1]=x,c&&(h[u+2]=t<.001?Math.atan2(r-a,n-e):Math.atan2(x-(a*g+r*p*2+s*d),E-(e*g+n*p*2+i*d)))}}]),t}();Q.NONE=-1,Q.BEFORE=-2,Q.AFTER=-3,Q.epsilon=1e-5;var K=function(t){x(a,z);var e=T(a);function a(t){var n;return y(this,a),(n=e.call(this,t)).x=0,n.y=0,n.scaleX=1,n.scaleY=1,n.rotation=0,n.width=0,n.height=0,n.color=new V(1,1,1,1),n.path=void 0,n.rendererObject=void 0,n.region=void 0,n.offset=_.newFloatArray(8),n.uvs=_.newFloatArray(8),n.tempColor=new V(1,1,1,1),n}return k(a,[{key:"updateOffset",value:function(){var t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,n=-this.width/2*this.scaleX+this.region.offsetX*t,r=-this.height/2*this.scaleY+this.region.offsetY*e,i=n+this.region.width*t,s=r+this.region.height*e,o=this.rotation*Math.PI/180,l=Math.cos(o),h=Math.sin(o),u=n*l+this.x,c=n*h,d=r*l+this.y,f=r*h,v=i*l+this.x,g=i*h,m=s*l+this.y,p=s*h,y=this.offset;y[a.OX1]=u-f,y[a.OY1]=d+c,y[a.OX2]=u-p,y[a.OY2]=m+c,y[a.OX3]=v-p,y[a.OY3]=m+g,y[a.OX4]=v-f,y[a.OY4]=d+g}},{key:"setRegion",value:function(t){this.region=t;var e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)}},{key:"computeWorldVertices",value:function(t,e,n,r){var i=this.offset,s=t.worldX,o=t.worldY,l=t.a,h=t.b,u=t.c,c=t.d,d=0,f=0;d=i[a.OX1],f=i[a.OY1],e[n]=d*l+f*h+s,e[n+1]=d*u+f*c+o,n+=r,d=i[a.OX2],f=i[a.OY2],e[n]=d*l+f*h+s,e[n+1]=d*u+f*c+o,n+=r,d=i[a.OX3],f=i[a.OY3],e[n]=d*l+f*h+s,e[n+1]=d*u+f*c+o,n+=r,d=i[a.OX4],f=i[a.OY4],e[n]=d*l+f*h+s,e[n+1]=d*u+f*c+o}},{key:"copy",value:function(){var t=new a(this.name);return t.region=this.region,t.rendererObject=this.rendererObject,t.path=this.path,t.x=this.x,t.y=this.y,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.rotation=this.rotation,t.width=this.width,t.height=this.height,_.arrayCopy(this.uvs,0,t.uvs,0,8),_.arrayCopy(this.offset,0,t.offset,0,8),t.color.setFromColor(this.color),t}}]),a}();K.OX1=0,K.OY1=1,K.OX2=2,K.OY2=3,K.OX3=4,K.OY3=5,K.OX4=6,K.OY4=7,K.X1=0,K.Y1=1,K.C1R=2,K.C1G=3,K.C1B=4,K.C1A=5,K.U1=6,K.V1=7,K.X2=8,K.Y2=9,K.C2R=10,K.C2G=11,K.C2B=12,K.C2A=13,K.U2=14,K.V2=15,K.X3=16,K.Y3=17,K.C3R=18,K.C3G=19,K.C3B=20,K.C3A=21,K.U3=22,K.V3=23,K.X4=24,K.Y4=25,K.C4R=26,K.C4G=27,K.C4B=28,K.C4A=29,K.U4=30,K.V4=31;var J,$,tt=function(){function t(e){y(this,t),this._image=void 0,this._image=e}return k(t,[{key:"getImage",value:function(){return this._image}}],[{key:"filterFromString",value:function(t){switch(t.toLowerCase()){case"nearest":return J.Nearest;case"linear":return J.Linear;case"mipmap":return J.MipMap;case"mipmapnearestnearest":return J.MipMapNearestNearest;case"mipmaplinearnearest":return J.MipMapLinearNearest;case"mipmapnearestlinear":return J.MipMapNearestLinear;case"mipmaplinearlinear":return J.MipMapLinearLinear;default:throw new Error("Unknown texture filter ".concat(t))}}},{key:"wrapFromString",value:function(t){switch(t.toLowerCase()){case"mirroredtepeat":return $.MirroredRepeat;case"clamptoedge":return $.ClampToEdge;case"repeat":return $.Repeat;default:throw new Error("Unknown texture wrap ".concat(t))}}}]),t}();!function(t){t[t.Nearest=9728]="Nearest",t[t.Linear=9729]="Linear",t[t.MipMap=9987]="MipMap",t[t.MipMapNearestNearest=9984]="MipMapNearestNearest",t[t.MipMapLinearNearest=9985]="MipMapLinearNearest",t[t.MipMapNearestLinear=9986]="MipMapNearestLinear",t[t.MipMapLinearLinear=9987]="MipMapLinearLinear"}(J||(J={})),function(t){t[t.MirroredRepeat=33648]="MirroredRepeat",t[t.ClampToEdge=33071]="ClampToEdge",t[t.Repeat=10497]="Repeat"}($||($={}));var et,at,nt,rt=function t(){y(this,t),this.renderObject=void 0,this.u=0,this.v=0,this.u2=0,this.v2=0,this.width=0,this.height=0,this.rotate=!1,this.offsetX=0,this.offsetY=0,this.originalWidth=0,this.originalHeight=0},it=function(t){x(a,tt);var e=T(a);function a(){return y(this,a),e.apply(this,arguments)}return k(a,[{key:"setFilters",value:function(t,e){}},{key:"setWraps",value:function(t,e){}},{key:"dispose",value:function(){}}]),a}(),st=function(){function t(e,a){y(this,t),this.pages=new Array,this.regions=new Array,this.load(e,a)}return k(t,[{key:"load",value:function(t,e){if(null==e)throw new Error("textureLoader cannot be null.");for(var a=new ot(t),n=new Array(4),r=null;;){var i=a.readLine();if(null==i)break;if(0==(i=i.trim()).length)r=null;else if(r){var s=new ht;s.name=i,s.page=r;var o=a.readValue();"true"==o.toLocaleLowerCase()?s.degrees=90:"false"==o.toLocaleLowerCase()?s.degrees=0:s.degrees=parseFloat(o),s.rotate=90==s.degrees,a.readTuple(n);var l=parseInt(n[0]),h=parseInt(n[1]);a.readTuple(n);var u=parseInt(n[0]),c=parseInt(n[1]);s.u=l/r.width,s.v=h/r.height,s.rotate?(s.u2=(l+c)/r.width,s.v2=(h+u)/r.height):(s.u2=(l+u)/r.width,s.v2=(h+c)/r.height),s.x=l,s.y=h,s.width=Math.abs(u),s.height=Math.abs(c),4==a.readTuple(n)&&4==a.readTuple(n)&&a.readTuple(n),s.originalWidth=parseInt(n[0]),s.originalHeight=parseInt(n[1]),a.readTuple(n),s.offsetX=parseInt(n[0]),s.offsetY=parseInt(n[1]),s.index=parseInt(a.readValue()),s.texture=r.texture,this.regions.push(s)}else{(r=new lt).name=i,2==a.readTuple(n)&&(r.width=parseInt(n[0]),r.height=parseInt(n[1]),a.readTuple(n)),a.readTuple(n),r.minFilter=tt.filterFromString(n[0]),r.magFilter=tt.filterFromString(n[1]);var d=a.readValue();r.uWrap=$.ClampToEdge,r.vWrap=$.ClampToEdge,"x"==d?r.uWrap=$.Repeat:"y"==d?r.vWrap=$.Repeat:"xy"==d&&(r.uWrap=r.vWrap=$.Repeat),r.texture=e(i),r.texture.setFilters(r.minFilter,r.magFilter),r.texture.setWraps(r.uWrap,r.vWrap),r.width=r.texture.getImage().width,r.height=r.texture.getImage().height,this.pages.push(r)}}}},{key:"findRegion",value:function(t){for(var e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null}},{key:"dispose",value:function(){for(var t=0;t<this.pages.length;t++)this.pages[t].texture.dispose()}}]),t}(),ot=function(){function t(e){y(this,t),this.lines=void 0,this.index=0,this.lines=e.split(/\r\n|\r|\n/)}return k(t,[{key:"readLine",value:function(){return this.index>=this.lines.length?null:this.lines[this.index++]}},{key:"readValue",value:function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw new Error("Invalid line: "+t);return t.substring(e+1).trim()}},{key:"readTuple",value:function(t){var e=this.readLine(),a=e.indexOf(":");if(-1==a)throw new Error("Invalid line: "+e);for(var n=0,r=a+1;n<3;n++){var i=e.indexOf(",",r);if(-1==i)break;t[n]=e.substr(r,i-r).trim(),r=i+1}return t[n]=e.substring(r).trim(),n+1}}]),t}(),lt=function t(){y(this,t),this.name=void 0,this.minFilter=void 0,this.magFilter=void 0,this.uWrap=void 0,this.vWrap=void 0,this.texture=void 0,this.width=void 0,this.height=void 0},ht=function(t){x(a,rt);var e=T(a);function a(){var t;y(this,a);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))).page=void 0,t.name=void 0,t.x=void 0,t.y=void 0,t.index=void 0,t.rotate=void 0,t.degrees=void 0,t.texture=void 0,t}return a}(),ut=function(t){x(a,G);var e=T(a);function a(t){var n;return y(this,a),(n=e.call(this,t)).region=void 0,n.path=void 0,n.regionUVs=void 0,n.uvs=void 0,n.triangles=void 0,n.color=new V(1,1,1,1),n.width=void 0,n.height=void 0,n.hullLength=void 0,n.edges=void 0,n.parentMesh=void 0,n.tempColor=new V(0,0,0,0),n}return k(a,[{key:"updateUVs",value:function(){var t=this.regionUVs;null!=this.uvs&&this.uvs.length==t.length||(this.uvs=_.newFloatArray(t.length));var e=this.uvs,a=this.uvs.length,n=this.region.u,r=this.region.v,i=0,s=0;if(this.region instanceof ht){var o=this.region,l=o.texture.getImage().width,h=o.texture.getImage().height;switch(o.degrees){case 90:n-=(o.originalHeight-o.offsetY-o.height)/l,r-=(o.originalWidth-o.offsetX-o.width)/h,i=o.originalHeight/l,s=o.originalWidth/h;for(var u=0;u<a;u+=2)e[u]=n+t[u+1]*i,e[u+1]=r+(1-t[u])*s;return;case 180:n-=(o.originalWidth-o.offsetX-o.width)/l,r-=o.offsetY/h,i=o.originalWidth/l,s=o.originalHeight/h;for(var c=0;c<a;c+=2)e[c]=n+(1-t[c])*i,e[c+1]=r+(1-t[c+1])*s;return;case 270:n-=o.offsetY/l,r-=o.offsetX/h,i=o.originalHeight/l,s=o.originalWidth/h;for(var d=0;d<a;d+=2)e[d]=n+(1-t[d+1])*i,e[d+1]=r+t[d]*s;return}n-=o.offsetX/l,r-=(o.originalHeight-o.offsetY-o.height)/h,i=o.originalWidth/l,s=o.originalHeight/h}else null==this.region?(n=r=0,i=s=1):(i=this.region.u2-n,s=this.region.v2-r);for(var f=0;f<a;f+=2)e[f]=n+t[f]*i,e[f+1]=r+t[f+1]*s}},{key:"getParentMesh",value:function(){return this.parentMesh}},{key:"setParentMesh",value:function(t){this.parentMesh=t,null!=t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}},{key:"copy",value:function(){if(null!=this.parentMesh)return this.newLinkedMesh();var t=new a(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),this.copyTo(t),t.regionUVs=new Array(this.regionUVs.length),_.arrayCopy(this.regionUVs,0,t.regionUVs,0,this.regionUVs.length),t.uvs=new Array(this.uvs.length),_.arrayCopy(this.uvs,0,t.uvs,0,this.uvs.length),t.triangles=new Array(this.triangles.length),_.arrayCopy(this.triangles,0,t.triangles,0,this.triangles.length),t.hullLength=this.hullLength,null!=this.edges&&(t.edges=new Array(this.edges.length),_.arrayCopy(this.edges,0,t.edges,0,this.edges.length)),t.width=this.width,t.height=this.height,t}},{key:"newLinkedMesh",value:function(){var t=new a(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),t.deformAttachment=this.deformAttachment,t.setParentMesh(null!=this.parentMesh?this.parentMesh:this),t.updateUVs(),t}}]),a}(),ct=function(){function t(e){if(y(this,t),this.data=void 0,this.bones=void 0,this.slots=void 0,this.drawOrder=void 0,this.ikConstraints=void 0,this.transformConstraints=void 0,this.pathConstraints=void 0,this._updateCache=new Array,this.updateCacheReset=new Array,this.skin=void 0,this.color=void 0,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==e)throw new Error("data cannot be null.");this.data=e,this.bones=new Array;for(var a=0;a<e.bones.length;a++){var n=e.bones[a],r=void 0;if(null==n.parent)r=new B(n,this,null);else{var i=this.bones[n.parent.index];r=new B(n,this,i),i.children.push(r)}this.bones.push(r)}this.slots=new Array,this.drawOrder=new Array;for(var s=0;s<e.slots.length;s++){var o=e.slots[s],l=this.bones[o.boneData.index],h=new U(o,l);this.slots.push(h),this.drawOrder.push(h)}this.ikConstraints=new Array;for(var u=0;u<e.ikConstraints.length;u++){var c=e.ikConstraints[u];this.ikConstraints.push(new W(c,this))}this.transformConstraints=new Array;for(var d=0;d<e.transformConstraints.length;d++){var f=e.transformConstraints[d];this.transformConstraints.push(new q(f,this))}this.pathConstraints=new Array;for(var v=0;v<e.pathConstraints.length;v++){var g=e.pathConstraints[v];this.pathConstraints.push(new Q(g,this))}this.color=new V(1,1,1,1),this.updateCache()}return k(t,[{key:"updateCache",value:function(){var t=this._updateCache;t.length=0,this.updateCacheReset.length=0;for(var e=this.bones,a=0,n=e.length;a<n;a++){var r=e[a];r.sorted=r.data.skinRequired,r.active=!r.sorted}if(null!=this.skin)for(var i=this.skin.bones,s=0,o=this.skin.bones.length;s<o;s++){var l=this.bones[i[s].index];do{l.sorted=!1,l.active=!0,l=l.parent}while(null!=l)}var h=this.ikConstraints,u=this.transformConstraints,c=this.pathConstraints,d=h.length,f=u.length,v=c.length,g=d+f+v;t:for(var m=0;m<g;m++){for(var p=0;p<d;p++){var y=h[p];if(y.data.order==m){this.sortIkConstraint(y);continue t}}for(var w=0;w<f;w++){var k=u[w];if(k.data.order==m){this.sortTransformConstraint(k);continue t}}for(var E=0;E<v;E++){var x=c[E];if(x.data.order==m){this.sortPathConstraint(x);continue t}}}for(var b=0,M=e.length;b<M;b++)this.sortBone(e[b])}},{key:"sortIkConstraint",value:function(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&_.contains(this.skin.constraints,t.data,!0)),t.active){var e=t.target;this.sortBone(e);var a=t.bones,n=a[0];if(this.sortBone(n),a.length>1){var r=a[a.length-1];this._updateCache.indexOf(r)>-1||this.updateCacheReset.push(r)}this._updateCache.push(t),this.sortReset(n.children),a[a.length-1].sorted=!0}}},{key:"sortPathConstraint",value:function(t){if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||null!=this.skin&&_.contains(this.skin.constraints,t.data,!0)),t.active){var e=t.target,a=e.data.index,n=e.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,a,n),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,a,n);for(var r=0,i=this.data.skins.length;r<i;r++)this.sortPathConstraintAttachment(this.data.skins[r],a,n);var s=e.getAttachment();s instanceof Z&&this.sortPathConstraintAttachmentWith(s,n);for(var o=t.bones,l=o.length,h=0;h<l;h++)this.sortBone(o[h]);this._updateCache.push(t);for(var u=0;u<l;u++)this.sortReset(o[u].children);for(var c=0;c<l;c++)o[c].sorted=!0}}},{key:"sortTransformConstraint",value:function(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&_.contains(this.skin.constraints,t.data,!0)),t.active){this.sortBone(t.target);var e=t.bones,a=e.length;if(t.data.local)for(var n=0;n<a;n++){var r=e[n];this.sortBone(r.parent),this._updateCache.indexOf(r)>-1||this.updateCacheReset.push(r)}else for(var i=0;i<a;i++)this.sortBone(e[i]);this._updateCache.push(t);for(var s=0;s<a;s++)this.sortReset(e[s].children);for(var o=0;o<a;o++)e[o].sorted=!0}}},{key:"sortPathConstraintAttachment",value:function(t,e,a){var n=t.attachments[e];if(n)for(var r in n)this.sortPathConstraintAttachmentWith(n[r],a)}},{key:"sortPathConstraintAttachmentWith",value:function(t,e){if(t instanceof Z){var a=t.bones;if(null==a)this.sortBone(e);else for(var n=this.bones,r=0;r<a.length;)for(var i=a[r++],s=r+i;r<s;r++){var o=a[r];this.sortBone(n[o])}}}},{key:"sortBone",value:function(t){if(!t.sorted){var e=t.parent;null!=e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}}},{key:"sortReset",value:function(t){for(var e=0,a=t.length;e<a;e++){var n=t[e];n.active&&(n.sorted&&this.sortReset(n.children),n.sorted=!1)}}},{key:"updateWorldTransform",value:function(){for(var t=this.updateCacheReset,e=0,a=t.length;e<a;e++){var n=t[e];n.ax=n.x,n.ay=n.y,n.arotation=n.rotation,n.ascaleX=n.scaleX,n.ascaleY=n.scaleY,n.ashearX=n.shearX,n.ashearY=n.shearY,n.appliedValid=!0}for(var r=this._updateCache,i=0,s=r.length;i<s;i++)r[i].update()}},{key:"setToSetupPose",value:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}},{key:"setBonesToSetupPose",value:function(){for(var t=this.bones,e=0,a=t.length;e<a;e++)t[e].setToSetupPose();for(var n=this.ikConstraints,r=0,i=n.length;r<i;r++){var s=n[r];s.mix=s.data.mix,s.softness=s.data.softness,s.bendDirection=s.data.bendDirection,s.compress=s.data.compress,s.stretch=s.data.stretch}for(var o=this.transformConstraints,l=0,h=o.length;l<h;l++){var u=o[l],c=u.data;u.rotateMix=c.rotateMix,u.translateMix=c.translateMix,u.scaleMix=c.scaleMix,u.shearMix=c.shearMix}for(var d=this.pathConstraints,f=0,v=d.length;f<v;f++){var g=d[f],m=g.data;g.position=m.position,g.spacing=m.spacing,g.rotateMix=m.rotateMix,g.translateMix=m.translateMix}}},{key:"setSlotsToSetupPose",value:function(){var t=this.slots;_.arrayCopy(t,0,this.drawOrder,0,t.length);for(var e=0,a=t.length;e<a;e++)t[e].setToSetupPose()}},{key:"getRootBone",value:function(){return 0==this.bones.length?null:this.bones[0]}},{key:"findBone",value:function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,a=0,n=e.length;a<n;a++){var r=e[a];if(r.data.name==t)return r}return null}},{key:"findBoneIndex",value:function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,a=0,n=e.length;a<n;a++)if(e[a].data.name==t)return a;return-1}},{key:"findSlot",value:function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,a=0,n=e.length;a<n;a++){var r=e[a];if(r.data.name==t)return r}return null}},{key:"findSlotIndex",value:function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,a=0,n=e.length;a<n;a++)if(e[a].data.name==t)return a;return-1}},{key:"setSkinByName",value:function(t){var e=this.data.findSkin(t);if(null==e)throw new Error("Skin not found: "+t);this.setSkin(e)}},{key:"setSkin",value:function(t){if(t!=this.skin){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else for(var e=this.slots,a=0,n=e.length;a<n;a++){var r=e[a],i=r.data.attachmentName;if(null!=i){var s=t.getAttachment(a,i);null!=s&&r.setAttachment(s)}}this.skin=t,this.updateCache()}}},{key:"getAttachmentByName",value:function(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)}},{key:"getAttachment",value:function(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){var a=this.skin.getAttachment(t,e);if(null!=a)return a}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null}},{key:"setAttachment",value:function(t,e){if(null==t)throw new Error("slotName cannot be null.");for(var a=this.slots,n=0,r=a.length;n<r;n++){var i=a[n];if(i.data.name==t){var s=null;if(null!=e&&null==(s=this.getAttachment(n,e)))throw new Error("Attachment not found: "+e+", for slot: "+t);return void i.setAttachment(s)}}throw new Error("Slot not found: "+t)}},{key:"findIkConstraint",value:function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,a=0,n=e.length;a<n;a++){var r=e[a];if(r.data.name==t)return r}return null}},{key:"findTransformConstraint",value:function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,a=0,n=e.length;a<n;a++){var r=e[a];if(r.data.name==t)return r}return null}},{key:"findPathConstraint",value:function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,a=0,n=e.length;a<n;a++){var r=e[a];if(r.data.name==t)return r}return null}},{key:"getBounds",value:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Array(2);if(null==t)throw new Error("offset cannot be null.");if(null==e)throw new Error("size cannot be null.");for(var n=this.drawOrder,r=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY,l=0,h=n.length;l<h;l++){var u=n[l];if(u.bone.active){var c=0,d=null,f=u.getAttachment();if(f instanceof K)c=8,d=_.setArraySize(a,c,0),f.computeWorldVertices(u.bone,d,0,2);else if(f instanceof ut){var v=f;c=v.worldVerticesLength,d=_.setArraySize(a,c,0),v.computeWorldVertices(u,0,c,d,0,2)}if(null!=d)for(var g=0,m=d.length;g<m;g+=2){var p=d[g],y=d[g+1];r=Math.min(r,p),i=Math.min(i,y),s=Math.max(s,p),o=Math.max(o,y)}}}t.set(r,i),e.set(s-r,o-i)}},{key:"update",value:function(t){this.time+=t}}]),t}(),dt=function(){function t(e,a,n){if(y(this,t),this.name=void 0,this.timelines=void 0,this.timelineIds=void 0,this.duration=void 0,null==e)throw new Error("name cannot be null.");if(null==a)throw new Error("timelines cannot be null.");this.name=e,this.timelines=a,this.timelineIds=[];for(var r=0;r<a.length;r++)this.timelineIds[a[r].getPropertyId()]=!0;this.duration=n}return k(t,[{key:"hasTimeline",value:function(t){return 1==this.timelineIds[t]}},{key:"apply",value:function(t,e,a,n,r,i,s,o){if(null==t)throw new Error("skeleton cannot be null.");n&&0!=this.duration&&(a%=this.duration,e>0&&(e%=this.duration));for(var l=this.timelines,h=0,u=l.length;h<u;h++)l[h].apply(t,e,a,r,i,s,o)}}],[{key:"binarySearch",value:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=0,r=t.length/a-2;if(0==r)return a;for(var i=r>>>1;;){if(t[(i+1)*a]<=e?n=i+1:r=i,n==r)return(n+1)*a;i=n+r>>>1}}},{key:"linearSearch",value:function(t,e,a){for(var n=0,r=t.length-a;n<=r;n+=a)if(t[n]>e)return n;return-1}}]),t}();!function(t){t[t.setup=0]="setup",t[t.first=1]="first",t[t.replace=2]="replace",t[t.add=3]="add"}(et||(et={})),function(t){t[t.mixIn=0]="mixIn",t[t.mixOut=1]="mixOut"}(at||(at={})),function(t){t[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix",t[t.twoColor=14]="twoColor"}(nt||(nt={}));var ft=function(){function t(e){if(y(this,t),this.curves=void 0,e<=0)throw new Error("frameCount must be > 0: "+e);this.curves=_.newFloatArray((e-1)*t.BEZIER_SIZE)}return k(t,[{key:"getFrameCount",value:function(){return this.curves.length/t.BEZIER_SIZE+1}},{key:"setLinear",value:function(e){this.curves[e*t.BEZIER_SIZE]=t.LINEAR}},{key:"setStepped",value:function(e){this.curves[e*t.BEZIER_SIZE]=t.STEPPED}},{key:"getCurveType",value:function(e){var a=e*t.BEZIER_SIZE;if(a==this.curves.length)return t.LINEAR;var n=this.curves[a];return n==t.LINEAR?t.LINEAR:n==t.STEPPED?t.STEPPED:t.BEZIER}},{key:"setCurve",value:function(e,a,n,r,i){var s=.03*(2*-a+r),o=.03*(2*-n+i),l=.006*(3*(a-r)+1),h=.006*(3*(n-i)+1),u=2*s+l,c=2*o+h,d=.3*a+s+.16666667*l,f=.3*n+o+.16666667*h,v=e*t.BEZIER_SIZE,g=this.curves;g[v++]=t.BEZIER;for(var m=d,p=f,y=v+t.BEZIER_SIZE-1;v<y;v+=2)g[v]=m,g[v+1]=p,d+=u,f+=c,u+=l,c+=h,m+=d,p+=f}},{key:"getCurvePercent",value:function(e,a){a=P.clamp(a,0,1);var n=this.curves,r=e*t.BEZIER_SIZE,i=n[r];if(i==t.LINEAR)return a;if(i==t.STEPPED)return 0;for(var s=0,o=++r,l=r+t.BEZIER_SIZE-1;r<l;r+=2)if((s=n[r])>=a){var h=void 0,u=void 0;return r==o?(h=0,u=0):(h=n[r-2],u=n[r-1]),u+(n[r+1]-u)*(a-h)/(s-h)}var c=n[r-1];return c+(1-c)*(a-s)/(1-s)}}]),t}();ft.LINEAR=0,ft.STEPPED=1,ft.BEZIER=2,ft.BEZIER_SIZE=19;var vt=function(t){x(a,ft);var e=T(a);function a(t){var n;return y(this,a),(n=e.call(this,t)).boneIndex=void 0,n.frames=void 0,n.frames=_.newFloatArray(t<<1),n}return k(a,[{key:"getPropertyId",value:function(){return(nt.rotate<<24)+this.boneIndex}},{key:"setFrame",value:function(t,e,n){t<<=1,this.frames[t]=e,this.frames[t+a.ROTATION]=n}},{key:"apply",value:function(t,e,n,r,i,s,o){var l=this.frames,h=t.bones[this.boneIndex];if(h.active)if(n<l[0])switch(s){case et.setup:return void(h.rotation=h.data.rotation);case et.first:var u=h.data.rotation-h.rotation;h.rotation+=(u-360*(16384-(16384.499999999996-u/360|0)))*i}else if(n>=l[l.length-a.ENTRIES]){var c=l[l.length+a.PREV_ROTATION];switch(s){case et.setup:h.rotation=h.data.rotation+c*i;break;case et.first:case et.replace:c+=h.data.rotation-h.rotation,c-=360*(16384-(16384.499999999996-c/360|0));case et.add:h.rotation+=c*i}}else{var d=dt.binarySearch(l,n,a.ENTRIES),f=l[d+a.PREV_ROTATION],v=l[d],g=this.getCurvePercent((d>>1)-1,1-(n-v)/(l[d+a.PREV_TIME]-v)),m=l[d+a.ROTATION]-f;switch(m=f+(m-360*(16384-(16384.499999999996-m/360|0)))*g,s){case et.setup:h.rotation=h.data.rotation+(m-360*(16384-(16384.499999999996-m/360|0)))*i;break;case et.first:case et.replace:m+=h.data.rotation-h.rotation;case et.add:h.rotation+=(m-360*(16384-(16384.499999999996-m/360|0)))*i}}}}]),a}();vt.ENTRIES=2,vt.PREV_TIME=-2,vt.PREV_ROTATION=-1,vt.ROTATION=1;var gt=function(t){x(a,ft);var e=T(a);function a(t){var n;return y(this,a),(n=e.call(this,t)).boneIndex=void 0,n.frames=void 0,n.frames=_.newFloatArray(t*a.ENTRIES),n}return k(a,[{key:"getPropertyId",value:function(){return(nt.translate<<24)+this.boneIndex}},{key:"setFrame",value:function(t,e,n,r){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.X]=n,this.frames[t+a.Y]=r}},{key:"apply",value:function(t,e,n,r,i,s,o){var l=this.frames,h=t.bones[this.boneIndex];if(h.active)if(n<l[0])switch(s){case et.setup:return h.x=h.data.x,void(h.y=h.data.y);case et.first:h.x+=(h.data.x-h.x)*i,h.y+=(h.data.y-h.y)*i}else{var u=0,c=0;if(n>=l[l.length-a.ENTRIES])u=l[l.length+a.PREV_X],c=l[l.length+a.PREV_Y];else{var d=dt.binarySearch(l,n,a.ENTRIES);u=l[d+a.PREV_X],c=l[d+a.PREV_Y];var f=l[d],v=this.getCurvePercent(d/a.ENTRIES-1,1-(n-f)/(l[d+a.PREV_TIME]-f));u+=(l[d+a.X]-u)*v,c+=(l[d+a.Y]-c)*v}switch(s){case et.setup:h.x=h.data.x+u*i,h.y=h.data.y+c*i;break;case et.first:case et.replace:h.x+=(h.data.x+u-h.x)*i,h.y+=(h.data.y+c-h.y)*i;break;case et.add:h.x+=u*i,h.y+=c*i}}}}]),a}();gt.ENTRIES=3,gt.PREV_TIME=-3,gt.PREV_X=-2,gt.PREV_Y=-1,gt.X=1,gt.Y=2;var mt=function(t){x(a,gt);var e=T(a);function a(t){return y(this,a),e.call(this,t)}return k(a,[{key:"getPropertyId",value:function(){return(nt.scale<<24)+this.boneIndex}},{key:"apply",value:function(t,e,n,r,i,s,o){var l=this.frames,h=t.bones[this.boneIndex];if(h.active)if(n<l[0])switch(s){case et.setup:return h.scaleX=h.data.scaleX,void(h.scaleY=h.data.scaleY);case et.first:h.scaleX+=(h.data.scaleX-h.scaleX)*i,h.scaleY+=(h.data.scaleY-h.scaleY)*i}else{var u=0,c=0;if(n>=l[l.length-a.ENTRIES])u=l[l.length+a.PREV_X]*h.data.scaleX,c=l[l.length+a.PREV_Y]*h.data.scaleY;else{var d=dt.binarySearch(l,n,a.ENTRIES);u=l[d+a.PREV_X],c=l[d+a.PREV_Y];var f=l[d],v=this.getCurvePercent(d/a.ENTRIES-1,1-(n-f)/(l[d+a.PREV_TIME]-f));u=(u+(l[d+a.X]-u)*v)*h.data.scaleX,c=(c+(l[d+a.Y]-c)*v)*h.data.scaleY}if(1==i)s==et.add?(h.scaleX+=u-h.data.scaleX,h.scaleY+=c-h.data.scaleY):(h.scaleX=u,h.scaleY=c);else{var g=0,m=0;if(o==at.mixOut)switch(s){case et.setup:g=h.data.scaleX,m=h.data.scaleY,h.scaleX=g+(Math.abs(u)*P.signum(g)-g)*i,h.scaleY=m+(Math.abs(c)*P.signum(m)-m)*i;break;case et.first:case et.replace:g=h.scaleX,m=h.scaleY,h.scaleX=g+(Math.abs(u)*P.signum(g)-g)*i,h.scaleY=m+(Math.abs(c)*P.signum(m)-m)*i;break;case et.add:g=h.scaleX,m=h.scaleY,h.scaleX=g+(Math.abs(u)*P.signum(g)-h.data.scaleX)*i,h.scaleY=m+(Math.abs(c)*P.signum(m)-h.data.scaleY)*i}else switch(s){case et.setup:g=Math.abs(h.data.scaleX)*P.signum(u),m=Math.abs(h.data.scaleY)*P.signum(c),h.scaleX=g+(u-g)*i,h.scaleY=m+(c-m)*i;break;case et.first:case et.replace:g=Math.abs(h.scaleX)*P.signum(u),m=Math.abs(h.scaleY)*P.signum(c),h.scaleX=g+(u-g)*i,h.scaleY=m+(c-m)*i;break;case et.add:g=P.signum(u),m=P.signum(c),h.scaleX=Math.abs(h.scaleX)*g+(u-Math.abs(h.data.scaleX)*g)*i,h.scaleY=Math.abs(h.scaleY)*m+(c-Math.abs(h.data.scaleY)*m)*i}}}}}]),a}(),pt=function(t){x(a,gt);var e=T(a);function a(t){return y(this,a),e.call(this,t)}return k(a,[{key:"getPropertyId",value:function(){return(nt.shear<<24)+this.boneIndex}},{key:"apply",value:function(t,e,n,r,i,s,o){var l=this.frames,h=t.bones[this.boneIndex];if(h.active)if(n<l[0])switch(s){case et.setup:return h.shearX=h.data.shearX,void(h.shearY=h.data.shearY);case et.first:h.shearX+=(h.data.shearX-h.shearX)*i,h.shearY+=(h.data.shearY-h.shearY)*i}else{var u=0,c=0;if(n>=l[l.length-a.ENTRIES])u=l[l.length+a.PREV_X],c=l[l.length+a.PREV_Y];else{var d=dt.binarySearch(l,n,a.ENTRIES);u=l[d+a.PREV_X],c=l[d+a.PREV_Y];var f=l[d],v=this.getCurvePercent(d/a.ENTRIES-1,1-(n-f)/(l[d+a.PREV_TIME]-f));u+=(l[d+a.X]-u)*v,c+=(l[d+a.Y]-c)*v}switch(s){case et.setup:h.shearX=h.data.shearX+u*i,h.shearY=h.data.shearY+c*i;break;case et.first:case et.replace:h.shearX+=(h.data.shearX+u-h.shearX)*i,h.shearY+=(h.data.shearY+c-h.shearY)*i;break;case et.add:h.shearX+=u*i,h.shearY+=c*i}}}}]),a}(),yt=function(t){x(a,ft);var e=T(a);function a(t){var n;return y(this,a),(n=e.call(this,t)).slotIndex=void 0,n.frames=void 0,n.frames=_.newFloatArray(t*a.ENTRIES),n}return k(a,[{key:"getPropertyId",value:function(){return(nt.color<<24)+this.slotIndex}},{key:"setFrame",value:function(t,e,n,r,i,s){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.R]=n,this.frames[t+a.G]=r,this.frames[t+a.B]=i,this.frames[t+a.A]=s}},{key:"apply",value:function(t,e,n,r,i,s,o){var l=t.slots[this.slotIndex];if(l.bone.active){var h=this.frames;if(n<h[0])switch(s){case et.setup:return void l.color.setFromColor(l.data.color);case et.first:var u=l.color,c=l.data.color;u.add((c.r-u.r)*i,(c.g-u.g)*i,(c.b-u.b)*i,(c.a-u.a)*i)}else{var d=0,f=0,v=0,g=0;if(n>=h[h.length-a.ENTRIES]){var m=h.length;d=h[m+a.PREV_R],f=h[m+a.PREV_G],v=h[m+a.PREV_B],g=h[m+a.PREV_A]}else{var p=dt.binarySearch(h,n,a.ENTRIES);d=h[p+a.PREV_R],f=h[p+a.PREV_G],v=h[p+a.PREV_B],g=h[p+a.PREV_A];var y=h[p],w=this.getCurvePercent(p/a.ENTRIES-1,1-(n-y)/(h[p+a.PREV_TIME]-y));d+=(h[p+a.R]-d)*w,f+=(h[p+a.G]-f)*w,v+=(h[p+a.B]-v)*w,g+=(h[p+a.A]-g)*w}if(1==i)l.color.set(d,f,v,g);else{var k=l.color;s==et.setup&&k.setFromColor(l.data.color),k.add((d-k.r)*i,(f-k.g)*i,(v-k.b)*i,(g-k.a)*i)}}}}}]),a}();yt.ENTRIES=5,yt.PREV_TIME=-5,yt.PREV_R=-4,yt.PREV_G=-3,yt.PREV_B=-2,yt.PREV_A=-1,yt.R=1,yt.G=2,yt.B=3,yt.A=4;var wt=function(t){x(a,ft);var e=T(a);function a(t){var n;return y(this,a),(n=e.call(this,t)).slotIndex=void 0,n.frames=void 0,n.frames=_.newFloatArray(t*a.ENTRIES),n}return k(a,[{key:"getPropertyId",value:function(){return(nt.twoColor<<24)+this.slotIndex}},{key:"setFrame",value:function(t,e,n,r,i,s,o,l,h){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.R]=n,this.frames[t+a.G]=r,this.frames[t+a.B]=i,this.frames[t+a.A]=s,this.frames[t+a.R2]=o,this.frames[t+a.G2]=l,this.frames[t+a.B2]=h}},{key:"apply",value:function(t,e,n,r,i,s,o){var l=t.slots[this.slotIndex];if(l.bone.active){var h=this.frames;if(n<h[0])switch(s){case et.setup:return l.color.setFromColor(l.data.color),void l.darkColor.setFromColor(l.data.darkColor);case et.first:var u=l.color,c=l.darkColor,d=l.data.color,f=l.data.darkColor;u.add((d.r-u.r)*i,(d.g-u.g)*i,(d.b-u.b)*i,(d.a-u.a)*i),c.add((f.r-c.r)*i,(f.g-c.g)*i,(f.b-c.b)*i,0)}else{var v=0,g=0,m=0,p=0,y=0,w=0,k=0;if(n>=h[h.length-a.ENTRIES]){var E=h.length;v=h[E+a.PREV_R],g=h[E+a.PREV_G],m=h[E+a.PREV_B],p=h[E+a.PREV_A],y=h[E+a.PREV_R2],w=h[E+a.PREV_G2],k=h[E+a.PREV_B2]}else{var x=dt.binarySearch(h,n,a.ENTRIES);v=h[x+a.PREV_R],g=h[x+a.PREV_G],m=h[x+a.PREV_B],p=h[x+a.PREV_A],y=h[x+a.PREV_R2],w=h[x+a.PREV_G2],k=h[x+a.PREV_B2];var b=h[x],M=this.getCurvePercent(x/a.ENTRIES-1,1-(n-b)/(h[x+a.PREV_TIME]-b));v+=(h[x+a.R]-v)*M,g+=(h[x+a.G]-g)*M,m+=(h[x+a.B]-m)*M,p+=(h[x+a.A]-p)*M,y+=(h[x+a.R2]-y)*M,w+=(h[x+a.G2]-w)*M,k+=(h[x+a.B2]-k)*M}if(1==i)l.color.set(v,g,m,p),l.darkColor.set(y,w,k,1);else{var S=l.color,I=l.darkColor;s==et.setup&&(S.setFromColor(l.data.color),I.setFromColor(l.data.darkColor)),S.add((v-S.r)*i,(g-S.g)*i,(m-S.b)*i,(p-S.a)*i),I.add((y-I.r)*i,(w-I.g)*i,(k-I.b)*i,0)}}}}}]),a}();wt.ENTRIES=8,wt.PREV_TIME=-8,wt.PREV_R=-7,wt.PREV_G=-6,wt.PREV_B=-5,wt.PREV_A=-4,wt.PREV_R2=-3,wt.PREV_G2=-2,wt.PREV_B2=-1,wt.R=1,wt.G=2,wt.B=3,wt.A=4,wt.R2=5,wt.G2=6,wt.B2=7;var kt=function(){function t(e){y(this,t),this.slotIndex=void 0,this.frames=void 0,this.attachmentNames=void 0,this.frames=_.newFloatArray(e),this.attachmentNames=new Array(e)}return k(t,[{key:"getPropertyId",value:function(){return(nt.attachment<<24)+this.slotIndex}},{key:"getFrameCount",value:function(){return this.frames.length}},{key:"setFrame",value:function(t,e,a){this.frames[t]=e,this.attachmentNames[t]=a}},{key:"apply",value:function(t,e,a,n,r,i,s){var o=t.slots[this.slotIndex];if(o.bone.active)if(s!=at.mixOut){var l=this.frames;if(a<l[0])i!=et.setup&&i!=et.first||this.setAttachment(t,o,o.data.attachmentName);else{var h=0;h=a>=l[l.length-1]?l.length-1:dt.binarySearch(l,a,1)-1;var u=this.attachmentNames[h];t.slots[this.slotIndex].setAttachment(null==u?null:t.getAttachment(this.slotIndex,u))}}else i==et.setup&&this.setAttachment(t,o,o.data.attachmentName)}},{key:"setAttachment",value:function(t,e,a){e.attachment=null==a?null:t.getAttachment(this.slotIndex,a)}}]),t}(),Et=null,xt=function(t){x(a,ft);var e=T(a);function a(t){var n;return y(this,a),(n=e.call(this,t)).slotIndex=void 0,n.attachment=void 0,n.frames=void 0,n.frameVertices=void 0,n.frames=_.newFloatArray(t),n.frameVertices=new Array(t),null==Et&&(Et=_.newFloatArray(64)),n}return k(a,[{key:"getPropertyId",value:function(){return(nt.deform<<27)+ +this.attachment.id+this.slotIndex}},{key:"setFrame",value:function(t,e,a){this.frames[t]=e,this.frameVertices[t]=a}},{key:"apply",value:function(t,e,a,n,r,i,s){var o=t.slots[this.slotIndex];if(o.bone.active){var l=o.getAttachment();if(l instanceof G&&l.deformAttachment==this.attachment){var h=o.deform;0==h.length&&(i=et.setup);var u=this.frameVertices,c=u[0].length,d=this.frames;if(a<d[0]){var f=l;switch(i){case et.setup:return void(h.length=0);case et.first:if(1==r){h.length=0;break}var v=_.setArraySize(h,c);if(null==f.bones)for(var g=f.vertices,m=0;m<c;m++)v[m]+=(g[m]-v[m])*r;else{r=1-r;for(m=0;m<c;m++)v[m]*=r}}}else{var p=_.setArraySize(h,c);if(a>=d[d.length-1]){var y=u[d.length-1];if(1==r)if(i==et.add){var w=l;if(null==w.bones)for(var k=w.vertices,E=0;E<c;E++)p[E]+=y[E]-k[E];else for(var x=0;x<c;x++)p[x]+=y[x]}else _.arrayCopy(y,0,p,0,c);else switch(i){case et.setup:var b=l;if(null==b.bones)for(var M=b.vertices,S=0;S<c;S++){var I=M[S];p[S]=I+(y[S]-I)*r}else for(var T=0;T<c;T++)p[T]=y[T]*r;break;case et.first:case et.replace:for(var R=0;R<c;R++)p[R]+=(y[R]-p[R])*r;break;case et.add:var A=l;if(null==A.bones)for(var C=A.vertices,V=0;V<c;V++)p[V]+=(y[V]-C[V])*r;else for(var P=0;P<c;P++)p[P]+=y[P]*r}}else{var F=dt.binarySearch(d,a),N=u[F-1],O=u[F],L=d[F],D=this.getCurvePercent(F-1,1-(a-L)/(d[F-1]-L));if(1==r)if(i==et.add){var X=l;if(null==X.bones)for(var Y=X.vertices,B=0;B<c;B++){var U=N[B];p[B]+=U+(O[B]-U)*D-Y[B]}else for(var W=0;W<c;W++){var q=N[W];p[W]+=q+(O[W]-q)*D}}else for(var H=0;H<c;H++){var j=N[H];p[H]=j+(O[H]-j)*D}else switch(i){case et.setup:var z=l;if(null==z.bones)for(var Z=z.vertices,Q=0;Q<c;Q++){var K=N[Q],J=Z[Q];p[Q]=J+(K+(O[Q]-K)*D-J)*r}else for(var $=0;$<c;$++){var tt=N[$];p[$]=(tt+(O[$]-tt)*D)*r}break;case et.first:case et.replace:for(var at=0;at<c;at++){var nt=N[at];p[at]+=(nt+(O[at]-nt)*D-p[at])*r}break;case et.add:var rt=l;if(null==rt.bones)for(var it=rt.vertices,st=0;st<c;st++){var ot=N[st];p[st]+=(ot+(O[st]-ot)*D-it[st])*r}else for(var lt=0;lt<c;lt++){var ht=N[lt];p[lt]+=(ht+(O[lt]-ht)*D)*r}}}}}}}}]),a}(),bt=function(){function t(e){y(this,t),this.frames=void 0,this.events=void 0,this.frames=_.newFloatArray(e),this.events=new Array(e)}return k(t,[{key:"getPropertyId",value:function(){return nt.event<<24}},{key:"getFrameCount",value:function(){return this.frames.length}},{key:"setFrame",value:function(t,e){this.frames[t]=e.time,this.events[t]=e}},{key:"apply",value:function(t,e,a,n,r,i,s){if(null!=n){var o=this.frames,l=this.frames.length;if(e>a)this.apply(t,e,Number.MAX_VALUE,n,r,i,s),e=-1;else if(e>=o[l-1])return;if(!(a<o[0])){var h=0;if(e<o[0])h=0;else for(var u=o[h=dt.binarySearch(o,e)];h>0&&o[h-1]==u;)h--;for(;h<l&&a>=o[h];h++)n.push(this.events[h])}}}}]),t}(),Mt=function(){function t(e){y(this,t),this.frames=void 0,this.drawOrders=void 0,this.frames=_.newFloatArray(e),this.drawOrders=new Array(e)}return k(t,[{key:"getPropertyId",value:function(){return nt.drawOrder<<24}},{key:"getFrameCount",value:function(){return this.frames.length}},{key:"setFrame",value:function(t,e,a){this.frames[t]=e,this.drawOrders[t]=a}},{key:"apply",value:function(t,e,a,n,r,i,s){var o=t.drawOrder,l=t.slots;if(s!=at.mixOut){var h=this.frames;if(a<h[0])i!=et.setup&&i!=et.first||_.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);else{var u=0;u=a>=h[h.length-1]?h.length-1:dt.binarySearch(h,a)-1;var c=this.drawOrders[u];if(null==c)_.arrayCopy(l,0,o,0,l.length);else for(var d=0,f=c.length;d<f;d++)o[d]=l[c[d]]}}else i==et.setup&&_.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length)}}]),t}(),St=function(t){x(a,ft);var e=T(a);function a(t){var n;return y(this,a),(n=e.call(this,t)).ikConstraintIndex=void 0,n.frames=void 0,n.frames=_.newFloatArray(t*a.ENTRIES),n}return k(a,[{key:"getPropertyId",value:function(){return(nt.ikConstraint<<24)+this.ikConstraintIndex}},{key:"setFrame",value:function(t,e,n,r,i,s,o){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.MIX]=n,this.frames[t+a.SOFTNESS]=r,this.frames[t+a.BEND_DIRECTION]=i,this.frames[t+a.COMPRESS]=s?1:0,this.frames[t+a.STRETCH]=o?1:0}},{key:"apply",value:function(t,e,n,r,i,s,o){var l=this.frames,h=t.ikConstraints[this.ikConstraintIndex];if(h.active)if(n<l[0])switch(s){case et.setup:return h.mix=h.data.mix,h.softness=h.data.softness,h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,void(h.stretch=h.data.stretch);case et.first:h.mix+=(h.data.mix-h.mix)*i,h.softness+=(h.data.softness-h.softness)*i,h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch}else if(n>=l[l.length-a.ENTRIES])s==et.setup?(h.mix=h.data.mix+(l[l.length+a.PREV_MIX]-h.data.mix)*i,h.softness=h.data.softness+(l[l.length+a.PREV_SOFTNESS]-h.data.softness)*i,o==at.mixOut?(h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch):(h.bendDirection=l[l.length+a.PREV_BEND_DIRECTION],h.compress=0!=l[l.length+a.PREV_COMPRESS],h.stretch=0!=l[l.length+a.PREV_STRETCH])):(h.mix+=(l[l.length+a.PREV_MIX]-h.mix)*i,h.softness+=(l[l.length+a.PREV_SOFTNESS]-h.softness)*i,o==at.mixIn&&(h.bendDirection=l[l.length+a.PREV_BEND_DIRECTION],h.compress=0!=l[l.length+a.PREV_COMPRESS],h.stretch=0!=l[l.length+a.PREV_STRETCH]));else{var u=dt.binarySearch(l,n,a.ENTRIES),c=l[u+a.PREV_MIX],d=l[u+a.PREV_SOFTNESS],f=l[u],v=this.getCurvePercent(u/a.ENTRIES-1,1-(n-f)/(l[u+a.PREV_TIME]-f));s==et.setup?(h.mix=h.data.mix+(c+(l[u+a.MIX]-c)*v-h.data.mix)*i,h.softness=h.data.softness+(d+(l[u+a.SOFTNESS]-d)*v-h.data.softness)*i,o==at.mixOut?(h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch):(h.bendDirection=l[u+a.PREV_BEND_DIRECTION],h.compress=0!=l[u+a.PREV_COMPRESS],h.stretch=0!=l[u+a.PREV_STRETCH])):(h.mix+=(c+(l[u+a.MIX]-c)*v-h.mix)*i,h.softness+=(d+(l[u+a.SOFTNESS]-d)*v-h.softness)*i,o==at.mixIn&&(h.bendDirection=l[u+a.PREV_BEND_DIRECTION],h.compress=0!=l[u+a.PREV_COMPRESS],h.stretch=0!=l[u+a.PREV_STRETCH]))}}}]),a}();St.ENTRIES=6,St.PREV_TIME=-6,St.PREV_MIX=-5,St.PREV_SOFTNESS=-4,St.PREV_BEND_DIRECTION=-3,St.PREV_COMPRESS=-2,St.PREV_STRETCH=-1,St.MIX=1,St.SOFTNESS=2,St.BEND_DIRECTION=3,St.COMPRESS=4,St.STRETCH=5;var It=function(t){x(a,ft);var e=T(a);function a(t){var n;return y(this,a),(n=e.call(this,t)).transformConstraintIndex=void 0,n.frames=void 0,n.frames=_.newFloatArray(t*a.ENTRIES),n}return k(a,[{key:"getPropertyId",value:function(){return(nt.transformConstraint<<24)+this.transformConstraintIndex}},{key:"setFrame",value:function(t,e,n,r,i,s){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.ROTATE]=n,this.frames[t+a.TRANSLATE]=r,this.frames[t+a.SCALE]=i,this.frames[t+a.SHEAR]=s}},{key:"apply",value:function(t,e,n,r,i,s,o){var l=this.frames,h=t.transformConstraints[this.transformConstraintIndex];if(h.active)if(n<l[0]){var u=h.data;switch(s){case et.setup:return h.rotateMix=u.rotateMix,h.translateMix=u.translateMix,h.scaleMix=u.scaleMix,void(h.shearMix=u.shearMix);case et.first:h.rotateMix+=(u.rotateMix-h.rotateMix)*i,h.translateMix+=(u.translateMix-h.translateMix)*i,h.scaleMix+=(u.scaleMix-h.scaleMix)*i,h.shearMix+=(u.shearMix-h.shearMix)*i}}else{var c=0,d=0,f=0,v=0;if(n>=l[l.length-a.ENTRIES]){var g=l.length;c=l[g+a.PREV_ROTATE],d=l[g+a.PREV_TRANSLATE],f=l[g+a.PREV_SCALE],v=l[g+a.PREV_SHEAR]}else{var m=dt.binarySearch(l,n,a.ENTRIES);c=l[m+a.PREV_ROTATE],d=l[m+a.PREV_TRANSLATE],f=l[m+a.PREV_SCALE],v=l[m+a.PREV_SHEAR];var p=l[m],y=this.getCurvePercent(m/a.ENTRIES-1,1-(n-p)/(l[m+a.PREV_TIME]-p));c+=(l[m+a.ROTATE]-c)*y,d+=(l[m+a.TRANSLATE]-d)*y,f+=(l[m+a.SCALE]-f)*y,v+=(l[m+a.SHEAR]-v)*y}if(s==et.setup){var w=h.data;h.rotateMix=w.rotateMix+(c-w.rotateMix)*i,h.translateMix=w.translateMix+(d-w.translateMix)*i,h.scaleMix=w.scaleMix+(f-w.scaleMix)*i,h.shearMix=w.shearMix+(v-w.shearMix)*i}else h.rotateMix+=(c-h.rotateMix)*i,h.translateMix+=(d-h.translateMix)*i,h.scaleMix+=(f-h.scaleMix)*i,h.shearMix+=(v-h.shearMix)*i}}}]),a}();It.ENTRIES=5,It.PREV_TIME=-5,It.PREV_ROTATE=-4,It.PREV_TRANSLATE=-3,It.PREV_SCALE=-2,It.PREV_SHEAR=-1,It.ROTATE=1,It.TRANSLATE=2,It.SCALE=3,It.SHEAR=4;var Tt=function(t){x(a,ft);var e=T(a);function a(t){var n;return y(this,a),(n=e.call(this,t)).pathConstraintIndex=void 0,n.frames=void 0,n.frames=_.newFloatArray(t*a.ENTRIES),n}return k(a,[{key:"getPropertyId",value:function(){return(nt.pathConstraintPosition<<24)+this.pathConstraintIndex}},{key:"setFrame",value:function(t,e,n){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.VALUE]=n}},{key:"apply",value:function(t,e,n,r,i,s,o){var l=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(h.active)if(n<l[0])switch(s){case et.setup:return void(h.position=h.data.position);case et.first:h.position+=(h.data.position-h.position)*i}else{var u=0;if(n>=l[l.length-a.ENTRIES])u=l[l.length+a.PREV_VALUE];else{var c=dt.binarySearch(l,n,a.ENTRIES);u=l[c+a.PREV_VALUE];var d=l[c],f=this.getCurvePercent(c/a.ENTRIES-1,1-(n-d)/(l[c+a.PREV_TIME]-d));u+=(l[c+a.VALUE]-u)*f}s==et.setup?h.position=h.data.position+(u-h.data.position)*i:h.position+=(u-h.position)*i}}}]),a}();Tt.ENTRIES=2,Tt.PREV_TIME=-2,Tt.PREV_VALUE=-1,Tt.VALUE=1;var Rt=function(t){x(a,Tt);var e=T(a);function a(t){return y(this,a),e.call(this,t)}return k(a,[{key:"getPropertyId",value:function(){return(nt.pathConstraintSpacing<<24)+this.pathConstraintIndex}},{key:"apply",value:function(t,e,n,r,i,s,o){var l=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(h.active)if(n<l[0])switch(s){case et.setup:return void(h.spacing=h.data.spacing);case et.first:h.spacing+=(h.data.spacing-h.spacing)*i}else{var u=0;if(n>=l[l.length-a.ENTRIES])u=l[l.length+a.PREV_VALUE];else{var c=dt.binarySearch(l,n,a.ENTRIES);u=l[c+a.PREV_VALUE];var d=l[c],f=this.getCurvePercent(c/a.ENTRIES-1,1-(n-d)/(l[c+a.PREV_TIME]-d));u+=(l[c+a.VALUE]-u)*f}s==et.setup?h.spacing=h.data.spacing+(u-h.data.spacing)*i:h.spacing+=(u-h.spacing)*i}}}]),a}(),At=function(t){x(a,ft);var e=T(a);function a(t){var n;return y(this,a),(n=e.call(this,t)).pathConstraintIndex=void 0,n.frames=void 0,n.frames=_.newFloatArray(t*a.ENTRIES),n}return k(a,[{key:"getPropertyId",value:function(){return(nt.pathConstraintMix<<24)+this.pathConstraintIndex}},{key:"setFrame",value:function(t,e,n,r){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.ROTATE]=n,this.frames[t+a.TRANSLATE]=r}},{key:"apply",value:function(t,e,n,r,i,s,o){var l=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(h.active)if(n<l[0])switch(s){case et.setup:return h.rotateMix=h.data.rotateMix,void(h.translateMix=h.data.translateMix);case et.first:h.rotateMix+=(h.data.rotateMix-h.rotateMix)*i,h.translateMix+=(h.data.translateMix-h.translateMix)*i}else{var u=0,c=0;if(n>=l[l.length-a.ENTRIES])u=l[l.length+a.PREV_ROTATE],c=l[l.length+a.PREV_TRANSLATE];else{var d=dt.binarySearch(l,n,a.ENTRIES);u=l[d+a.PREV_ROTATE],c=l[d+a.PREV_TRANSLATE];var f=l[d],v=this.getCurvePercent(d/a.ENTRIES-1,1-(n-f)/(l[d+a.PREV_TIME]-f));u+=(l[d+a.ROTATE]-u)*v,c+=(l[d+a.TRANSLATE]-c)*v}s==et.setup?(h.rotateMix=h.data.rotateMix+(u-h.data.rotateMix)*i,h.translateMix=h.data.translateMix+(c-h.data.translateMix)*i):(h.rotateMix+=(u-h.rotateMix)*i,h.translateMix+=(c-h.translateMix)*i)}}}]),a}();At.ENTRIES=3,At.PREV_TIME=-3,At.PREV_ROTATE=-2,At.PREV_TRANSLATE=-1,At.ROTATE=1,At.TRANSLATE=2;var Ct=function(){function t(e){y(this,t),this.data=void 0,this.tracks=new Array,this.timeScale=1,this.unkeyedState=0,this.events=new Array,this.listeners=new Array,this.queue=new _t(this),this.propertyIDs=new C,this.animationsChanged=!1,this.trackEntryPool=new N((function(){return new Pt})),this.data=e}return k(t,[{key:"update",value:function(t){t*=this.timeScale;for(var e=this.tracks,a=0,n=e.length;a<n;a++){var r=e[a];if(null!=r){r.animationLast=r.nextAnimationLast,r.trackLast=r.nextTrackLast;var i=t*r.timeScale;if(r.delay>0){if(r.delay-=i,r.delay>0)continue;i=-r.delay,r.delay=0}var s=r.next;if(null!=s){var o=r.trackLast-s.delay;if(o>=0){for(s.delay=0,s.trackTime+=0==r.timeScale?0:(o/r.timeScale+t)*s.timeScale,r.trackTime+=i,this.setCurrent(a,s,!0);null!=s.mixingFrom;)s.mixTime+=t,s=s.mixingFrom;continue}}else if(r.trackLast>=r.trackEnd&&null==r.mixingFrom){e[a]=null,this.queue.end(r),this.disposeNext(r);continue}if(null!=r.mixingFrom&&this.updateMixingFrom(r,t)){var l=r.mixingFrom;for(r.mixingFrom=null,null!=l&&(l.mixingTo=null);null!=l;)this.queue.end(l),l=l.mixingFrom}r.trackTime+=i}}this.queue.drain()}},{key:"updateMixingFrom",value:function(t,e){var a=t.mixingFrom;if(null==a)return!0;var n=this.updateMixingFrom(a,e);return a.animationLast=a.nextAnimationLast,a.trackLast=a.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=a.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=a.mixingFrom,null!=a.mixingFrom&&(a.mixingFrom.mixingTo=t),t.interruptAlpha=a.interruptAlpha,this.queue.end(a)),n):(a.trackTime+=e*a.timeScale,t.mixTime+=e,!1)}},{key:"apply",value:function(e){if(null==e)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();for(var a=this.events,n=this.tracks,r=!1,i=0,s=n.length;i<s;i++){var o=n[i];if(!(null==o||o.delay>0)){r=!0;var l=0==i?et.first:o.mixBlend,h=o.alpha;null!=o.mixingFrom?h*=this.applyMixingFrom(o,e,l):o.trackTime>=o.trackEnd&&null==o.next&&(h=0);var u=o.animationLast,c=o.getAnimationTime(),d=o.animation.timelines.length,f=o.animation.timelines;if(0==i&&1==h||l==et.add)for(var v=0;v<d;v++){_.webkit602BugfixHelper(h,l);var g=f[v];g instanceof kt?this.applyAttachmentTimeline(g,e,c,l,!0):g.apply(e,u,c,a,h,l,at.mixIn)}else{var m=o.timelineMode,p=0==o.timelinesRotation.length;p&&_.setArraySize(o.timelinesRotation,d<<1,null);for(var y=o.timelinesRotation,w=0;w<d;w++){var k=f[w],E=m[w]==t.SUBSEQUENT?l:et.setup;k instanceof vt?this.applyRotateTimeline(k,e,c,h,E,y,w<<1,p):k instanceof kt?this.applyAttachmentTimeline(k,e,c,l,!0):(_.webkit602BugfixHelper(h,l),k.apply(e,u,c,a,h,E,at.mixIn))}}this.queueEvents(o,c),a.length=0,o.nextAnimationLast=c,o.nextTrackLast=o.trackTime}}for(var x=this.unkeyedState+t.SETUP,b=e.slots,M=0,S=e.slots.length;M<S;M++){var I=b[M];if(I.attachmentState==x){var T=I.data.attachmentName;I.attachment=null==T?null:e.getAttachment(I.data.index,T)}}return this.unkeyedState+=2,this.queue.drain(),r}},{key:"applyMixingFrom",value:function(e,a,n){var r=e.mixingFrom;null!=r.mixingFrom&&this.applyMixingFrom(r,a,n);var i=0;0==e.mixDuration?(i=1,n==et.first&&(n=et.setup)):((i=e.mixTime/e.mixDuration)>1&&(i=1),n!=et.first&&(n=r.mixBlend));var s=i<r.eventThreshold?this.events:null,o=i<r.attachmentThreshold,l=i<r.drawOrderThreshold,h=r.animationLast,u=r.getAnimationTime(),c=r.animation.timelines.length,d=r.animation.timelines,f=r.alpha*e.interruptAlpha,v=f*(1-i);if(n==et.add)for(var g=0;g<c;g++)d[g].apply(a,h,u,s,v,n,at.mixOut);else{var m=r.timelineMode,p=r.timelineHoldMix,y=0==r.timelinesRotation.length;y&&_.setArraySize(r.timelinesRotation,c<<1,null);var w=r.timelinesRotation;r.totalAlpha=0;for(var k=0;k<c;k++){var E=d[k],x=at.mixOut,b=void 0,M=0;switch(m[k]){case t.SUBSEQUENT:if(!l&&E instanceof Mt)continue;b=n,M=v;break;case t.FIRST:b=et.setup,M=v;break;case t.HOLD_SUBSEQUENT:b=n,M=f;break;case t.HOLD_FIRST:b=et.setup,M=f;break;default:b=et.setup;var S=p[k];M=f*Math.max(0,1-S.mixTime/S.mixDuration)}r.totalAlpha+=M,E instanceof vt?this.applyRotateTimeline(E,a,u,M,b,w,k<<1,y):E instanceof kt?this.applyAttachmentTimeline(E,a,u,b,o):(_.webkit602BugfixHelper(M,n),l&&E instanceof Mt&&b==et.setup&&(x=at.mixIn),E.apply(a,h,u,s,M,b,x))}}return e.mixDuration>0&&this.queueEvents(r,u),this.events.length=0,r.nextAnimationLast=u,r.nextTrackLast=r.trackTime,i}},{key:"applyAttachmentTimeline",value:function(e,a,n,r,i){var s=a.slots[e.slotIndex];if(s.bone.active){var o,l=e.frames;if(n<l[0])r!=et.setup&&r!=et.first||this.setAttachment(a,s,s.data.attachmentName,i);else o=n>=l[l.length-1]?l.length-1:dt.binarySearch(l,n)-1,this.setAttachment(a,s,e.attachmentNames[o],i);s.attachmentState<=this.unkeyedState&&(s.attachmentState=this.unkeyedState+t.SETUP)}}},{key:"setAttachment",value:function(e,a,n,r){a.attachment=null==n?null:e.getAttachment(a.data.index,n),r&&(a.attachmentState=this.unkeyedState+t.CURRENT)}},{key:"applyRotateTimeline",value:function(t,e,a,n,r,i,s,o){if(o&&(i[s]=0),1!=n){var l=t,h=l.frames,u=e.bones[l.boneIndex];if(u.active){var c=0,d=0;if(a<h[0])switch(r){case et.setup:u.rotation=u.data.rotation;default:return;case et.first:c=u.rotation,d=u.data.rotation}else if(c=r==et.setup?u.data.rotation:u.rotation,a>=h[h.length-vt.ENTRIES])d=u.data.rotation+h[h.length+vt.PREV_ROTATION];else{var f=dt.binarySearch(h,a,vt.ENTRIES),v=h[f+vt.PREV_ROTATION],g=h[f],m=l.getCurvePercent((f>>1)-1,1-(a-g)/(h[f+vt.PREV_TIME]-g));d=h[f+vt.ROTATION]-v,d=v+(d-=360*(16384-(16384.499999999996-d/360|0)))*m+u.data.rotation,d-=360*(16384-(16384.499999999996-d/360|0))}var p=0,y=d-c;if(0==(y-=360*(16384-(16384.499999999996-y/360|0))))p=i[s];else{var w=0,k=0;o?(w=0,k=y):(w=i[s],k=i[s+1]);var E=y>0,x=w>=0;P.signum(k)!=P.signum(y)&&Math.abs(k)<=90&&(Math.abs(w)>180&&(w+=360*P.signum(w)),x=E),p=y+w-w%360,x!=E&&(p+=360*P.signum(w)),i[s]=p}i[s+1]=y,c+=p*n,u.rotation=c-360*(16384-(16384.499999999996-c/360|0))}}else t.apply(e,0,a,null,1,r,at.mixIn)}},{key:"queueEvents",value:function(t,e){for(var a=t.animationStart,n=t.animationEnd,r=n-a,i=t.trackLast%r,s=this.events,o=0,l=s.length;o<l;o++){var h=s[o];if(h.time<i)break;h.time>n||this.queue.event(t,h)}for((t.loop?0==r||i>t.trackTime%r:e>=n&&t.animationLast<n)&&this.queue.complete(t);o<l;o++){s[o].time<a||this.queue.event(t,s[o])}}},{key:"clearTracks",value:function(){var t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var e=0,a=this.tracks.length;e<a;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}},{key:"clearTrack",value:function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];if(null!=e){this.queue.end(e),this.disposeNext(e);for(var a=e;;){var n=a.mixingFrom;if(null==n)break;this.queue.end(n),a.mixingFrom=null,a.mixingTo=null,a=n}this.tracks[e.trackIndex]=null,this.queue.drain()}}}},{key:"setCurrent",value:function(t,e,a){var n=this.expandToIndex(t);this.tracks[t]=e,null!=n&&(a&&this.queue.interrupt(n),e.mixingFrom=n,n.mixingTo=e,e.mixTime=0,null!=n.mixingFrom&&n.mixDuration>0&&(e.interruptAlpha*=Math.min(1,n.mixTime/n.mixDuration)),n.timelinesRotation.length=0),this.queue.start(e)}},{key:"setAnimation",value:function(t,e,a){var n=this.data.skeletonData.findAnimation(e);if(null==n)throw new Error("Animation not found: "+e);return this.setAnimationWith(t,n,a)}},{key:"setAnimationWith",value:function(t,e,a){if(null==e)throw new Error("animation cannot be null.");var n=!0,r=this.expandToIndex(t);null!=r&&(-1==r.nextTrackLast?(this.tracks[t]=r.mixingFrom,this.queue.interrupt(r),this.queue.end(r),this.disposeNext(r),r=r.mixingFrom,n=!1):this.disposeNext(r));var i=this.trackEntry(t,e,a,r);return this.setCurrent(t,i,n),this.queue.drain(),i}},{key:"addAnimation",value:function(t,e,a,n){var r=this.data.skeletonData.findAnimation(e);if(null==r)throw new Error("Animation not found: "+e);return this.addAnimationWith(t,r,a,n)}},{key:"addAnimationWith",value:function(t,e,a,n){if(null==e)throw new Error("animation cannot be null.");var r=this.expandToIndex(t);if(null!=r)for(;null!=r.next;)r=r.next;var i=this.trackEntry(t,e,a,r);if(null==r)this.setCurrent(t,i,!0),this.queue.drain();else if(r.next=i,n<=0){var s=r.animationEnd-r.animationStart;0!=s?(r.loop?n+=s*(1+(r.trackTime/s|0)):n+=Math.max(s,r.trackTime),n-=this.data.getMix(r.animation,e)):n=r.trackTime}return i.delay=n,i}},{key:"setEmptyAnimation",value:function(e,a){var n=this.setAnimationWith(e,t.emptyAnimation,!1);return n.mixDuration=a,n.trackEnd=a,n}},{key:"addEmptyAnimation",value:function(e,a,n){n<=0&&(n-=a);var r=this.addAnimationWith(e,t.emptyAnimation,!1,n);return r.mixDuration=a,r.trackEnd=a,r}},{key:"setEmptyAnimations",value:function(t){var e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var a=0,n=this.tracks.length;a<n;a++){var r=this.tracks[a];null!=r&&this.setEmptyAnimation(r.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()}},{key:"expandToIndex",value:function(t){return t<this.tracks.length?this.tracks[t]:(_.ensureArrayCapacity(this.tracks,t+1,null),this.tracks.length=t+1,null)}},{key:"trackEntry",value:function(t,e,a,n){var r=this.trackEntryPool.obtain();return r.trackIndex=t,r.animation=e,r.loop=a,r.holdPrevious=!1,r.eventThreshold=0,r.attachmentThreshold=0,r.drawOrderThreshold=0,r.animationStart=0,r.animationEnd=e.duration,r.animationLast=-1,r.nextAnimationLast=-1,r.delay=0,r.trackTime=0,r.trackLast=-1,r.nextTrackLast=-1,r.trackEnd=Number.MAX_VALUE,r.timeScale=1,r.alpha=1,r.interruptAlpha=1,r.mixTime=0,r.mixDuration=null==n?0:this.data.getMix(n.animation,e),r.mixBlend=et.replace,r}},{key:"disposeNext",value:function(t){for(var e=t.next;null!=e;)this.queue.dispose(e),e=e.next;t.next=null}},{key:"_animationsChanged",value:function(){this.animationsChanged=!1,this.propertyIDs.clear();for(var t=0,e=this.tracks.length;t<e;t++){var a=this.tracks[t];if(null!=a){for(;null!=a.mixingFrom;)a=a.mixingFrom;do{null!=a.mixingFrom&&a.mixBlend==et.add||this.computeHold(a),a=a.mixingTo}while(null!=a)}}}},{key:"computeHold",value:function(e){var a=e.mixingTo,n=e.animation.timelines,r=e.animation.timelines.length,i=_.setArraySize(e.timelineMode,r);e.timelineHoldMix.length=0;var s=_.setArraySize(e.timelineHoldMix,r),o=this.propertyIDs;if(null!=a&&a.holdPrevious)for(var l=0;l<r;l++)i[l]=o.add(n[l].getPropertyId())?t.HOLD_FIRST:t.HOLD_SUBSEQUENT;else t:for(var h=0;h<r;h++){var u=n[h],c=u.getPropertyId();if(o.add(c))if(null==a||u instanceof kt||u instanceof Mt||u instanceof bt||!a.animation.hasTimeline(c))i[h]=t.FIRST;else{for(var d=a.mixingTo;null!=d;d=d.mixingTo)if(!d.animation.hasTimeline(c)){if(e.mixDuration>0){i[h]=t.HOLD_MIX,s[h]=d;continue t}break}i[h]=t.HOLD_FIRST}else i[h]=t.SUBSEQUENT}}},{key:"getCurrent",value:function(t){return t>=this.tracks.length?null:this.tracks[t]}},{key:"addListener",value:function(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)}},{key:"removeListener",value:function(t){var e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}},{key:"clearListeners",value:function(){this.listeners.length=0}},{key:"clearListenerNotifications",value:function(){this.queue.clear()}}]),t}();Ct.emptyAnimation=new dt("<empty>",[],0),Ct.SUBSEQUENT=0,Ct.FIRST=1,Ct.HOLD_SUBSEQUENT=2,Ct.HOLD_FIRST=3,Ct.HOLD_MIX=4,Ct.SETUP=1,Ct.CURRENT=2;var Vt,Pt=function(){function t(){y(this,t),this.animation=void 0,this.next=void 0,this.mixingFrom=void 0,this.mixingTo=void 0,this.listener=void 0,this.trackIndex=void 0,this.loop=void 0,this.holdPrevious=void 0,this.eventThreshold=void 0,this.attachmentThreshold=void 0,this.drawOrderThreshold=void 0,this.animationStart=void 0,this.animationEnd=void 0,this.animationLast=void 0,this.nextAnimationLast=void 0,this.delay=void 0,this.trackTime=void 0,this.trackLast=void 0,this.nextTrackLast=void 0,this.trackEnd=void 0,this.timeScale=void 0,this.alpha=void 0,this.mixTime=void 0,this.mixDuration=void 0,this.interruptAlpha=void 0,this.totalAlpha=void 0,this.mixBlend=et.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}return k(t,[{key:"reset",value:function(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}},{key:"getAnimationTime",value:function(){if(this.loop){var t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}},{key:"setAnimationLast",value:function(t){this.animationLast=t,this.nextAnimationLast=t}},{key:"isComplete",value:function(){return this.trackTime>=this.animationEnd-this.animationStart}},{key:"resetRotationDirections",value:function(){this.timelinesRotation.length=0}}]),t}(),_t=function(){function t(e){y(this,t),this.objects=[],this.drainDisabled=!1,this.animState=void 0,this.animState=e}return k(t,[{key:"start",value:function(t){this.objects.push(Vt.start),this.objects.push(t),this.animState.animationsChanged=!0}},{key:"interrupt",value:function(t){this.objects.push(Vt.interrupt),this.objects.push(t)}},{key:"end",value:function(t){this.objects.push(Vt.end),this.objects.push(t),this.animState.animationsChanged=!0}},{key:"dispose",value:function(t){this.objects.push(Vt.dispose),this.objects.push(t)}},{key:"complete",value:function(t){this.objects.push(Vt.complete),this.objects.push(t)}},{key:"event",value:function(t){function e(e,a){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t,e){this.objects.push(Vt.event),this.objects.push(t),this.objects.push(e)}))},{key:"drain",value:function(){if(!this.drainDisabled){this.drainDisabled=!0;for(var t=this.objects,e=this.animState.listeners,a=0;a<t.length;a+=2){var n=t[a],r=t[a+1];switch(n){case Vt.start:null!=r.listener&&r.listener.start&&r.listener.start(r);for(var i=0;i<e.length;i++)e[i].start&&e[i].start(r);break;case Vt.interrupt:null!=r.listener&&r.listener.interrupt&&r.listener.interrupt(r);for(var s=0;s<e.length;s++)e[s].interrupt&&e[s].interrupt(r);break;case Vt.end:null!=r.listener&&r.listener.end&&r.listener.end(r);for(var o=0;o<e.length;o++)e[o].end&&e[o].end(r);case Vt.dispose:null!=r.listener&&r.listener.dispose&&r.listener.dispose(r);for(var l=0;l<e.length;l++)e[l].dispose&&e[l].dispose(r);this.animState.trackEntryPool.free(r);break;case Vt.complete:null!=r.listener&&r.listener.complete&&r.listener.complete(r);for(var h=0;h<e.length;h++)e[h].complete&&e[h].complete(r);break;case Vt.event:var u=t[2+a++];null!=r.listener&&r.listener.event&&r.listener.event(r,u);for(var c=0;c<e.length;c++)e[c].event&&e[c].event(r,u)}}this.clear(),this.drainDisabled=!1}}},{key:"clear",value:function(){this.objects.length=0}}]),t}();!function(t){t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event"}(Vt||(Vt={}));var Ft,Nt,Ot,Lt,Dt,Xt,Yt=function(){function t(e){if(y(this,t),this.skeletonData=void 0,this.animationToMixTime={},this.defaultMix=0,null==e)throw new Error("skeletonData cannot be null.");this.skeletonData=e}return k(t,[{key:"setMix",value:function(t,e,a){var n=this.skeletonData.findAnimation(t);if(null==n)throw new Error("Animation not found: "+t);var r=this.skeletonData.findAnimation(e);if(null==r)throw new Error("Animation not found: "+e);this.setMixWith(n,r,a)}},{key:"setMixWith",value:function(t,e,a){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");var n=t.name+"."+e.name;this.animationToMixTime[n]=a}},{key:"getMix",value:function(t,e){var a=t.name+"."+e.name,n=this.animationToMixTime[a];return void 0===n?this.defaultMix:n}}]),t}(),Bt=function(t){x(a,G);var e=T(a);function a(t){var n;return y(this,a),(n=e.call(this,t)).endSlot=void 0,n.color=new V(.2275,.2275,.8078,1),n}return k(a,[{key:"copy",value:function(){var t=new a(this.name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t}}]),a}(),Ut=function(){function t(){y(this,t),this.convexPolygons=new Array,this.convexPolygonsIndices=new Array,this.indicesArray=new Array,this.isConcaveArray=new Array,this.triangles=new Array,this.polygonPool=new N((function(){return new Array})),this.polygonIndicesPool=new N((function(){return new Array}))}return k(t,[{key:"triangulate",value:function(e){var a=e,n=e.length>>1,r=this.indicesArray;r.length=0;for(var i=0;i<n;i++)r[i]=i;var s=this.isConcaveArray;s.length=0;for(var o=0,l=n;o<l;++o)s[o]=t.isConcave(o,n,a,r);var h=this.triangles;for(h.length=0;n>3;){for(var u=n-1,c=0,d=1;;){t:if(!s[c]){for(var f=r[u]<<1,v=r[c]<<1,g=r[d]<<1,m=a[f],p=a[f+1],y=a[v],w=a[v+1],k=a[g],E=a[g+1],x=(d+1)%n;x!=u;x=(x+1)%n)if(s[x]){var b=r[x]<<1,M=a[b],S=a[b+1];if(t.positiveArea(k,E,m,p,M,S)&&t.positiveArea(m,p,y,w,M,S)&&t.positiveArea(y,w,k,E,M,S))break t}break}if(0==d){do{if(!s[c])break;c--}while(c>0);break}u=c,c=d,d=(d+1)%n}h.push(r[(n+c-1)%n]),h.push(r[c]),h.push(r[(c+1)%n]),r.splice(c,1),s.splice(c,1);var I=(--n+c-1)%n,T=c==n?0:c;s[I]=t.isConcave(I,n,a,r),s[T]=t.isConcave(T,n,a,r)}return 3==n&&(h.push(r[2]),h.push(r[0]),h.push(r[1])),h}},{key:"decompose",value:function(e,a){var n=e,r=this.convexPolygons;this.polygonPool.freeAll(r),r.length=0;var i=this.convexPolygonsIndices;this.polygonIndicesPool.freeAll(i),i.length=0;var s=this.polygonIndicesPool.obtain();s.length=0;var o=this.polygonPool.obtain();o.length=0;for(var l=-1,h=0,u=0,c=a.length;u<c;u+=3){var d=a[u]<<1,f=a[u+1]<<1,v=a[u+2]<<1,g=n[d],m=n[d+1],p=n[f],y=n[f+1],w=n[v],k=n[v+1],E=!1;if(l==d){var x=o.length-4,b=t.winding(o[x],o[x+1],o[x+2],o[x+3],w,k),M=t.winding(w,k,o[0],o[1],o[2],o[3]);b==h&&M==h&&(o.push(w),o.push(k),s.push(v),E=!0)}E||(o.length>0?(r.push(o),i.push(s)):(this.polygonPool.free(o),this.polygonIndicesPool.free(s)),(o=this.polygonPool.obtain()).length=0,o.push(g),o.push(m),o.push(p),o.push(y),o.push(w),o.push(k),(s=this.polygonIndicesPool.obtain()).length=0,s.push(d),s.push(f),s.push(v),h=t.winding(g,m,p,y,w,k),l=d)}o.length>0&&(r.push(o),i.push(s));for(var S=0,I=r.length;S<I;S++)if(0!=(s=i[S]).length)for(var T=s[0],R=s[s.length-1],A=(o=r[S]).length-4,C=o[A],V=o[A+1],P=o[A+2],_=o[A+3],F=o[0],N=o[1],O=o[2],L=o[3],D=t.winding(C,V,P,_,F,N),X=0;X<I;X++)if(X!=S){var Y=i[X];if(3==Y.length){var B=Y[0],U=Y[1],W=Y[2],q=r[X],H=q[q.length-2],j=q[q.length-1];if(B==T&&U==R){var z=t.winding(C,V,P,_,H,j),G=t.winding(H,j,F,N,O,L);z==D&&G==D&&(q.length=0,Y.length=0,o.push(H),o.push(j),s.push(W),C=P,V=_,P=H,_=j,X=0)}}}for(var Z=r.length-1;Z>=0;Z--)0==(o=r[Z]).length&&(r.splice(Z,1),this.polygonPool.free(o),s=i[Z],i.splice(Z,1),this.polygonIndicesPool.free(s));return r}}],[{key:"isConcave",value:function(t,e,a,n){var r=n[(e+t-1)%e]<<1,i=n[t]<<1,s=n[(t+1)%e]<<1;return!this.positiveArea(a[r],a[r+1],a[i],a[i+1],a[s],a[s+1])}},{key:"positiveArea",value:function(t,e,a,n,r,i){return t*(i-n)+a*(e-i)+r*(n-e)>=0}},{key:"winding",value:function(t,e,a,n,r,i){var s=a-t,o=n-e;return r*o-i*s+s*e-t*o>=0?1:-1}}]),t}(),Wt=function(){function t(){y(this,t),this.triangulator=new Ut,this.clippingPolygon=new Array,this.clipOutput=new Array,this.clippedVertices=new Array,this.clippedTriangles=new Array,this.scratch=new Array,this.clipAttachment=void 0,this.clippingPolygons=void 0}return k(t,[{key:"clipStart",value:function(e,a){if(null!=this.clipAttachment)return 0;this.clipAttachment=a;var n=a.worldVerticesLength,r=_.setArraySize(this.clippingPolygon,n);a.computeWorldVertices(e,0,n,r,0,2);var i=this.clippingPolygon;t.makeClockwise(i);for(var s=this.clippingPolygons=this.triangulator.decompose(i,this.triangulator.triangulate(i)),o=0,l=s.length;o<l;o++){var h=s[o];t.makeClockwise(h),h.push(h[0]),h.push(h[1])}return s.length}},{key:"clipEndWithSlot",value:function(t){null!=this.clipAttachment&&this.clipAttachment.endSlot==t.data&&this.clipEnd()}},{key:"clipEnd",value:function(){null!=this.clipAttachment&&(this.clipAttachment=null,this.clippingPolygons=null,this.clippedVertices.length=0,this.clippedTriangles.length=0,this.clippingPolygon.length=0)}},{key:"isClipping",value:function(){return null!=this.clipAttachment}},{key:"clipTriangles",value:function(t,e,a,n,r,i,s,o){var l=this.clipOutput,h=this.clippedVertices,u=this.clippedTriangles,c=this.clippingPolygons,d=this.clippingPolygons.length,f=o?12:8,v=0;h.length=0,u.length=0;t:for(var g=0;g<n;g+=3)for(var m=a[g]<<1,p=t[m],y=t[m+1],w=r[m],k=r[m+1],E=t[m=a[g+1]<<1],x=t[m+1],b=r[m],M=r[m+1],S=t[m=a[g+2]<<1],I=t[m+1],T=r[m],R=r[m+1],A=0;A<d;A++){var C=h.length;if(!this.clip(p,y,E,x,S,I,c[A],l)){var V=_.setArraySize(h,C+3*f);V[C]=p,V[C+1]=y,V[C+2]=i.r,V[C+3]=i.g,V[C+4]=i.b,V[C+5]=i.a,o?(V[C+6]=w,V[C+7]=k,V[C+8]=s.r,V[C+9]=s.g,V[C+10]=s.b,V[C+11]=s.a,V[C+12]=E,V[C+13]=x,V[C+14]=i.r,V[C+15]=i.g,V[C+16]=i.b,V[C+17]=i.a,V[C+18]=b,V[C+19]=M,V[C+20]=s.r,V[C+21]=s.g,V[C+22]=s.b,V[C+23]=s.a,V[C+24]=S,V[C+25]=I,V[C+26]=i.r,V[C+27]=i.g,V[C+28]=i.b,V[C+29]=i.a,V[C+30]=T,V[C+31]=R,V[C+32]=s.r,V[C+33]=s.g,V[C+34]=s.b,V[C+35]=s.a):(V[C+6]=w,V[C+7]=k,V[C+8]=E,V[C+9]=x,V[C+10]=i.r,V[C+11]=i.g,V[C+12]=i.b,V[C+13]=i.a,V[C+14]=b,V[C+15]=M,V[C+16]=S,V[C+17]=I,V[C+18]=i.r,V[C+19]=i.g,V[C+20]=i.b,V[C+21]=i.a,V[C+22]=T,V[C+23]=R),C=u.length;var P=_.setArraySize(u,C+3);P[C]=v,P[C+1]=v+1,P[C+2]=v+2,v+=3;continue t}var F=l.length;if(0!=F){for(var N=x-I,O=S-E,L=p-S,D=I-y,X=1/(N*L+O*(y-I)),Y=F>>1,B=this.clipOutput,U=_.setArraySize(h,C+Y*f),W=0;W<F;W+=2){var q=B[W],H=B[W+1];U[C]=q,U[C+1]=H,U[C+2]=i.r,U[C+3]=i.g,U[C+4]=i.b,U[C+5]=i.a;var j=q-S,z=H-I,G=(N*j+O*z)*X,Z=(D*j+L*z)*X,Q=1-G-Z;U[C+6]=w*G+b*Z+T*Q,U[C+7]=k*G+M*Z+R*Q,o&&(U[C+8]=s.r,U[C+9]=s.g,U[C+10]=s.b,U[C+11]=s.a),C+=f}C=u.length;var K=_.setArraySize(u,C+3*(Y-2));Y--;for(var J=1;J<Y;J++)K[C]=v,K[C+1]=v+J,K[C+2]=v+J+1,C+=3;v+=Y+1}}}},{key:"clip",value:function(t,e,a,n,r,i,s,o){var l=o,h=!1,u=null;s.length%4>=2?(u=o,o=this.scratch):u=this.scratch,u.length=0,u.push(t),u.push(e),u.push(a),u.push(n),u.push(r),u.push(i),u.push(t),u.push(e),o.length=0;for(var c=s,d=s.length-4,f=0;;f+=2){for(var v=c[f],g=c[f+1],m=c[f+2],p=c[f+3],y=v-m,w=g-p,k=u,E=u.length-2,x=o.length,b=0;b<E;b+=2){var M=k[b],S=k[b+1],I=k[b+2],T=k[b+3],R=y*(T-p)-w*(I-m)>0;if(y*(S-p)-w*(M-m)>0){if(R){o.push(I),o.push(T);continue}var A=T-S,C=I-M,V=A*(m-v)-C*(p-g);if(Math.abs(V)>1e-6){var P=(C*(g-S)-A*(v-M))/V;o.push(v+(m-v)*P),o.push(g+(p-g)*P)}else o.push(v),o.push(g)}else if(R){var _=T-S,F=I-M,N=_*(m-v)-F*(p-g);if(Math.abs(N)>1e-6){var O=(F*(g-S)-_*(v-M))/N;o.push(v+(m-v)*O),o.push(g+(p-g)*O)}else o.push(v),o.push(g);o.push(I),o.push(T)}h=!0}if(x==o.length)return l.length=0,!0;if(o.push(o[0]),o.push(o[1]),f==d)break;var L=o;(o=u).length=0,u=L}if(l!=o){l.length=0;for(var D=0,X=o.length-2;D<X;D++)l[D]=o[D]}else l.length=l.length-2;return h}}],[{key:"makeClockwise",value:function(t){for(var e=t,a=t.length,n=e[a-2]*e[1]-e[0]*e[a-1],r=0,i=0,s=0,o=0,l=a-3;o<l;o+=2)r=e[o],i=e[o+1],s=e[o+2],n+=r*e[o+3]-s*i;if(!(n<0))for(var h=0,u=a-2,c=a>>1;h<c;h+=2){var d=e[h],f=e[h+1],v=u-h;e[h]=e[v],e[h+1]=e[v+1],e[v]=d,e[v+1]=f}}}]),t}(),qt=function(){function o(){y(this,o),this._mesh=void 0,this._indexBuffer=void 0,this._vertexBuffer=void 0}return k(o,[{key:"mesh",get:function(){return this._mesh}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"vertexBuffer",get:function(){return this._vertexBuffer}},{key:"initialize",value:function(o,l){var h=this._mesh=new t(o),u=[new e("POSITION",0,a.Vector3,0),new e("COLOR_0",12,a.Vector4,0),new e("TEXCOORD_0",28,a.Vector2,0)],c=4*Ht.VERTEX_STRIDE,d=c*l,f=new n(o,r.VertexBuffer,d,i.Dynamic),v=new n(o,r.IndexBuffer,2*l,i.Dynamic);this._indexBuffer=v,this._vertexBuffer=f,h.setVertexBufferBinding(f,c),h.setIndexBufferBinding(v,s.UInt16),h.setVertexElements(u),h.addSubMesh(0,l)}},{key:"changeBuffer",value:function(t,e){var a=4*Ht.VERTEX_STRIDE,o=a*e,l=new n(t,r.VertexBuffer,o,i.Dynamic),h=new n(t,r.IndexBuffer,2*e,i.Dynamic),u=this._mesh;this._indexBuffer=h,this._vertexBuffer=l,u.setVertexBufferBinding(l,a),u.setIndexBufferBinding(h,s.UInt16)}}]),o}(),Ht=function(){function t(e,a){y(this,t),this._setting=void 0,this._engine=void 0,this._entity=void 0,this._clipper=new Wt,this._spineMesh=new qt,this._vertexCount=void 0,this._vertices=void 0,this._verticesWithZ=void 0,this._indices=void 0,this._needResize=!1,this._meshRenderer=void 0,this._subMeshItems=[],this.separateSlots=[],this._engine=e,this._entity=a}return k(t,[{key:"mesh",get:function(){return this._spineMesh.mesh}},{key:"subMeshItems",get:function(){return this._subMeshItems}},{key:"initialize",value:function(e,a){if(e){var n=this._entity.getComponent(o);if(n){this._meshRenderer=n,a&&(this._setting=a);for(var r=e.defaultSkin.attachments,i=0,s=t.QUAD_TRIANGLES.length,l=0,h=r.length;l<h;l++){var u=r[l];for(var c in u){var d=u[c];if(d)if(d instanceof K)i+=s;else{if(!(d instanceof ut))continue;i+=d.triangles.length}}}this._vertexCount=i,this._prepareBufferData(this._vertexCount);var f=this._spineMesh;f.initialize(this._engine,this._vertexCount),n.mesh=f.mesh}else console.warn("You need add MeshRenderer component to entity first")}}},{key:"buildMesh",value:function(e){var a=this._setting||{},n=a.useClipping,r=void 0===n||n,i=a.zSpacing,s=void 0===i?.01:i,o=0,h=0;this._subMeshItems.length=0;for(var u,c,d=this._meshRenderer,f=e.drawOrder,v=f.length,g=this._clipper,m=this._spineMesh,p=m.mesh,y=this._subMeshItems,w=this._vertices,k=0,E=0,x=0;x<v;x+=1){var b=f[x];if(b.bone.active){var M=b.getAttachment(),S=null,I=null,T=s*x,R=0,A=g.isClipping()?2:t.VERTEX_SIZE;if(M instanceof K){var C=M;S=C.color,w=this._vertices,R=4*A,C.computeWorldVertices(b.bone,w,0,A),u=t.QUAD_TRIANGLES,c=C.uvs,I=C.region.renderObject.texture}else if(M instanceof ut){var V=M;S=V.color,w=this._vertices,(R=(V.worldVerticesLength>>1)*A)>w.length&&(w=this._vertices=new Float32Array(R)),V.computeWorldVertices(b,0,V.worldVerticesLength,w,0,A),u=V.triangles,c=V.uvs,I=V.region.renderObject.texture}else if(M instanceof Bt){if(r){var P=M;g.clipStart(b,P);continue}}else if(r){g.clipEndWithSlot(b);continue}if(null!=I){var _=void 0,F=void 0,N=void 0,O=void 0,L=b.bone.skeleton.color,D=b.color,X=L.a*D.a*S.a,Y=t.tempColor;if(Y.set(L.r*D.r*S.r,L.g*D.g*S.g,L.b*D.b*S.b,X),g.isClipping()){g.clipTriangles(w,R,u,u.length,c,Y,null,!1);var B=g.clippedVertices,U=g.clippedTriangles;_=B,F=B.length,N=U,O=U.length}else{for(var W=w,q=2,H=0,j=R;q<j;q+=A,H+=2)W[q]=Y.r,W[q+1]=Y.g,W[q+2]=Y.b,W[q+3]=Y.a,W[q+4]=c[H],W[q+5]=c[H+1];_=w,F=R,N=u,O=u.length}for(var z=o/t.VERTEX_STRIDE,G=this._verticesWithZ,Z=o,Q=0;Q<F;)G[Z++]=_[Q++],G[Z++]=_[Q++],G[Z++]=T,G[Z++]=_[Q++],G[Z++]=_[Q++],G[Z++]=_[Q++],G[Z++]=_[Q++],G[Z++]=_[Q++],G[Z++]=_[Q++];o=Z;var J=this._indices;for(Z=h,Q=0;Q<O;Z++,Q++)J[Z]=N[Q]+z;var $=b.data.name;if(this.separateSlots.includes($)){var tt=new l(h,O);if(y.push({name:$,subMesh:tt}),E>0){var et=new l(k,E);y.push({name:"default",subMesh:et}),E=0}k=h+O}else E+=O;h+=O;for(var at=d.getMaterials(),nt=at.length,rt=0;rt<nt;rt+=1){var it=at[rt];it.shaderData.getTexture("u_cusTomTexture")||it.shaderData.setTexture("u_cusTomTexture",I.texture)}}g.clipEndWithSlot(b)}else g.clipEndWithSlot(b)}if(g.clipEnd(),E>0){var st=new l(k,E);y.push({name:"default",subMesh:st}),E=0}if(y.sort((function(t,e){return t.subMesh.start-e.subMesh.start})),h>0&&h!==this._vertexCount&&h>this._vertexCount)return this._vertexCount=h,this._prepareBufferData(this._vertexCount),void(this._needResize=!0);p.clearSubMesh();for(var ot=y.length,lt=0;lt<ot;lt+=1)p.addSubMesh(y[lt].subMesh);this._needResize&&(m.vertexBuffer.resize(this._verticesWithZ.byteLength),m.indexBuffer.resize(this._indices.byteLength),this._needResize=!1),m.vertexBuffer.setData(this._verticesWithZ),m.indexBuffer.setData(this._indices)}},{key:"addSeparateSlot",value:function(t){this.separateSlots.push(t)}},{key:"_prepareBufferData",value:function(e){this._vertices=new Float32Array(e*t.VERTEX_SIZE),this._verticesWithZ=new Float32Array(e*t.VERTEX_STRIDE),this._indices=new Uint16Array(e)}}]),t}();Ht.QUAD_TRIANGLES=[0,1,2,2,3,0],Ht.VERTEX_SIZE=8,Ht.VERTEX_STRIDE=9,Ht.tempColor=new V;var jt,zt=(Nt=A((Ft=function(t){x(a,h);var e=T(a);function a(t){var n;return y(this,a),R(n=e.call(this,t),"_skeletonData",Nt,S(n)),R(n,"_skeleton",Ot,S(n)),R(n,"_state",Lt,S(n)),R(n,"_meshGenerator",Dt,S(n)),R(n,"setting",Xt,S(n)),n.autoUpdate=!0,n._meshGenerator=new Ht(n.engine,t),n}return k(a,[{key:"skeletonData",get:function(){return this._skeletonData}},{key:"skeleton",get:function(){return this._skeleton}},{key:"state",get:function(){return this._state}},{key:"mesh",get:function(){return this._meshGenerator.mesh}},{key:"scale",set:function(t){this._skeleton&&(this._skeleton.scaleX=t,this._skeleton.scaleY=t)}},{key:"setSkeletonData",value:function(t,e){t||console.error("SkeletonData is undefined"),this.setting=e,this._skeletonData=t,this._skeleton=new ct(t);var a=new Yt(t);this._state=new Ct(a),this._meshGenerator.initialize(t,this.setting)}},{key:"addSeparateSlot",value:function(t){this.skeleton||console.error("Skeleton not found!");var e=this.entity.getComponent(o);if(e||console.warn("You need add MeshRenderer component to entity first"),this.skeleton.findSlot(t)){this._meshGenerator.addSeparateSlot(t);var a=this.engine._spriteDefaultMaterial.clone(),n=this.engine._spriteDefaultMaterial.clone(),r=e.materialCount;e.setMaterial(r,a),e.setMaterial(r+1,n)}else console.warn("Slot: ".concat(t," not find."))}},{key:"hackSeparateSlotTexture",value:function(t,e){this._meshGenerator.buildMesh(this._skeleton);var a=this._meshGenerator,n=a.separateSlots,r=a.subMeshItems;if(0!==n.length)if(n.includes(t)){var i=this.entity.getComponent(o),s=r.findIndex((function(e){return e.name===t}));i.getMaterial(s).shaderData.setTexture("u_cusTomTexture",e)}else console.warn("Slot ".concat(t," is not separated. You should use addSeparateSlot to separate it"));else console.warn("You need add separate slot")}},{key:"disposeCurrentSkeleton",value:function(){this._skeletonData=null}},{key:"onUpdate",value:function(t){this.autoUpdate&&this.updateState(.001*t)}},{key:"updateState",value:function(t){if(this._skeleton&&this.state){var e=this._state,a=this._skeleton;e.update(t),e.apply(a),a.updateWorldTransform(),this.updateGeometry()}}},{key:"updateGeometry",value:function(){this._skeleton&&this._meshGenerator.buildMesh(this._skeleton)}},{key:"_cloneTo",value:function(t){t.setSkeletonData(this.skeletonData);var e=function(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?p(Object(a),!0).forEach((function(e){E(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}({},this.setting);t.setting=e}}]),a}()).prototype,"_skeletonData",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ot=A(Ft.prototype,"_skeleton",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lt=A(Ft.prototype,"_state",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dt=A(Ft.prototype,"_meshGenerator",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xt=A(Ft.prototype,"setting",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ft),Gt=function(){function t(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";y(this,t),this.pathPrefix=void 0,this.textureLoader=void 0,this.assets={},this.errors={},this.toLoad=0,this.loaded=0,this.rawDataUris={},this.textureLoader=e,this.pathPrefix=a}return k(t,[{key:"downloadText",value:function(t,e,a){var n=new XMLHttpRequest;n.overrideMimeType("text/html"),this.rawDataUris[t]&&(t=this.rawDataUris[t]),n.open("GET",t,!0),n.onload=function(){200==n.status?e(n.responseText):a(n.status,n.responseText)},n.onerror=function(){a(n.status,n.responseText)},n.send()}},{key:"downloadBinary",value:function(t,e,a){var n=new XMLHttpRequest;this.rawDataUris[t]&&(t=this.rawDataUris[t]),n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status?e(new Uint8Array(n.response)):a(n.status,n.responseText)},n.onerror=function(){a(n.status,n.responseText)},n.send()}},{key:"setRawDataURI",value:function(t,e){this.rawDataUris[this.pathPrefix+t]=e}},{key:"loadBinary",value:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t=this.pathPrefix+t,this.toLoad++,this.downloadBinary(t,(function(n){e.assets[t]=n,a&&a(t,n),e.toLoad--,e.loaded++}),(function(a,r){e.errors[t]="Couldn't load binary ".concat(t,": status ").concat(status,", ").concat(r),n&&n(t,"Couldn't load binary ".concat(t,": status ").concat(status,", ").concat(r)),e.toLoad--,e.loaded++}))}},{key:"loadText",value:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t=this.pathPrefix+t,this.toLoad++,this.downloadText(t,(function(n){e.assets[t]=n,a&&a(t,n),e.toLoad--,e.loaded++}),(function(a,r){e.errors[t]="Couldn't load text ".concat(t,": status ").concat(status,", ").concat(r),n&&n(t,"Couldn't load text ".concat(t,": status ").concat(status,", ").concat(r)),e.toLoad--,e.loaded++}))}},{key:"loadTexture",value:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=t=this.pathPrefix+t;this.toLoad++;var i=new Image;i.crossOrigin="anonymous",i.onload=function(n){var s=e.textureLoader(i);e.assets[r]=s,e.toLoad--,e.loaded++,a&&a(t,i)},i.onerror=function(a){e.errors[t]="Couldn't load image ".concat(t),e.toLoad--,e.loaded++,n&&n(t,"Couldn't load image ".concat(t))},this.rawDataUris[t]&&(t=this.rawDataUris[t]),i.src=t}},{key:"loadTextureAtlas",value:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=t.lastIndexOf("/")>=0?t.substring(0,t.lastIndexOf("/")):"";t=this.pathPrefix+t,this.toLoad++,this.downloadText(t,(function(i){var s={count:0},o=new Array;try{new st(i,(function(t){o.push(""==r?t:r+"/"+t);var e=document.createElement("img");return e.width=16,e.height=16,new it(e)}))}catch(a){var l=a;return e.errors[t]="Couldn't load texture atlas ".concat(t,": ").concat(l.message),n&&n(t,"Couldn't load texture atlas ".concat(t,": ").concat(l.message)),e.toLoad--,void e.loaded++}for(var h=function(){var l=c[u],h=!1;e.loadTexture(l,(function(l,u){if(s.count++,s.count==o.length)if(h)e.errors[t]="Couldn't load texture atlas page ".concat(l,"} of atlas ").concat(t),n&&n(t,"Couldn't load texture atlas page ".concat(l," of atlas ").concat(t)),e.toLoad--,e.loaded++;else try{var c=new st(i,(function(t){return e.get(""==r?t:r+"/"+t)}));e.assets[t]=c,a&&a(t,c),e.toLoad--,e.loaded++}catch(a){var d=a;e.errors[t]="Couldn't load texture atlas ".concat(t,": ").concat(d.message),n&&n(t,"Couldn't load texture atlas ".concat(t,": ").concat(d.message)),e.toLoad--,e.loaded++}}),(function(a,r){h=!0,s.count++,s.count==o.length&&(e.errors[t]="Couldn't load texture atlas page ".concat(a,"} of atlas ").concat(t),n&&n(t,"Couldn't load texture atlas page ".concat(a," of atlas ").concat(t)),e.toLoad--,e.loaded++)}))},u=0,c=o;u<c.length;u++)h()}),(function(a,r){e.errors[t]="Couldn't load texture atlas ".concat(t,": status ").concat(status,", ").concat(r),n&&n(t,"Couldn't load texture atlas ".concat(t,": status ").concat(status,", ").concat(r)),e.toLoad--,e.loaded++}))}},{key:"get",value:function(t){return t=this.pathPrefix+t,this.assets[t]}},{key:"remove",value:function(t){t=this.pathPrefix+t;var e=this.assets[t];e.dispose&&e.dispose(),this.assets[t]=null}},{key:"removeAll",value:function(){for(var t in this.assets){var e=this.assets[t];e.dispose&&e.dispose()}this.assets={}}},{key:"isLoadingComplete",value:function(){return 0==this.toLoad}},{key:"getToLoad",value:function(){return this.toLoad}},{key:"getLoaded",value:function(){return this.loaded}},{key:"dispose",value:function(){this.removeAll()}},{key:"hasErrors",value:function(){return Object.keys(this.errors).length>0}},{key:"getErrors",value:function(){return this.errors}}]),t}(),Zt=function(t){x(a,G);var e=T(a);function a(t){var n;return y(this,a),(n=e.call(this,t)).color=new V(1,1,1,1),n}return k(a,[{key:"copy",value:function(){var t=new a(this.name);return this.copyTo(t),t.color.setFromColor(this.color),t}}]),a}(),Qt=function(t){x(a,G);var e=T(a);function a(t){var n;return y(this,a),(n=e.call(this,t)).x=void 0,n.y=void 0,n.rotation=void 0,n.color=new V(.38,.94,0,1),n.name=t,n}return k(a,[{key:"computeWorldPosition",value:function(t,e){return e.x=this.x*t.a+this.y*t.b+t.worldX,e.y=this.x*t.c+this.y*t.d+t.worldY,e}},{key:"computeWorldRotation",value:function(t){var e=P.cosDeg(this.rotation),a=P.sinDeg(this.rotation),n=e*t.a+a*t.b,r=e*t.c+a*t.d;return Math.atan2(r,n)*P.radDeg}},{key:"copy",value:function(){var t=new a(this.name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t}}]),a}(),Kt=function(){function t(e){y(this,t),this.atlas=void 0,this.atlas=e}return k(t,[{key:"newRegionAttachment",value:function(t,e,a){var n=this.atlas.findRegion(a);if(null==n)throw new Error("Region not found in atlas: "+a+" (region attachment: "+e+")");n.renderObject=n;var r=new K(e);return r.setRegion(n),r}},{key:"newMeshAttachment",value:function(t,e,a){var n=this.atlas.findRegion(a);if(null==n)throw new Error("Region not found in atlas: "+a+" (mesh attachment: "+e+")");n.renderObject=n;var r=new ut(e);return r.region=n,r}},{key:"newBoundingBoxAttachment",value:function(t,e){return new Zt(e)}},{key:"newPathAttachment",value:function(t,e){return new Z(e)}},{key:"newPointAttachment",value:function(t,e){return new Qt(e)}},{key:"newClippingAttachment",value:function(t,e){return new Bt(e)}}]),t}(),Jt=function(){function t(){y(this,t),this.name=void 0,this.bones=new Array,this.slots=new Array,this.skins=new Array,this.defaultSkin=void 0,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.x=void 0,this.y=void 0,this.width=void 0,this.height=void 0,this.version=void 0,this.hash=void 0,this.fps=0,this.imagesPath=void 0,this.audioPath=void 0}return k(t,[{key:"findBone",value:function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,a=0,n=e.length;a<n;a++){var r=e[a];if(r.name==t)return r}return null}},{key:"findBoneIndex",value:function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,a=0,n=e.length;a<n;a++)if(e[a].name==t)return a;return-1}},{key:"findSlot",value:function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,a=0,n=e.length;a<n;a++){var r=e[a];if(r.name==t)return r}return null}},{key:"findSlotIndex",value:function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,a=0,n=e.length;a<n;a++)if(e[a].name==t)return a;return-1}},{key:"findSkin",value:function(t){if(null==t)throw new Error("skinName cannot be null.");for(var e=this.skins,a=0,n=e.length;a<n;a++){var r=e[a];if(r.name==t)return r}return null}},{key:"findEvent",value:function(t){if(null==t)throw new Error("eventDataName cannot be null.");for(var e=this.events,a=0,n=e.length;a<n;a++){var r=e[a];if(r.name==t)return r}return null}},{key:"findAnimation",value:function(t){if(null==t)throw new Error("animationName cannot be null.");for(var e=this.animations,a=0,n=e.length;a<n;a++){var r=e[a];if(r.name==t)return r}return null}},{key:"findIkConstraint",value:function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,a=0,n=e.length;a<n;a++){var r=e[a];if(r.name==t)return r}return null}},{key:"findTransformConstraint",value:function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,a=0,n=e.length;a<n;a++){var r=e[a];if(r.name==t)return r}return null}},{key:"findPathConstraint",value:function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,a=0,n=e.length;a<n;a++){var r=e[a];if(r.name==t)return r}return null}},{key:"findPathConstraintIndex",value:function(t){if(null==t)throw new Error("pathConstraintName cannot be null.");for(var e=this.pathConstraints,a=0,n=e.length;a<n;a++)if(e[a].name==t)return a;return-1}}]),t}(),$t=function t(e,a,n){if(y(this,t),this.index=void 0,this.name=void 0,this.boneData=void 0,this.color=new V(1,1,1,1),this.darkColor=void 0,this.attachmentName=void 0,this.blendMode=void 0,e<0)throw new Error("index must be >= 0.");if(null==a)throw new Error("name cannot be null.");if(null==n)throw new Error("boneData cannot be null.");this.index=e,this.name=a,this.boneData=n},te=function(t){x(a,H);var e=T(a);function a(t){var n;return y(this,a),(n=e.call(this,t,0,!1)).bones=new Array,n.target=void 0,n.bendDirection=1,n.compress=!1,n.stretch=!1,n.uniform=!1,n.mix=1,n.softness=0,n}return a}(),ee=function(t){x(a,H);var e=T(a);function a(t){var n;return y(this,a),(n=e.call(this,t,0,!1)).bones=new Array,n.target=void 0,n.rotateMix=0,n.translateMix=0,n.scaleMix=0,n.shearMix=0,n.offsetRotation=0,n.offsetX=0,n.offsetY=0,n.offsetScaleX=0,n.offsetScaleY=0,n.offsetShearY=0,n.relative=!1,n.local=!1,n}return a}(),ae=function t(e,a,n){y(this,t),this.slotIndex=e,this.name=a,this.attachment=n},ne=function(){function t(e){if(y(this,t),this.name=void 0,this.attachments=new Array,this.bones=Array(),this.constraints=new Array,null==e)throw new Error("name cannot be null.");this.name=e}return k(t,[{key:"setAttachment",value:function(t,e,a){if(null==a)throw new Error("attachment cannot be null.");var n=this.attachments;t>=n.length&&(n.length=t+1),n[t]||(n[t]={}),n[t][e]=a}},{key:"addSkin",value:function(t){for(var e=0;e<t.bones.length;e++){for(var a=t.bones[e],n=!1,r=0;r<this.bones.length;r++)if(this.bones[r]==a){n=!0;break}n||this.bones.push(a)}for(var i=0;i<t.constraints.length;i++){for(var s=t.constraints[i],o=!1,l=0;l<this.constraints.length;l++)if(this.constraints[l]==s){o=!0;break}o||this.constraints.push(s)}for(var h=t.getAttachments(),u=0;u<h.length;u++){var c=h[u];this.setAttachment(c.slotIndex,c.name,c.attachment)}}},{key:"copySkin",value:function(t){for(var e=0;e<t.bones.length;e++){for(var a=t.bones[e],n=!1,r=0;r<this.bones.length;r++)if(this.bones[r]==a){n=!0;break}n||this.bones.push(a)}for(var i=0;i<t.constraints.length;i++){for(var s=t.constraints[i],o=!1,l=0;l<this.constraints.length;l++)if(this.constraints[l]==s){o=!0;break}o||this.constraints.push(s)}for(var h=t.getAttachments(),u=0;u<h.length;u++){var c=h[u];null!=c.attachment&&(c.attachment instanceof ut?(c.attachment=c.attachment.newLinkedMesh(),this.setAttachment(c.slotIndex,c.name,c.attachment)):(c.attachment=c.attachment.copy(),this.setAttachment(c.slotIndex,c.name,c.attachment)))}}},{key:"getAttachment",value:function(t,e){var a=this.attachments[t];return a?a[e]:null}},{key:"removeAttachment",value:function(t,e){var a=this.attachments[t];a&&(a[e]=null)}},{key:"getAttachments",value:function(){for(var t=new Array,e=0;e<this.attachments.length;e++){var a=this.attachments[e];if(a)for(var n in a){var r=a[n];r&&t.push(new ae(e,n,r))}}return t}},{key:"getAttachmentsForSlot",value:function(t,e){var a=this.attachments[t];if(a)for(var n in a){var r=a[n];r&&e.push(new ae(t,n,r))}}},{key:"clear",value:function(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0}},{key:"attachAll",value:function(t,e){for(var a=0,n=0;n<t.slots.length;n++){var r=t.slots[n],i=r.getAttachment();if(i&&a<e.attachments.length){var s=e.attachments[a];for(var o in s){if(i==s[o]){var l=this.getAttachment(a,o);null!=l&&r.setAttachment(l);break}}}a++}}}]),t}(),re=function t(e){y(this,t),this.name=void 0,this.intValue=void 0,this.floatValue=void 0,this.stringValue=void 0,this.audioPath=void 0,this.volume=void 0,this.balance=void 0,this.name=e};!function(t){t[t.Normal=0]="Normal",t[t.Additive=1]="Additive",t[t.Multiply=2]="Multiply",t[t.Screen=3]="Screen"}(jt||(jt={}));var ie,se=function t(e,a){if(y(this,t),this.data=void 0,this.intValue=void 0,this.floatValue=void 0,this.stringValue=void 0,this.time=void 0,this.volume=void 0,this.balance=void 0,null==a)throw new Error("data cannot be null.");this.time=e,this.data=a},oe=function(){function t(e){y(this,t),this.attachmentLoader=void 0,this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=e}return k(t,[{key:"readSkeletonData",value:function(e){var a=this.scale,n=new Jt,r="string"==typeof e?JSON.parse(e):e,i=r.skeleton;if(null!=i){if(n.hash=i.hash,n.version=i.spine,"3.8.75"==n.version)throw new Error("Unsupported skeleton data, please export with a newer version of Spine.");n.x=i.x,n.y=i.y,n.width=i.width,n.height=i.height,n.fps=i.fps,n.imagesPath=i.images}if(r.bones)for(var s=0;s<r.bones.length;s++){var o=r.bones[s],l=null,h=this.getValue(o,"parent",null);if(null!=h&&null==(l=n.findBone(h)))throw new Error("Parent bone not found: "+h);var u=new L(n.bones.length,o.name,l);u.length=this.getValue(o,"length",0)*a,u.x=this.getValue(o,"x",0)*a,u.y=this.getValue(o,"y",0)*a,u.rotation=this.getValue(o,"rotation",0),u.scaleX=this.getValue(o,"scaleX",1),u.scaleY=this.getValue(o,"scaleY",1),u.shearX=this.getValue(o,"shearX",0),u.shearY=this.getValue(o,"shearY",0),u.transformMode=t.transformModeFromString(this.getValue(o,"transform","normal")),u.skinRequired=this.getValue(o,"skin",!1),n.bones.push(u)}if(r.slots)for(var c=0;c<r.slots.length;c++){var d=r.slots[c],f=d.name,v=d.bone,g=n.findBone(v);if(null==g)throw new Error("Slot bone not found: "+v);var m=new $t(n.slots.length,f,g),p=this.getValue(d,"color",null);null!=p&&m.color.setFromString(p);var y=this.getValue(d,"dark",null);null!=y&&(m.darkColor=new V(1,1,1,1),m.darkColor.setFromString(y)),m.attachmentName=this.getValue(d,"attachment",null),m.blendMode=t.blendModeFromString(this.getValue(d,"blend","normal")),n.slots.push(m)}if(r.ik)for(var w=0;w<r.ik.length;w++){var k=r.ik[w],E=new te(k.name);E.order=this.getValue(k,"order",0),E.skinRequired=this.getValue(k,"skin",!1);for(var x=0;x<k.bones.length;x++){var b=k.bones[x],M=n.findBone(b);if(null==M)throw new Error("IK bone not found: "+b);E.bones.push(M)}var S=k.target;if(E.target=n.findBone(S),null==E.target)throw new Error("IK target bone not found: "+S);E.mix=this.getValue(k,"mix",1),E.softness=this.getValue(k,"softness",0)*a,E.bendDirection=this.getValue(k,"bendPositive",!0)?1:-1,E.compress=this.getValue(k,"compress",!1),E.stretch=this.getValue(k,"stretch",!1),E.uniform=this.getValue(k,"uniform",!1),n.ikConstraints.push(E)}if(r.transform)for(var I=0;I<r.transform.length;I++){var T=r.transform[I],R=new ee(T.name);R.order=this.getValue(T,"order",0),R.skinRequired=this.getValue(T,"skin",!1);for(var A=0;A<T.bones.length;A++){var C=T.bones[A],P=n.findBone(C);if(null==P)throw new Error("Transform constraint bone not found: "+C);R.bones.push(P)}var _=T.target;if(R.target=n.findBone(_),null==R.target)throw new Error("Transform constraint target bone not found: "+_);R.local=this.getValue(T,"local",!1),R.relative=this.getValue(T,"relative",!1),R.offsetRotation=this.getValue(T,"rotation",0),R.offsetX=this.getValue(T,"x",0)*a,R.offsetY=this.getValue(T,"y",0)*a,R.offsetScaleX=this.getValue(T,"scaleX",0),R.offsetScaleY=this.getValue(T,"scaleY",0),R.offsetShearY=this.getValue(T,"shearY",0),R.rotateMix=this.getValue(T,"rotateMix",1),R.translateMix=this.getValue(T,"translateMix",1),R.scaleMix=this.getValue(T,"scaleMix",1),R.shearMix=this.getValue(T,"shearMix",1),n.transformConstraints.push(R)}if(r.path)for(var F=0;F<r.path.length;F++){var N=r.path[F],O=new j(N.name);O.order=this.getValue(N,"order",0),O.skinRequired=this.getValue(N,"skin",!1);for(var Y=0;Y<N.bones.length;Y++){var B=N.bones[Y],U=n.findBone(B);if(null==U)throw new Error("Transform constraint bone not found: "+B);O.bones.push(U)}var W=N.target;if(O.target=n.findSlot(W),null==O.target)throw new Error("Path target slot not found: "+W);O.positionMode=t.positionModeFromString(this.getValue(N,"positionMode","percent")),O.spacingMode=t.spacingModeFromString(this.getValue(N,"spacingMode","length")),O.rotateMode=t.rotateModeFromString(this.getValue(N,"rotateMode","tangent")),O.offsetRotation=this.getValue(N,"rotation",0),O.position=this.getValue(N,"position",0),O.positionMode==D.Fixed&&(O.position*=a),O.spacing=this.getValue(N,"spacing",0),O.spacingMode!=X.Length&&O.spacingMode!=X.Fixed||(O.spacing*=a),O.rotateMix=this.getValue(N,"rotateMix",1),O.translateMix=this.getValue(N,"translateMix",1),n.pathConstraints.push(O)}if(r.skins)for(var q=0;q<r.skins.length;q++){var H=r.skins[q],z=new ne(H.name);if(H.bones)for(var G=0;G<H.bones.length;G++){var Z=n.findBone(H.bones[G]);if(null==Z)throw new Error("Skin bone not found: "+H.bones[q]);z.bones.push(Z)}if(H.ik)for(var Q=0;Q<H.ik.length;Q++){var K=n.findIkConstraint(H.ik[Q]);if(null==K)throw new Error("Skin IK constraint not found: "+H.ik[q]);z.constraints.push(K)}if(H.transform)for(var J=0;J<H.transform.length;J++){var $=n.findTransformConstraint(H.transform[J]);if(null==$)throw new Error("Skin transform constraint not found: "+H.transform[q]);z.constraints.push($)}if(H.path)for(var tt=0;tt<H.path.length;tt++){var et=n.findPathConstraint(H.path[tt]);if(null==et)throw new Error("Skin path constraint not found: "+H.path[q]);z.constraints.push(et)}for(var at in H.attachments){var nt=n.findSlot(at);if(null==nt)throw new Error("Slot not found: "+at);var rt=H.attachments[at];for(var it in rt){var st=this.readAttachment(rt[it],z,nt.index,it,n);null!=st&&z.setAttachment(nt.index,it,st)}}n.skins.push(z),"default"==z.name&&(n.defaultSkin=z)}for(var ot=0,lt=this.linkedMeshes.length;ot<lt;ot++){var ht=this.linkedMeshes[ot],ut=null==ht.skin?n.defaultSkin:n.findSkin(ht.skin);if(null==ut)throw new Error("Skin not found: "+ht.skin);var ct=ut.getAttachment(ht.slotIndex,ht.parent);if(null==ct)throw new Error("Parent mesh not found: "+ht.parent);ht.mesh.deformAttachment=ht.inheritDeform?ct:ht.mesh,ht.mesh.setParentMesh(ct),ht.mesh.updateUVs()}if(this.linkedMeshes.length=0,r.events)for(var dt in r.events){var ft=r.events[dt],vt=new re(dt);vt.intValue=this.getValue(ft,"int",0),vt.floatValue=this.getValue(ft,"float",0),vt.stringValue=this.getValue(ft,"string",""),vt.audioPath=this.getValue(ft,"audio",null),null!=vt.audioPath&&(vt.volume=this.getValue(ft,"volume",1),vt.balance=this.getValue(ft,"balance",0)),n.events.push(vt)}if(r.animations)for(var gt in r.animations){var mt=r.animations[gt];this.readAnimation(mt,gt,n)}return n}},{key:"readAttachment",value:function(t,e,a,n,r){var i=this.scale;switch(n=this.getValue(t,"name",n),this.getValue(t,"type","region")){case"region":var s=this.getValue(t,"path",n),o=this.attachmentLoader.newRegionAttachment(e,n,s);if(null==o)return null;o.path=s,o.x=this.getValue(t,"x",0)*i,o.y=this.getValue(t,"y",0)*i,o.scaleX=this.getValue(t,"scaleX",1),o.scaleY=this.getValue(t,"scaleY",1),o.rotation=this.getValue(t,"rotation",0),o.width=t.width*i,o.height=t.height*i;var l=this.getValue(t,"color",null);return null!=l&&o.color.setFromString(l),o.updateOffset(),o;case"boundingbox":var h=this.attachmentLoader.newBoundingBoxAttachment(e,n);if(null==h)return null;this.readVertices(t,h,t.vertexCount<<1);var u=this.getValue(t,"color",null);return null!=u&&h.color.setFromString(u),h;case"mesh":case"linkedmesh":var c=this.getValue(t,"path",n),d=this.attachmentLoader.newMeshAttachment(e,n,c);if(null==d)return null;d.path=c;var f=this.getValue(t,"color",null);null!=f&&d.color.setFromString(f),d.width=this.getValue(t,"width",0)*i,d.height=this.getValue(t,"height",0)*i;var v=this.getValue(t,"parent",null);if(null!=v)return this.linkedMeshes.push(new le(d,this.getValue(t,"skin",null),a,v,this.getValue(t,"deform",!0))),d;var g=t.uvs;return this.readVertices(t,d,g.length),d.triangles=t.triangles,d.regionUVs=g,d.updateUVs(),d.edges=this.getValue(t,"edges",null),d.hullLength=2*this.getValue(t,"hull",0),d;case"path":var m=this.attachmentLoader.newPathAttachment(e,n);if(null==m)return null;m.closed=this.getValue(t,"closed",!1),m.constantSpeed=this.getValue(t,"constantSpeed",!0);var p=t.vertexCount;this.readVertices(t,m,p<<1);for(var y=_.newArray(p/3,0),w=0;w<t.lengths.length;w++)y[w]=t.lengths[w]*i;m.lengths=y;var k=this.getValue(t,"color",null);return null!=k&&m.color.setFromString(k),m;case"point":var E=this.attachmentLoader.newPointAttachment(e,n);if(null==E)return null;E.x=this.getValue(t,"x",0)*i,E.y=this.getValue(t,"y",0)*i,E.rotation=this.getValue(t,"rotation",0);var x=this.getValue(t,"color",null);return null!=x&&E.color.setFromString(x),E;case"clipping":var b=this.attachmentLoader.newClippingAttachment(e,n);if(null==b)return null;var M=this.getValue(t,"end",null);if(null!=M){var S=r.findSlot(M);if(null==S)throw new Error("Clipping end slot not found: "+M);b.endSlot=S}var I=t.vertexCount;this.readVertices(t,b,I<<1);var T=this.getValue(t,"color",null);return null!=T&&b.color.setFromString(T),b}return null}},{key:"readVertices",value:function(t,e,a){var n=this.scale;e.worldVerticesLength=a;var r=t.vertices;if(a!=r.length){for(var i=new Array,s=new Array,o=0,l=r.length;o<l;){var h=r[o++];s.push(h);for(var u=o+4*h;o<u;o+=4)s.push(r[o]),i.push(r[o+1]*n),i.push(r[o+2]*n),i.push(r[o+3])}e.bones=s,e.vertices=_.toFloatArray(i)}else{var c=_.toFloatArray(r);if(1!=n)for(var d=0,f=r.length;d<f;d++)c[d]*=n;e.vertices=c}}},{key:"readAnimation",value:function(t,e,a){var n=this.scale,r=new Array,i=0;if(t.slots)for(var s in t.slots){var o=t.slots[s],l=a.findSlotIndex(s);if(-1==l)throw new Error("Slot not found: "+s);for(var h in o){var u=o[h];if("attachment"==h){var c=new kt(u.length);c.slotIndex=l;for(var d=0,f=0;f<u.length;f++){var v=u[f];c.setFrame(d++,this.getValue(v,"time",0),v.name)}r.push(c),i=Math.max(i,c.frames[c.getFrameCount()-1])}else if("color"==h){var g=new yt(u.length);g.slotIndex=l;for(var m=0,p=0;p<u.length;p++){var y=u[p],w=new V;w.setFromString(y.color),g.setFrame(m,this.getValue(y,"time",0),w.r,w.g,w.b,w.a),this.readCurve(y,g,m),m++}r.push(g),i=Math.max(i,g.frames[(g.getFrameCount()-1)*yt.ENTRIES])}else{if("twoColor"!=h)throw new Error("Invalid timeline type for a slot: "+h+" ("+s+")");var k=new wt(u.length);k.slotIndex=l;for(var E=0,x=0;x<u.length;x++){var b=u[x],M=new V,S=new V;M.setFromString(b.light),S.setFromString(b.dark),k.setFrame(E,this.getValue(b,"time",0),M.r,M.g,M.b,M.a,S.r,S.g,S.b),this.readCurve(b,k,E),E++}r.push(k),i=Math.max(i,k.frames[(k.getFrameCount()-1)*wt.ENTRIES])}}}if(t.bones)for(var I in t.bones){var T=t.bones[I],R=a.findBoneIndex(I);if(-1==R)throw new Error("Bone not found: "+I);for(var A in T){var C=T[A];if("rotate"===A){var P=new vt(C.length);P.boneIndex=R;for(var F=0,N=0;N<C.length;N++){var O=C[N];P.setFrame(F,this.getValue(O,"time",0),this.getValue(O,"angle",0)),this.readCurve(O,P,F),F++}r.push(P),i=Math.max(i,P.frames[(P.getFrameCount()-1)*vt.ENTRIES])}else{if("translate"!==A&&"scale"!==A&&"shear"!==A)throw new Error("Invalid timeline type for a bone: "+A+" ("+I+")");var L=null,Y=1,B=0;"scale"===A?(L=new mt(C.length),B=1):"shear"===A?L=new pt(C.length):(L=new gt(C.length),Y=n),L.boneIndex=R;for(var U=0,W=0;W<C.length;W++){var q=C[W],H=this.getValue(q,"x",B),j=this.getValue(q,"y",B);L.setFrame(U,this.getValue(q,"time",0),H*Y,j*Y),this.readCurve(q,L,U),U++}r.push(L),i=Math.max(i,L.frames[(L.getFrameCount()-1)*gt.ENTRIES])}}}if(t.ik)for(var z in t.ik){var G=t.ik[z],Z=a.findIkConstraint(z),Q=new St(G.length);Q.ikConstraintIndex=a.ikConstraints.indexOf(Z);for(var K=0,J=0;J<G.length;J++){var $=G[J];Q.setFrame(K,this.getValue($,"time",0),this.getValue($,"mix",1),this.getValue($,"softness",0)*n,this.getValue($,"bendPositive",!0)?1:-1,this.getValue($,"compress",!1),this.getValue($,"stretch",!1)),this.readCurve($,Q,K),K++}r.push(Q),i=Math.max(i,Q.frames[(Q.getFrameCount()-1)*St.ENTRIES])}if(t.transform)for(var tt in t.transform){var et=t.transform[tt],at=a.findTransformConstraint(tt),nt=new It(et.length);nt.transformConstraintIndex=a.transformConstraints.indexOf(at);for(var rt=0,it=0;it<et.length;it++){var st=et[it];nt.setFrame(rt,this.getValue(st,"time",0),this.getValue(st,"rotateMix",1),this.getValue(st,"translateMix",1),this.getValue(st,"scaleMix",1),this.getValue(st,"shearMix",1)),this.readCurve(st,nt,rt),rt++}r.push(nt),i=Math.max(i,nt.frames[(nt.getFrameCount()-1)*It.ENTRIES])}if(t.path)for(var ot in t.path){var lt=t.path[ot],ht=a.findPathConstraintIndex(ot);if(-1==ht)throw new Error("Path constraint not found: "+ot);var ut=a.pathConstraints[ht];for(var ct in lt){var ft=lt[ct];if("position"===ct||"spacing"===ct){var Et=null,Ct=1;"spacing"===ct?(Et=new Rt(ft.length),ut.spacingMode!=X.Length&&ut.spacingMode!=X.Fixed||(Ct=n)):(Et=new Tt(ft.length),ut.positionMode==D.Fixed&&(Ct=n)),Et.pathConstraintIndex=ht;for(var Vt=0,Pt=0;Pt<ft.length;Pt++){var _t=ft[Pt];Et.setFrame(Vt,this.getValue(_t,"time",0),this.getValue(_t,ct,0)*Ct),this.readCurve(_t,Et,Vt),Vt++}r.push(Et),i=Math.max(i,Et.frames[(Et.getFrameCount()-1)*Tt.ENTRIES])}else if("mix"===ct){var Ft=new At(ft.length);Ft.pathConstraintIndex=ht;for(var Nt=0,Ot=0;Ot<ft.length;Ot++){var Lt=ft[Ot];Ft.setFrame(Nt,this.getValue(Lt,"time",0),this.getValue(Lt,"rotateMix",1),this.getValue(Lt,"translateMix",1)),this.readCurve(Lt,Ft,Nt),Nt++}r.push(Ft),i=Math.max(i,Ft.frames[(Ft.getFrameCount()-1)*At.ENTRIES])}}}if(t.deform)for(var Dt in t.deform){var Xt=t.deform[Dt],Yt=a.findSkin(Dt);if(null==Yt)throw new Error("Skin not found: "+Dt);for(var Bt in Xt){var Ut=Xt[Bt],Wt=a.findSlotIndex(Bt);if(-1==Wt)throw new Error("Slot not found: "+Ut.name);for(var qt in Ut){var Ht=Ut[qt],jt=Yt.getAttachment(Wt,qt);if(null==jt)throw new Error("Deform attachment not found: "+Ht.name);var zt=null!=jt.bones,Gt=jt.vertices,Zt=zt?Gt.length/3*2:Gt.length,Qt=new xt(Ht.length);Qt.slotIndex=Wt,Qt.attachment=jt;for(var Kt=0,Jt=0;Jt<Ht.length;Jt++){var $t=Ht[Jt],te=void 0,ee=this.getValue($t,"vertices",null);if(null==ee)te=zt?_.newFloatArray(Zt):Gt;else{te=_.newFloatArray(Zt);var ae=this.getValue($t,"offset",0);if(_.arrayCopy(ee,0,te,ae,ee.length),1!=n)for(var ne=ae,re=ne+ee.length;ne<re;ne++)te[ne]*=n;if(!zt)for(var ie=0;ie<Zt;ie++)te[ie]+=Gt[ie]}Qt.setFrame(Kt,this.getValue($t,"time",0),te),this.readCurve($t,Qt,Kt),Kt++}r.push(Qt),i=Math.max(i,Qt.frames[Qt.getFrameCount()-1])}}}var oe=t.drawOrder;if(null==oe&&(oe=t.draworder),null!=oe){for(var le=new Mt(oe.length),he=a.slots.length,ue=0,ce=0;ce<oe.length;ce++){var de=oe[ce],fe=null,ve=this.getValue(de,"offsets",null);if(null!=ve){fe=_.newArray(he,-1);for(var ge=_.newArray(he-ve.length,0),me=0,pe=0,ye=0;ye<ve.length;ye++){var we=ve[ye],ke=a.findSlotIndex(we.slot);if(-1==ke)throw new Error("Slot not found: "+we.slot);for(;me!=ke;)ge[pe++]=me++;fe[me+we.offset]=me++}for(;me<he;)ge[pe++]=me++;for(var Ee=he-1;Ee>=0;Ee--)-1==fe[Ee]&&(fe[Ee]=ge[--pe])}le.setFrame(ue++,this.getValue(de,"time",0),fe)}r.push(le),i=Math.max(i,le.frames[le.getFrameCount()-1])}if(t.events){for(var xe=new bt(t.events.length),be=0,Me=0;Me<t.events.length;Me++){var Se=t.events[Me],Ie=a.findEvent(Se.name);if(null==Ie)throw new Error("Event not found: "+Se.name);var Te=new se(_.toSinglePrecision(this.getValue(Se,"time",0)),Ie);Te.intValue=this.getValue(Se,"int",Ie.intValue),Te.floatValue=this.getValue(Se,"float",Ie.floatValue),Te.stringValue=this.getValue(Se,"string",Ie.stringValue),null!=Te.data.audioPath&&(Te.volume=this.getValue(Se,"volume",1),Te.balance=this.getValue(Se,"balance",0)),xe.setFrame(be++,Te)}r.push(xe),i=Math.max(i,xe.frames[xe.getFrameCount()-1])}if(isNaN(i))throw new Error("Error while parsing animation, duration is NaN");a.animations.push(new dt(e,r,i))}},{key:"readCurve",value:function(t,e,a){if(t.hasOwnProperty("curve"))if("stepped"==t.curve)e.setStepped(a);else{var n=t.curve;e.setCurve(a,n,this.getValue(t,"c2",0),this.getValue(t,"c3",1),this.getValue(t,"c4",1))}}},{key:"getValue",value:function(t,e,a){return void 0!==t[e]?t[e]:a}}],[{key:"blendModeFromString",value:function(t){if("normal"==(t=t.toLowerCase()))return jt.Normal;if("additive"==t)return jt.Additive;if("multiply"==t)return jt.Multiply;if("screen"==t)return jt.Screen;throw new Error("Unknown blend mode: ".concat(t))}},{key:"positionModeFromString",value:function(t){if("fixed"==(t=t.toLowerCase()))return D.Fixed;if("percent"==t)return D.Percent;throw new Error("Unknown position mode: ".concat(t))}},{key:"spacingModeFromString",value:function(t){if("length"==(t=t.toLowerCase()))return X.Length;if("fixed"==t)return X.Fixed;if("percent"==t)return X.Percent;throw new Error("Unknown position mode: ".concat(t))}},{key:"rotateModeFromString",value:function(t){if("tangent"==(t=t.toLowerCase()))return Y.Tangent;if("chain"==t)return Y.Chain;if("chainscale"==t)return Y.ChainScale;throw new Error("Unknown rotate mode: ".concat(t))}},{key:"transformModeFromString",value:function(t){if("normal"==(t=t.toLowerCase()))return F.Normal;if("onlytranslation"==t)return F.OnlyTranslation;if("norotationorreflection"==t)return F.NoRotationOrReflection;if("noscale"==t)return F.NoScale;if("noscaleorreflection"==t)return F.NoScaleOrReflection;throw new Error("Unknown transform mode: ".concat(t))}}]),t}(),le=function t(e,a,n,r,i){y(this,t),this.parent=void 0,this.skin=void 0,this.slotIndex=void 0,this.mesh=void 0,this.inheritDeform=void 0,this.mesh=e,this.skin=a,this.slotIndex=n,this.parent=r,this.inheritDeform=i};!function(t){t[t.Region=0]="Region",t[t.BoundingBox=1]="BoundingBox",t[t.Mesh=2]="Mesh",t[t.LinkedMesh=3]="LinkedMesh",t[t.Path=4]="Path",t[t.Point=5]="Point",t[t.Clipping=6]="Clipping"}(ie||(ie={}));var he=function(){function t(e){y(this,t),this.scale=1,this.attachmentLoader=void 0,this.linkedMeshes=new Array,this.attachmentLoader=e}return k(t,[{key:"readSkeletonData",value:function(e){var a=this.scale,n=new Jt;n.name="";var r=new ue(e);if(n.hash=r.readString(),n.version=r.readString(),"3.8.75"==n.version)throw new Error("Unsupported skeleton data, please export with a newer version of Spine.");n.x=r.readFloat(),n.y=r.readFloat(),n.width=r.readFloat(),n.height=r.readFloat();var i=r.readBoolean();i&&(n.fps=r.readFloat(),n.imagesPath=r.readString(),n.audioPath=r.readString());var s=0;s=r.readInt(!0);for(var o=0;o<s;o++)r.strings.push(r.readString());s=r.readInt(!0);for(var l=0;l<s;l++){var h=r.readString(),u=0==l?null:n.bones[r.readInt(!0)],c=new L(l,h,u);c.rotation=r.readFloat(),c.x=r.readFloat()*a,c.y=r.readFloat()*a,c.scaleX=r.readFloat(),c.scaleY=r.readFloat(),c.shearX=r.readFloat(),c.shearY=r.readFloat(),c.length=r.readFloat()*a,c.transformMode=t.TransformModeValues[r.readInt(!0)],c.skinRequired=r.readBoolean(),i&&V.rgba8888ToColor(c.color,r.readInt32()),n.bones.push(c)}s=r.readInt(!0);for(var d=0;d<s;d++){var f=r.readString(),v=n.bones[r.readInt(!0)],g=new $t(d,f,v);V.rgba8888ToColor(g.color,r.readInt32());var m=r.readInt32();-1!=m&&V.rgb888ToColor(g.darkColor=new V,m),g.attachmentName=r.readStringRef(),g.blendMode=t.BlendModeValues[r.readInt(!0)],n.slots.push(g)}s=r.readInt(!0);for(var p,y=0;y<s;y++){var w=new te(r.readString());w.order=r.readInt(!0),w.skinRequired=r.readBoolean(),p=r.readInt(!0);for(var k=0;k<p;k++)w.bones.push(n.bones[r.readInt(!0)]);w.target=n.bones[r.readInt(!0)],w.mix=r.readFloat(),w.softness=r.readFloat()*a,w.bendDirection=r.readByte(),w.compress=r.readBoolean(),w.stretch=r.readBoolean(),w.uniform=r.readBoolean(),n.ikConstraints.push(w)}s=r.readInt(!0);for(var E,x=0;x<s;x++){var b=new ee(r.readString());b.order=r.readInt(!0),b.skinRequired=r.readBoolean(),E=r.readInt(!0);for(var M=0;M<E;M++)b.bones.push(n.bones[r.readInt(!0)]);b.target=n.bones[r.readInt(!0)],b.local=r.readBoolean(),b.relative=r.readBoolean(),b.offsetRotation=r.readFloat(),b.offsetX=r.readFloat()*a,b.offsetY=r.readFloat()*a,b.offsetScaleX=r.readFloat(),b.offsetScaleY=r.readFloat(),b.offsetShearY=r.readFloat(),b.rotateMix=r.readFloat(),b.translateMix=r.readFloat(),b.scaleMix=r.readFloat(),b.shearMix=r.readFloat(),n.transformConstraints.push(b)}s=r.readInt(!0);for(var S,I=0;I<s;I++){var T=new j(r.readString());T.order=r.readInt(!0),T.skinRequired=r.readBoolean(),S=r.readInt(!0);for(var R=0;R<S;R++)T.bones.push(n.bones[r.readInt(!0)]);T.target=n.slots[r.readInt(!0)],T.positionMode=t.PositionModeValues[r.readInt(!0)],T.spacingMode=t.SpacingModeValues[r.readInt(!0)],T.rotateMode=t.RotateModeValues[r.readInt(!0)],T.offsetRotation=r.readFloat(),T.position=r.readFloat(),T.positionMode==D.Fixed&&(T.position*=a),T.spacing=r.readFloat(),T.spacingMode!=X.Length&&T.spacingMode!=X.Fixed||(T.spacing*=a),T.rotateMix=r.readFloat(),T.translateMix=r.readFloat(),n.pathConstraints.push(T)}var A=this.readSkin(r,n,!0,i);null!=A&&(n.defaultSkin=A,n.skins.push(A));var C=n.skins.length;for(_.setArraySize(n.skins,s=C+r.readInt(!0));C<s;C++)n.skins[C]=this.readSkin(r,n,!1,i);s=this.linkedMeshes.length;for(var P=0;P<s;P++){var F=this.linkedMeshes[P],N=null==F.skin?n.defaultSkin:n.findSkin(F.skin);if(null==N)throw new Error("Skin not found: "+F.skin);var O=N.getAttachment(F.slotIndex,F.parent);if(null==O)throw new Error("Parent mesh not found: "+F.parent);F.mesh.deformAttachment=F.inheritDeform?O:F.mesh,F.mesh.setParentMesh(O),F.mesh.updateUVs()}this.linkedMeshes.length=0,s=r.readInt(!0);for(var Y=0;Y<s;Y++){var B=new re(r.readStringRef());B.intValue=r.readInt(!1),B.floatValue=r.readFloat(),B.stringValue=r.readString(),B.audioPath=r.readString(),null!=B.audioPath&&(B.volume=r.readFloat(),B.balance=r.readFloat()),n.events.push(B)}s=r.readInt(!0);for(var U=0;U<s;U++)n.animations.push(this.readAnimation(r,r.readString(),n));return n}},{key:"readSkin",value:function(t,e,a,n){var r=null,i=0;if(a){if(0==(i=t.readInt(!0)))return null;r=new ne("default")}else{(r=new ne(t.readStringRef())).bones.length=t.readInt(!0);for(var s=0,o=r.bones.length;s<o;s++)r.bones[s]=e.bones[t.readInt(!0)];for(var l=0,h=t.readInt(!0);l<h;l++)r.constraints.push(e.ikConstraints[t.readInt(!0)]);for(var u=0,c=t.readInt(!0);u<c;u++)r.constraints.push(e.transformConstraints[t.readInt(!0)]);for(var d=0,f=t.readInt(!0);d<f;d++)r.constraints.push(e.pathConstraints[t.readInt(!0)]);i=t.readInt(!0)}for(var v=0;v<i;v++)for(var g=t.readInt(!0),m=0,p=t.readInt(!0);m<p;m++){var y=t.readStringRef(),w=this.readAttachment(t,e,r,g,y,n);null!=w&&r.setAttachment(g,y,w)}return r}},{key:"readAttachment",value:function(e,a,n,r,i,s){var o=this.scale,l=e.readStringRef();null==l&&(l=i);var h=e.readByte();switch(t.AttachmentTypeValues[h]){case ie.Region:var u=e.readStringRef(),c=e.readFloat(),d=e.readFloat(),f=e.readFloat(),v=e.readFloat(),g=e.readFloat(),m=e.readFloat(),p=e.readFloat(),y=e.readInt32();null==u&&(u=l);var w=this.attachmentLoader.newRegionAttachment(n,l,u);return null==w?null:(w.path=u,w.x=d*o,w.y=f*o,w.scaleX=v,w.scaleY=g,w.rotation=c,w.width=m*o,w.height=p*o,V.rgba8888ToColor(w.color,y),w.updateOffset(),w);case ie.BoundingBox:var k=e.readInt(!0),E=this.readVertices(e,k),x=s?e.readInt32():0,b=this.attachmentLoader.newBoundingBoxAttachment(n,l);return null==b?null:(b.worldVerticesLength=k<<1,b.vertices=E.vertices,b.bones=E.bones,s&&V.rgba8888ToColor(b.color,x),b);case ie.Mesh:var M=e.readStringRef(),S=e.readInt32(),I=e.readInt(!0),T=this.readFloatArray(e,I<<1,1),R=this.readShortArray(e),A=this.readVertices(e,I),C=e.readInt(!0),P=null,F=0,N=0;s&&(P=this.readShortArray(e),F=e.readFloat(),N=e.readFloat()),null==M&&(M=l);var O=this.attachmentLoader.newMeshAttachment(n,l,M);return null==O?null:(O.path=M,V.rgba8888ToColor(O.color,S),O.bones=A.bones,O.vertices=A.vertices,O.worldVerticesLength=I<<1,O.triangles=R,O.regionUVs=T,O.updateUVs(),O.hullLength=C<<1,s&&(O.edges=P,O.width=F*o,O.height=N*o),O);case ie.LinkedMesh:var L=e.readStringRef(),D=e.readInt32(),X=e.readStringRef(),Y=e.readStringRef(),B=e.readBoolean(),U=0,W=0;s&&(U=e.readFloat(),W=e.readFloat()),null==L&&(L=l);var q=this.attachmentLoader.newMeshAttachment(n,l,L);return null==q?null:(q.path=L,V.rgba8888ToColor(q.color,D),s&&(q.width=U*o,q.height=W*o),this.linkedMeshes.push(new ce(q,X,r,Y,B)),q);case ie.Path:for(var H=e.readBoolean(),j=e.readBoolean(),z=e.readInt(!0),G=this.readVertices(e,z),Z=_.newArray(z/3,0),Q=0,K=Z.length;Q<K;Q++)Z[Q]=e.readFloat()*o;var J=s?e.readInt32():0,$=this.attachmentLoader.newPathAttachment(n,l);return null==$?null:($.closed=H,$.constantSpeed=j,$.worldVerticesLength=z<<1,$.vertices=G.vertices,$.bones=G.bones,$.lengths=Z,s&&V.rgba8888ToColor($.color,J),$);case ie.Point:var tt=e.readFloat(),et=e.readFloat(),at=e.readFloat(),nt=s?e.readInt32():0,rt=this.attachmentLoader.newPointAttachment(n,l);return null==rt?null:(rt.x=et*o,rt.y=at*o,rt.rotation=tt,s&&V.rgba8888ToColor(rt.color,nt),rt);case ie.Clipping:var it=e.readInt(!0),st=e.readInt(!0),ot=this.readVertices(e,st),lt=s?e.readInt32():0,ht=this.attachmentLoader.newClippingAttachment(n,l);return null==ht?null:(ht.endSlot=a.slots[it],ht.worldVerticesLength=st<<1,ht.vertices=ot.vertices,ht.bones=ot.bones,s&&V.rgba8888ToColor(ht.color,lt),ht)}return null}},{key:"readVertices",value:function(t,e){var a=e<<1,n=new de,r=this.scale;if(!t.readBoolean())return n.vertices=this.readFloatArray(t,a,r),n;for(var i=new Array,s=new Array,o=0;o<e;o++){var l=t.readInt(!0);s.push(l);for(var h=0;h<l;h++)s.push(t.readInt(!0)),i.push(t.readFloat()*r),i.push(t.readFloat()*r),i.push(t.readFloat())}return n.vertices=_.toFloatArray(i),n.bones=s,n}},{key:"readFloatArray",value:function(t,e,a){var n=new Array(e);if(1==a)for(var r=0;r<e;r++)n[r]=t.readFloat();else for(var i=0;i<e;i++)n[i]=t.readFloat()*a;return n}},{key:"readShortArray",value:function(t){for(var e=t.readInt(!0),a=new Array(e),n=0;n<e;n++)a[n]=t.readShort();return a}},{key:"readAnimation",value:function(e,a,n){for(var r=new Array,i=this.scale,s=0,o=new V,l=new V,h=0,u=e.readInt(!0);h<u;h++)for(var c=e.readInt(!0),d=0,f=e.readInt(!0);d<f;d++){var v=e.readByte(),g=e.readInt(!0);switch(v){case t.SLOT_ATTACHMENT:var m=new kt(g);m.slotIndex=c;for(var p=0;p<g;p++)m.setFrame(p,e.readFloat(),e.readStringRef());r.push(m),s=Math.max(s,m.frames[g-1]);break;case t.SLOT_COLOR:var y=new yt(g);y.slotIndex=c;for(var w=0;w<g;w++){var k=e.readFloat();V.rgba8888ToColor(o,e.readInt32()),y.setFrame(w,k,o.r,o.g,o.b,o.a),w<g-1&&this.readCurve(e,w,y)}r.push(y),s=Math.max(s,y.frames[(g-1)*yt.ENTRIES]);break;case t.SLOT_TWO_COLOR:var E=new wt(g);E.slotIndex=c;for(var x=0;x<g;x++){var b=e.readFloat();V.rgba8888ToColor(o,e.readInt32()),V.rgb888ToColor(l,e.readInt32()),E.setFrame(x,b,o.r,o.g,o.b,o.a,l.r,l.g,l.b),x<g-1&&this.readCurve(e,x,E)}r.push(E),s=Math.max(s,E.frames[(g-1)*wt.ENTRIES])}}for(var M=0,S=e.readInt(!0);M<S;M++)for(var I=e.readInt(!0),T=0,R=e.readInt(!0);T<R;T++){var A=e.readByte(),C=e.readInt(!0);switch(A){case t.BONE_ROTATE:var P=new vt(C);P.boneIndex=I;for(var F=0;F<C;F++)P.setFrame(F,e.readFloat(),e.readFloat()),F<C-1&&this.readCurve(e,F,P);r.push(P),s=Math.max(s,P.frames[(C-1)*vt.ENTRIES]);break;case t.BONE_TRANSLATE:case t.BONE_SCALE:case t.BONE_SHEAR:var N=void 0,O=1;A==t.BONE_SCALE?N=new mt(C):A==t.BONE_SHEAR?N=new pt(C):(N=new gt(C),O=i),N.boneIndex=I;for(var L=0;L<C;L++)N.setFrame(L,e.readFloat(),e.readFloat()*O,e.readFloat()*O),L<C-1&&this.readCurve(e,L,N);r.push(N),s=Math.max(s,N.frames[(C-1)*gt.ENTRIES])}}for(var Y=0,B=e.readInt(!0);Y<B;Y++){var U=e.readInt(!0),W=e.readInt(!0),q=new St(W);q.ikConstraintIndex=U;for(var H=0;H<W;H++)q.setFrame(H,e.readFloat(),e.readFloat(),e.readFloat()*i,e.readByte(),e.readBoolean(),e.readBoolean()),H<W-1&&this.readCurve(e,H,q);r.push(q),s=Math.max(s,q.frames[(W-1)*St.ENTRIES])}for(var j=0,z=e.readInt(!0);j<z;j++){var G=e.readInt(!0),Z=e.readInt(!0),Q=new It(Z);Q.transformConstraintIndex=G;for(var K=0;K<Z;K++)Q.setFrame(K,e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat()),K<Z-1&&this.readCurve(e,K,Q);r.push(Q),s=Math.max(s,Q.frames[(Z-1)*It.ENTRIES])}for(var J=0,$=e.readInt(!0);J<$;J++)for(var tt=e.readInt(!0),et=n.pathConstraints[tt],at=0,nt=e.readInt(!0);at<nt;at++){var rt=e.readByte(),it=e.readInt(!0);switch(rt){case t.PATH_POSITION:case t.PATH_SPACING:var st=void 0,ot=1;rt==t.PATH_SPACING?(st=new Rt(it),et.spacingMode!=X.Length&&et.spacingMode!=X.Fixed||(ot=i)):(st=new Tt(it),et.positionMode==D.Fixed&&(ot=i)),st.pathConstraintIndex=tt;for(var lt=0;lt<it;lt++)st.setFrame(lt,e.readFloat(),e.readFloat()*ot),lt<it-1&&this.readCurve(e,lt,st);r.push(st),s=Math.max(s,st.frames[(it-1)*Tt.ENTRIES]);break;case t.PATH_MIX:var ht=new At(it);ht.pathConstraintIndex=tt;for(var ut=0;ut<it;ut++)ht.setFrame(ut,e.readFloat(),e.readFloat(),e.readFloat()),ut<it-1&&this.readCurve(e,ut,ht);r.push(ht),s=Math.max(s,ht.frames[(it-1)*At.ENTRIES])}}for(var ct=0,ft=e.readInt(!0);ct<ft;ct++)for(var Et=n.skins[e.readInt(!0)],Ct=0,Vt=e.readInt(!0);Ct<Vt;Ct++)for(var Pt=e.readInt(!0),_t=0,Ft=e.readInt(!0);_t<Ft;_t++){var Nt=Et.getAttachment(Pt,e.readStringRef()),Ot=null!=Nt.bones,Lt=Nt.vertices,Dt=Ot?Lt.length/3*2:Lt.length,Xt=e.readInt(!0),Yt=new xt(Xt);Yt.slotIndex=Pt,Yt.attachment=Nt;for(var Bt=0;Bt<Xt;Bt++){var Ut=e.readFloat(),Wt=void 0,qt=e.readInt(!0);if(0==qt)Wt=Ot?_.newFloatArray(Dt):Lt;else{Wt=_.newFloatArray(Dt);var Ht=e.readInt(!0);if(qt+=Ht,1==i)for(var jt=Ht;jt<qt;jt++)Wt[jt]=e.readFloat();else for(var zt=Ht;zt<qt;zt++)Wt[zt]=e.readFloat()*i;if(!Ot)for(var Gt=0,Zt=Wt.length;Gt<Zt;Gt++)Wt[Gt]+=Lt[Gt]}Yt.setFrame(Bt,Ut,Wt),Bt<Xt-1&&this.readCurve(e,Bt,Yt)}r.push(Yt),s=Math.max(s,Yt.frames[Xt-1])}var Qt=e.readInt(!0);if(Qt>0){for(var Kt=new Mt(Qt),Jt=n.slots.length,$t=0;$t<Qt;$t++){for(var te=e.readFloat(),ee=e.readInt(!0),ae=_.newArray(Jt,0),ne=Jt-1;ne>=0;ne--)ae[ne]=-1;for(var re=_.newArray(Jt-ee,0),ie=0,oe=0,le=0;le<ee;le++){for(var he=e.readInt(!0);ie!=he;)re[oe++]=ie++;ae[ie+e.readInt(!0)]=ie++}for(;ie<Jt;)re[oe++]=ie++;for(var ue=Jt-1;ue>=0;ue--)-1==ae[ue]&&(ae[ue]=re[--oe]);Kt.setFrame($t,te,ae)}r.push(Kt),s=Math.max(s,Kt.frames[Qt-1])}var ce=e.readInt(!0);if(ce>0){for(var de=new bt(ce),fe=0;fe<ce;fe++){var ve=e.readFloat(),ge=n.events[e.readInt(!0)],me=new se(ve,ge);me.intValue=e.readInt(!1),me.floatValue=e.readFloat(),me.stringValue=e.readBoolean()?e.readString():ge.stringValue,null!=me.data.audioPath&&(me.volume=e.readFloat(),me.balance=e.readFloat()),de.setFrame(fe,me)}r.push(de),s=Math.max(s,de.frames[ce-1])}return new dt(a,r,s)}},{key:"readCurve",value:function(e,a,n){switch(e.readByte()){case t.CURVE_STEPPED:n.setStepped(a);break;case t.CURVE_BEZIER:this.setCurve(n,a,e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat())}}},{key:"setCurve",value:function(t,e,a,n,r,i){t.setCurve(e,a,n,r,i)}}]),t}();he.AttachmentTypeValues=[0,1,2,3,4,5,6],he.TransformModeValues=[F.Normal,F.OnlyTranslation,F.NoRotationOrReflection,F.NoScale,F.NoScaleOrReflection],he.PositionModeValues=[D.Fixed,D.Percent],he.SpacingModeValues=[X.Length,X.Fixed,X.Percent],he.RotateModeValues=[Y.Tangent,Y.Chain,Y.ChainScale],he.BlendModeValues=[jt.Normal,jt.Additive,jt.Multiply,jt.Screen],he.BONE_ROTATE=0,he.BONE_TRANSLATE=1,he.BONE_SCALE=2,he.BONE_SHEAR=3,he.SLOT_ATTACHMENT=0,he.SLOT_COLOR=1,he.SLOT_TWO_COLOR=2,he.PATH_POSITION=0,he.PATH_SPACING=1,he.PATH_MIX=2,he.CURVE_LINEAR=0,he.CURVE_STEPPED=1,he.CURVE_BEZIER=2;var ue=function(){function t(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Array,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new DataView(e.buffer);y(this,t),this.strings=a,this.index=n,this.buffer=r}return k(t,[{key:"readByte",value:function(){return this.buffer.getInt8(this.index++)}},{key:"readShort",value:function(){var t=this.buffer.getInt16(this.index);return this.index+=2,t}},{key:"readInt32",value:function(){var t=this.buffer.getInt32(this.index);return this.index+=4,t}},{key:"readInt",value:function(t){var e=this.readByte(),a=127&e;return 0!=(128&e)&&(a|=(127&(e=this.readByte()))<<7,0!=(128&e)&&(a|=(127&(e=this.readByte()))<<14,0!=(128&e)&&(a|=(127&(e=this.readByte()))<<21,0!=(128&e)&&(a|=(127&(e=this.readByte()))<<28)))),t?a:a>>>1^-(1&a)}},{key:"readStringRef",value:function(){var t=this.readInt(!0);return 0==t?null:this.strings[t-1]}},{key:"readString",value:function(){var t=this.readInt(!0);switch(t){case 0:return null;case 1:return""}t--;for(var e="",a=0;a<t;){var n=this.readByte();switch(n>>4){case 12:case 13:e+=String.fromCharCode((31&n)<<6|63&this.readByte()),a+=2;break;case 14:e+=String.fromCharCode((15&n)<<12|(63&this.readByte())<<6|63&this.readByte()),a+=3;break;default:e+=String.fromCharCode(n),a++}}return e}},{key:"readFloat",value:function(){var t=this.buffer.getFloat32(this.index);return this.index+=4,t}},{key:"readBoolean",value:function(){return 0!=this.readByte()}}]),t}(),ce=function t(e,a,n,r,i){y(this,t),this.parent=void 0,this.skin=void 0,this.slotIndex=void 0,this.mesh=void 0,this.inheritDeform=void 0,this.mesh=e,this.skin=a,this.slotIndex=n,this.parent=r,this.inheritDeform=i},de=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;y(this,t),this.bones=e,this.vertices=a};c("spine",["json","bin"])(function(t){x(a,v);var e=T(a);function a(){return y(this,a),e.apply(this,arguments)}return k(a,[{key:"load",value:function(t,e){var a=this;return new d((function(n,r){var i;"spine"!==t.type&&r("Asset type must be spine."),!t.urls&&t.url&&a.checkUrl(t.url)&&(i=a.getResouceFromUrl(t.url)),t.urls&&a.checkUrls(t.urls)&&(i=a.getResouceFromUrls(t.urls));var s,l=!1;s=new Gt((function(t){return new fe(t,e.engine)}));var h=i,u=h.skeletonFile,c=h.atlasFile,d=h.textureFile;u&&c&&d?(s.loadText(u),s.loadText(c),s.loadTexture(d)):u&&c&&!d?(l=!0,s.loadText(u),s.loadTextureAtlas(c)):r("Resouce param error"),a.onLoad(s).then((function(t){var i;"loaded"!==t&&r(t),i=l?s.get(c):new st(s.get(c),(function(){return s.get(d)}));var h=new Kt(i),v=(a.isBinFile(u)?new he(h):new oe(h)).readSkeletonData(s.get(u)),g=e.engine,m=new f(g),p=m.addComponent(o);p.shaderData.enableMacro("USE_MODEL_MATRIX"),p.shaderData.enableMacro("USE_CUSTOM_TEXTURE");var y=e.engine._spriteDefaultMaterial.clone();p.setMaterial(y),m.addComponent(zt).setSkeletonData(v),n(m)}))}))}},{key:"isBinFile",value:function(t){return"bin"===this.getExtFromUrl(t)}},{key:"checkUrl",value:function(t){var e=this.getExtFromUrl(t);return"json"===e||"bin"===e||(console.error("When use url as params, url must be json or bin file"),!1)}},{key:"getResouceFromUrl",value:function(t){var e=t,a=t,n=a.indexOf("?");return n>0&&(a=a.substr(0,n)),{skeletonFile:e,atlasFile:a=a.substr(0,a.lastIndexOf("."))+".atlas"}}},{key:"checkUrls",value:function(t){if(t.length<2)return console.error("When use urls as params, urls should at least contain: json/bin and atlas"),!1;if(t.length>3)return console.error("Spine runtime dont support multiple texture now"),!1;var e=this.getResouceFromUrls(t),a=e.skeletonFile,n=e.atlasFile;return e.textureFile,!(!a||!n)||(console.error("Lack ".concat(a?"":"skeletonFile").concat(n?" atlasFile":"")),!1)}},{key:"getResouceFromUrls",value:function(t){for(var e,a,n,r=0;r<t.length;r+=1){var i=t[r],s=this.getExtFromUrl(i);"json"!==s&&"bin"!==s||(e=i),"atlas"===s&&(a=i);["png","jpg","webp","jpeg"].includes(s)&&(n=i)}return{skeletonFile:e,atlasFile:a,textureFile:n}}},{key:"getExtFromUrl",value:function(t){return t.split(/[#?]/)[0].split(".").pop().trim()}},{key:"onLoad",value:function(t){return new Promise((function(e,a){setInterval((function(){t.isLoadingComplete()&&(t.hasErrors()?a(t.getErrors()):e("loaded"))}),100)}))}}]),a}());var fe=function(t){x(a,tt);var e=T(a);function a(t,n){var r;return y(this,a),(r=e.call(this,t)).texture=void 0,r.texture=new g(n,t.width,t.height),r.texture.setImageSource(t),r.texture.generateMipmaps(),r}return k(a,[{key:"setFilters",value:function(t,e){t===WebGLRenderingContext.NEAREST?this.texture.filterMode=m.Point:e===WebGLRenderingContext.LINEAR_MIPMAP_LINEAR?this.texture.filterMode=m.Trilinear:this.texture.filterMode=m.Bilinear}},{key:"setWraps",value:function(t,e){this.texture.wrapModeU=t,this.texture.wrapModeV=e}},{key:"dispose",value:function(){}}]),a}();export{Gt as AssetManager,Kt as AtlasAttachmentLoader,he as SkeletonBinary,oe as SkeletonJson,zt as SpineAnimation,tt as Texture,st as TextureAtlas};
//# sourceMappingURL=module.js.map
